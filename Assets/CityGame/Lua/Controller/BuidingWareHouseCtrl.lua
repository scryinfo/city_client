---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljw.
--- DateTime: 2019/4/12 16:37
---

local this


BuidingWareHouseCtrl = class('BuidingWareHouseCtrl',UIPanel)
UIPanel:ResgisterOpen(BuidingWareHouseCtrl)

--
function BuidingWareHouseCtrl:initialize()
    UIPanel.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

--
function BuidingWareHouseCtrl:bundleName()
    return "Assets/CityGame/Resources/View/BuidingWareHousePanel.prefab"
end

--
function BuidingWareHouseCtrl:OnCreate(obj)
    UIPanel.OnCreate(self, obj)
end

--
function BuidingWareHouseCtrl:Awake(go)
    this = self
    self.gameObject = go
    self.houseBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    self.houseBehaviour:AddClick(BuidingWareHousePanel.backBtn.gameObject, self._backFunc, self)
end

--
function BuidingWareHouseCtrl:Refresh()
    if self.m_data.insId then
        self.insId=self.m_data.insId
        DataManager.OpenDetailModel(BuidingWareHouseModel,self.m_data.insId)
        DataManager.DetailModelRpcNoRet(self.m_data.insId, 'm_ReqHouseDetailInfo',self.m_data.insId)
    --else
    --    self.m_data.insId=self.insId
    --    DataManager.OpenDetailModel(BuidingWareHouseModel,self.insId)
    --    DataManager.DetailModelRpcNoRet(self.insId, 'm_ReqHouseDetailInfo',self.insId)
    end
end

--
function BuidingWareHouseCtrl:Active()
    UIPanel.Active(self)
    Event.AddListener("c_BuildingTopChangeData", self._changeItemData, self)
end


--集散中心通用部件
function BuidingWareHouseCtrl:_initData(houseDetailInfo)
    if self.groupMgr == nil then
        self.groupMgr = BuildingInfoMainGroupMgr:new(BuidingWareHousePanel.groupTrans, self.houseBehaviour)
        self.groupMgr:AddParts(OrderCenterPart, 0.33)
        self.groupMgr:AddParts(BuildingSalaryPart, 0.33)
        self.groupMgr:AddParts(BuildingWarehousePart, 0.34)

    self.groupMgr:RefreshData(houseDetailInfo)
    self.groupMgr:TurnOffAllOptions()
    else
    self.groupMgr:RefreshData(houseDetailInfo)
    end
end

--
function BuidingWareHouseCtrl:Hide()
    UIPanel.Hide(self)
    Event.RemoveListener("c_BuildingTopChangeData", self._changeItemData, self)
    if self.groupMgr ~= nil then
        self.groupMgr:Destroy()
        self.groupMgr = nil
    end
end

--关闭界面
function BuidingWareHouseCtrl:_backFunc()
    UIPanel.ClosePage()
end


--
function BuidingWareHouseCtrl:_refreshSalary(data)
    if self.m_data ~= nil then
        if self.m_data.info.state == "OPERATE" then
            Event.Brocast("SmallPop", "设置工资成功", 300)
        end
        self.m_data.info.salary = data.Salary
        self.m_data.info.setSalaryTs = data.ts
        self.groupMgr:RefreshData(self.m_data)
    end
end
