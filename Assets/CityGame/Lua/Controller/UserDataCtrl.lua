---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/7/27 11:29
--- 使用数据面板
UserDataCtrl = class('UserDataCtrl',UIPanel)
UIPanel:ResgisterOpen(UserDataCtrl)

local userDataCtrlBehaviour
function UserDataCtrl:bundleName()
    return "Assets/CityGame/Resources/View/UserDataPanel.prefab"
end

function UserDataCtrl:initialize()
    UIPanel.initialize(self,UIType.PopUp,UIMode.NeedBack,UICollider.None)
end

function UserDataCtrl:Awake(go)
    self:_getComponent(go)
    userDataCtrlBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    userDataCtrlBehaviour:AddClick(self.bg,self.OnBg,self)
    userDataCtrlBehaviour:AddClick(self.btn,self.OnBtn,self)

    self.input.onValueChanged:AddListener(function()
        self:OnInput()
    end)
    self.slider.onValueChanged:AddListener(function()
        self:OnSlider()
    end)
end

function UserDataCtrl:Active()
    UIPanel.Active(self)
    self.title = GetLanguage(24020009)
end

function UserDataCtrl:Refresh()
    self:initData()
end

function UserDataCtrl:Hide()
    UIPanel.Hide(self)
    self.input.text = "0"
    self.slider.value = 0
end

function UserDataCtrl:OnCreate(obj)
    UIPanel.OnCreate(self,obj)
end

--获取组件
function UserDataCtrl:_getComponent(go)
    self.bg = go.transform:Find("bg").gameObject
    self.title = go.transform:Find("content/title"):GetComponent("Text")
    self.base = go.transform:Find("content/top/bg/base/Text"):GetComponent("Text")
    self.sale = go.transform:Find("content/top/bg/sale/Text"):GetComponent("Text")
    self.dataName = go.transform:Find("content/top/bg/barnd/Text"):GetComponent("Text")
    self.impact = go.transform:Find("content/top/bg/Text"):GetComponent("Text")
    self.name = go.transform:Find("content/top/card/name/Text"):GetComponent("Text")
    self.icon = go.transform:Find("content/top/card/cardImage/Image"):GetComponent("Image")
    self.quantity = go.transform:Find("content/quantity"):GetComponent("Text")
    self.input = go.transform:Find("content/quantity/inputBg/input"):GetComponent("InputField")
    self.slider = go.transform:Find("content/quantity/inputBg/input/Slider"):GetComponent("Slider")
    self.btn =  go.transform:Find("content/btn").gameObject
    self.btnText =  go.transform:Find("content/btn/Text"):GetComponent("Text")
end

--初始化数据
function UserDataCtrl:initData()
    --if self.m_data.myOwner then
    --    self.btnText = GetLanguage()
    --else
    --    self.btnText = GetLanguage()
    --end
    self.base.text = "x" .. self.m_data.wareHouse
    self.sale.text = "x" .. self.m_data.sale
    LoadSprite(ResearchConfig[self.m_data.itemId].iconPath, self.icon, true)
    self.slider.maxValue = self.m_data.wareHouse
end

--返回
function UserDataCtrl:OnBg()
    UIPanel.ClosePage()
end

function UserDataCtrl:OnInput()
    if self.input.text == "" then
        return
    end
    if tonumber(self.input.text) > self.m_data.wareHouse then
        self.input.text = self.m_data.wareHouse
    end
    self.slider.value = tonumber(self.input.text)
end

function UserDataCtrl:OnSlider()
    self.input.text = self.slider.value
end

function UserDataCtrl:OnBtn(go)
    if go.slider.value == 0 then
        Event.Brocast("SmallPop","请输入使用数量",ReminderType.Warning)
    end
    if go.m_data.userFunc then
        go.m_data.userFunc(go.slider.value)
        go.m_data.userFunc = nil
    end
end
