---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/7/17 17:15
---

OfflineNotificationHomepageItem = class("OfflineNotificationHomepageItem")
OfflineNotificationHomepageItem.static.TypeIconImagePath =
{
    -- 航班预测
    ["flight"] = "Assets/CityGame/Resources/Atlas/OfflineNotification/icon-airplane.png",
    -- 币图
    ["eee"] = "Assets/CityGame/Resources/Atlas/OfflineNotification/icon-eee.png",
    -- 幸运值图
    ["luckycoupon"] = "Assets/CityGame/Resources/Atlas/OfflineNotification/icon-luckycoupon.png"
}

function OfflineNotificationHomepageItem:initialize(prefab, data, ctrl)
    self.prefab = prefab
    self.ctrl = ctrl

    local transform = prefab.transform

    self.typeIconImage = transform:Find("TypeIconImage")
    self.iconImage = transform:Find("IconImage")
    local path1,path2
    if data.unLineIncome then
        -- 排除部分没有盈利的建筑
        for i = #data.unLineIncome, 1, -1 do
            if data.unLineIncome[i].income <= 0 then
                table.remove(data.unLineIncome, i)
            end
        end
        path1 = PlayerBuildingBaseData[tonumber(string.sub(data.unLineIncome[1].mId, 1, 2) .. "00003")].imgPath
        path2 = OfflineNotificationHomepageItem.static.TypeIconImagePath.eee
        self.typeIconImage.sizeDelta = Vector2.New(94, 80)
        self.iconImage.sizeDelta = Vector2.New(38, 38)

        transform:Find("ShowDetailsBtn"):GetComponent("Button").onClick:AddListener(function ()
            self:_ShowDetails(1, data)
        end)
        transform:Find("BuildingTypeText"):GetComponent("Text").text = GetLanguage(PlayerBuildingBaseData[data.unLineIncome[1].mId].typeName)
        transform:Find("IncomeText"):GetComponent("Text").text = GetClientPriceString(data.totalIncome)
    else
        path1 = OfflineNotificationHomepageItem.static.TypeIconImagePath.flight
        path2 = OfflineNotificationHomepageItem.static.TypeIconImagePath.luckycoupon
        self.typeIconImage.sizeDelta = Vector2.New(71, 59)
        self.iconImage.sizeDelta = Vector2.New(38, 31)

        transform:Find("ShowDetailsBtn"):GetComponent("Button").onClick:AddListener(function ()
            self:_ShowDetails(2, data)
        end)
        transform:Find("BuildingTypeText"):GetComponent("Text").text = "Lucky coupon profit and loss"
        transform:Find("IncomeText"):GetComponent("Text").text = data.totalIncome
    end
    LoadSprite(path1, self.typeIconImage:GetComponent("Image"), false)
    LoadSprite(path2, self.iconImage:GetComponent("Image"), false)
end

function OfflineNotificationHomepageItem:_ShowDetails(detailsScrollIndex, data)
    self.ctrl:ShowItems(detailsScrollIndex, data)
end