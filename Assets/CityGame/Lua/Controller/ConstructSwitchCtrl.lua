---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by allen.
--- DateTime: 2018/11/2 17:01
---建造面板
-----

ConstructSwitchCtrl = class('ConstructSwitchCtrl',UIPage)
UIPage:ResgisterOpen(ConstructSwitchCtrl)

function ConstructSwitchCtrl:initialize()
    UIPage.initialize(self, UIType.Fixed, UIMode.DoNothing, UICollider.None)
end

function ConstructSwitchCtrl:bundleName()
    return "ConstructSwitchPanel"
end

function ConstructSwitchCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)
    --关闭面板
    local LuaBehaviour = self.gameObject:GetComponent('LuaBehaviour');
    LuaBehaviour:AddClick(ConstructSwitchPanel.btn_confirm.gameObject, function()
        --TODO：确认建造
        ct.log("Allen_wk13","确认建造")
    end );
    LuaBehaviour:AddClick(ConstructSwitchPanel.btn_abolish.gameObject, function()
        --TODO：取消建造
        ct.log("Allen_wk13","取消建造")
        Event.Brocast("m_abolishConstructBuild")
    end );
end

function ConstructSwitchCtrl:Awake(go)
    self.gameObject = go
    Event.AddListener("m_abolishConstructBuild", self.Hide, self);
    Event.AddListener("m_constructBuildGameObjectMove", self.MoveBtnNodePosition, self);
end


--移动节点位置
--触发：1.创建时触发一次2.移动建筑物时触发一次3.移动屏幕时触发一次
function ConstructSwitchCtrl:MoveBtnNodePosition()
    --计算最新Node位置
    if DataManager.constructObj == nil then
        return
    end
    --TODO:3D坐标转2D坐标
    local nodePosition = UnityEngine.Camera.main:WorldToScreenPoint(DataManager.constructObj.transform.position)
    ConstructSwitchPanel.BtnNode.anchoredPosition = Vector2.New(nodePosition.x, nodePosition.y)
end


function ConstructSwitchCtrl:Hide()
    UIPage.Hide(self)
    TerrainManager.AbolishConstructBuild()
end