---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/1/16 17:47
---UIBubbleMgr
UIBubbleMgr = class('UIBubbleMgr')
UIBubbleMgr.static.GroundAucSoonObjPath = "View/Items/BuildingBubbleItems/UIBubbleGroundAucSoonItem"  --即将拍卖
UIBubbleMgr.static.GroundAucNowObjPath = "View/Items/BuildingBubbleItems/UIBubbleGroundAucNowItem"  --正在拍卖
UIBubbleMgr.static.NpcFlowObjPath = "View/Items/BuildingBubbleItems/UIBubbleNpcFlowItem"  --人流量
UIBubbleMgr.static.SellRentObjPath = "View/Items/BuildingBubbleItems/UIBubbleTransAndBuildingItem"  --土地交易气泡

--气泡类型
UIBubbleType =
{
    GroundAuc = 1,
    GroundTrans = 2,
    BuildingSelf = 3,
}

function UIBubbleMgr:initialize(obj)
    self.gameObject = obj
end

--生成拍卖气泡
function UIBubbleMgr:initGroundAucBubbles(groundAucDatas)
    if self.groundAucLuaItems == nil then
        self.groundAucLuaItems = {}
    end
    local auction = groundAucDatas.aucInfo
    for i, data in pairs(auction) do
        if data then
            UIBubbleMgr.startFlowCam = true
        end

        if data then
            self:_creatGroundAucBubbleItem(data)
        end
    end
end

function UIBubbleMgr:_creatGroundAucBubbleItem(bubbleData)
    if bubbleData.isStartAuc then
        --已经开始拍卖
        if self.groundAucNowObj == nil then
            self.groundAucNowObj = UnityEngine.Resources.Load(UIBubbleMgr.static.GroundAucNowObjPath)
        end
        local go = UnityEngine.GameObject.Instantiate(self.groundAucNowObj)
        go.transform:SetParent(self.gameObject.transform)
        if self.hide then
            go.transform.localScale = Vector3.zero
        else
            go.transform.localScale = Vector3.one
        end
        local data = ct.deepCopy(bubbleData)
        data.groundObj.transform.localScale = Vector3.one
        data.bubbleRect = go:GetComponent("RectTransform")  --将obj引用到lua中
        local groundAucNowItem = UIBubbleGroundAucNowItem:new(data)
        self.groundAucLuaItems[bubbleData.id] = groundAucNowItem
        self.nowItem = groundAucNowItem
    else
        --即将拍卖
        if nil == self.groundAucSoonObj then
            self.groundAucSoonObj = UnityEngine.Resources.Load(UIBubbleMgr.static.GroundAucSoonObjPath)
        end
        local go = UnityEngine.GameObject.Instantiate(self.groundAucSoonObj)
        go.transform:SetParent(self.gameObject.transform)
        if self.hide then
            go.transform.localScale = Vector3.zero
        else
            go.transform.localScale = Vector3.one
        end
        local data = ct.deepCopy(bubbleData)
        data.groundObj.transform.localScale = Vector3.one
        data.bubbleRect = go:GetComponent("RectTransform")
        local groundAucSoonItem = UIBubbleGroundAucSoonItem:new(data)
        self.groundAucLuaItems[bubbleData.id] = groundAucSoonItem
        self.soonItem = groundAucSoonItem
    end
end

--更新数据
function UIBubbleMgr:_refreshItems(datas)
    for key, item in pairs(self.groundAucLuaItems) do
        item:Close()
        item.data.groundObj.gameObject.transform.localScale = Vector3.zero  --删除场景中的预制
        destroyImmediate(item.data.bubbleRect.gameObject)  --删除之前的item
        self.groundAucLuaItems[key] = nil
    end
    self.nowItem = nil
    self.soonItem = nil

    self.groundAucLuaItems = {}
    local auction = datas
    for i, data in pairs(auction) do
        if data then
            self:_creatGroundAucBubbleItem(data)
        end
    end
end

--隐藏所有气泡
function UIBubbleMgr:_hideAllItems()
    self.hide = true
    for key, item in pairs(self.groundAucLuaItems) do
        if item.data.bubbleRect then
            item.data.bubbleRect.transform.localScale = Vector3.zero
        end
    end
end
--显示所有气泡
function UIBubbleMgr:_showAllItems()
    self.hide = false
    for key, item in pairs(self.groundAucLuaItems) do
        if item.data.bubbleRect then
            item.data.bubbleRect.transform.localScale = Vector3.one
        end
    end
end

function UIBubbleMgr:getSoonItem()
    if self.soonItem ~= nil then
        return self.soonItem
    end
    return nil
end
function UIBubbleMgr:getNowItem()
    if self.nowItem ~= nil then
        return self.nowItem
    end
    return nil
end