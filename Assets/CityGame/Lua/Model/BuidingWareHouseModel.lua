---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljw.
--- DateTime: 2019/4/15 15:38
---


BuidingWareHouseModel = class('BuidingWareHouseModel',ModelBase)
local pbl = pbl


function BuidingWareHouseModel:initialize(insId)
    self.insId = insId
    self:OnCreate()
end

--启动事件--gs
function BuidingWareHouseModel:OnCreate()
    --网络回调注册
    DataManager.ModelRegisterNetMsg(self.insId,"gscode.OpCode","detailWareHouse","gs.WareHouse",self.n_OnReceiveHouseDetailInfo)
    DataManager.ModelRegisterNetMsg(self.insId,"gscode.OpCode","setSalary","gs.SetSalary",self.n_OnHouseDetailInfo)
    DataManager.ModelRegisterNetMsg(self.insId,"gscode.OpCode","startBusiness","gs.Id",self.n_OnReceiveOpenBusiness)
    DataManager.ModelRegisterNetMsg(self.insId,"gscode.OpCode","setWareHouseRent","gs.setWareHouseRent",self.n_OnReceiveSentWareHouseInfo)


    --本地的回调注册
    Event.AddListener("m_ReqHouseChangeRent", self.m_ReqHouseChangeRent, self)
    Event.AddListener("m_ReqHouseSetSalary", self.m_ReqHouseSetSalary, self)
end


--- 客户端请求 ---
--获取建筑详情
function BuidingWareHouseModel:m_ReqHouseDetailInfo(buildingId)
    DataManager.ModelSendNetMes("gscode.OpCode", "detailWareHouse","gs.Id",{ id = buildingId})
end
--改变建筑名字
function BuidingWareHouseModel:m_ReqChangeHouseName(id, name)
    DataManager.ModelSendNetMes("gscode.OpCode", "setBuildingInfo","gs.SetBuildingInfo",{ id = id, name = name})
end
--更改出租信息
function BuidingWareHouseModel:m_ReqSentHouseDetailInfo(data)
    DataManager.ModelSendNetMes("gscode.OpCode", "setWareHouseRent","gs.setWareHouseRent",data)
end


----- 回调 ---
--集散中心详情
function BuidingWareHouseModel:n_OnReceiveHouseDetailInfo(houseDetailInfo)
    DataManager.ControllerRpcNoRet(self.insId,"BuidingWareHouseCtrl", '_initData',houseDetailInfo)
end

--员工工资改变
function BuidingWareHouseModel:n_OnHouseDetailInfo(houseDetailInfo)
    DataManager.ControllerRpcNoRet(self.insId,"BuidingWareHouseCtrl", '_refreshlary',houseDetailInfo)
end

--开业成功，再次请求建筑详情
function BuidingWareHouseModel:n_OnReceiveOpenBusiness(data)
    if data ~= nil and data.id == self.insId then
        self:m_ReqHouseDetailInfo(self.insId)
        Event.Brocast("SmallPop", GetLanguage(40010020), 300)  --开业成功提示
    end
end

--更改出租信息回调
function BuidingWareHouseModel:n_OnReceiveSentWareHouseInfo(SentWareHouseInfo)
    DataManager.ControllerRpcNoRet(self.insId,"BuidingWareHouseCtrl", '_refreshRentInfo',SentWareHouseInfo)
end

