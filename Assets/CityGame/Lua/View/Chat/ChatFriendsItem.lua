---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2018/12/14 20:44
---

ChatFriendsItem = class('ChatFriendsItem')

-- 初始化
function ChatFriendsItem:initialize(itemId, prefab, isOn, data)
    --prefab:GetComponent("Image").sprite = UnityEngine.Resources.Load("1")
    --ChatCtrl.static.luaBehaviour:AddClick(prefab, self.OnExpressionBtn, self)
    self.prefab = prefab
    self.data = data
    self.data.itemId = itemId
    self.data.company = "Scry"

    local transform = prefab.transform
    -- 复选框提示
    self.toggle = transform:Find("Toggle"):GetComponent("Toggle")
    -- 好友名
    self.nameText = transform:Find("NameText"):GetComponent("Text")
    -- 好友所在公司名字
    self.companyText = transform:Find("CompanyText"):GetComponent("Text")
    -- 好友消息红点提示
    self.noticeImage = transform:Find("NoticeImage").gameObject
    self.noticeText = transform:Find("NoticeImage/NoticeText"):GetComponent("Text")

    self.toggle.isOn = false
    self.nameText.text = self.data.name
    self.companyText.text = self.data.company
    self.noticeImage:SetActive(false)

    self.toggle.onValueChanged:AddListener(function (isOn)
        self:_toggleValueChange(isOn)
    end)
end

function ChatFriendsItem:_toggleValueChange(isOn)
    if isOn then
        self.toggle.interactable = false
        ChatCtrl.static.chatMgr:DestroyContentChildren()
        ChatCtrl.static.chatMgr:SetFriendsIdAndToggle(self.data.id, self.toggle)
        ChatCtrl.static.chatMgr:ShowPlayerInfo(2, self.data)
    end
end