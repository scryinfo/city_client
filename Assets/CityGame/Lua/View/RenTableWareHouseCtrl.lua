---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by ljw.
--- DateTime: 2019/4/26 19:10
---


RenTableWareHouseCtrl = class('RenTableWareHouseCtrl',UIPanel)
UIPanel:ResgisterOpen(RenTableWareHouseCtrl)
local this = RenTableWareHouseCtrl
local spacenumber = 0
local timenum = 0
local price = 0
function RenTableWareHouseCtrl:initialize()
    UIPanel.initialize(self,UIType.PopUp,UIMode.DoNothing,UICollider.Normal)
end

function RenTableWareHouseCtrl:bundleName()
    return "Assets/CityGame/Resources/View/RenTableWareHousePanel.prefab"
end

function RenTableWareHouseCtrl:OnCreate(obj)
    UIPanel.OnCreate(self,obj)
end

function RenTableWareHouseCtrl:Awake(obj)
    local m_data = self.m_data
    RenTableWareHousePanel.totalText.text = m_data.rent
    price = m_data.rent
    self:_scrollbartimeInfo(m_data)
    self:_scrollbarspaceInfo(m_data)
    self:_init(m_data)
    self.gameObject = obj
    self.luaBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    self.luaBehaviour:AddClick(RenTableWareHousePanel.closeBtn.gameObject, self._closeFunc, self)
    self.luaBehaviour:AddClick(RenTableWareHousePanel.startBtn.gameObject, self._startFunc, self)
    RenTableWareHousePanel.timeTextSlider.onValueChanged:AddListener(function ()
       self:_scrollbartimeInfo(m_data)
   end)
    RenTableWareHousePanel.perSlider.onValueChanged:AddListener(function ()
       self:_scrollbarspaceInfo(m_data)
   end)

end

function RenTableWareHouseCtrl:Active()
    UIPanel.Active(self)
end

function RenTableWareHouseCtrl:Refresh()

end

function RenTableWareHouseCtrl:Hide()
    UIPanel.Hide(self)
end

--Close the interface
function RenTableWareHouseCtrl:_closeFunc()
    UIPanel.ClosePage()
end

function RenTableWareHouseCtrl:_startFunc(data)
    local rentdata = {}
    rentdata.bid = data.m_data.insId
    rentdata.renterId = DataManager.GetMyOwnerID()
    rentdata.startTime = ""
    rentdata.hourToRent = timenum
    rentdata.rent =  RenTableWareHousePanel.totalprice.text
    rentdata.rentCapacity = spacenumber
    rentdata.orderNumber = ""
        DataManager.DetailModelRpcNoRet(data.m_data.insId, 'm_ReqrentSpace',rentdata)
    UIPanel.ClosePage()
end

function RenTableWareHouseCtrl:_init(data)
    RenTableWareHousePanel.timeTextSlider.maxValue = data.maxHourToRent
    RenTableWareHousePanel.timeTextSlider.minValue = data.minHourToRent
    RenTableWareHousePanel.perSlider.maxValue = data.rentCapacity - data.rentUsedCapacity
end

--Update lease time
function RenTableWareHouseCtrl:_scrollbartimeInfo(data)
    timenum = RenTableWareHousePanel.timeTextSlider.value;
    RenTableWareHousePanel.timeInput.text = timenum
    RenTableWareHousePanel.totalprice.text = timenum * spacenumber * price
end

--Update leased space
function RenTableWareHouseCtrl:_scrollbarspaceInfo(data)
    spacenumber = RenTableWareHousePanel.perSlider.value;
    RenTableWareHousePanel.perText.text = spacenumber
    RenTableWareHousePanel.totalprice.text = timenum * spacenumber * price
end























