---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by mengpengfei.
--- DateTime: 2019/4/18 11:07
---
TransportItem = class('TransportItem')

function TransportItem:initialize(dataInfo,prefab,luaBehaviour,keyId,goodsType)
    self.keyId = keyId
    self.prefab = prefab
    self.dataInfo = dataInfo
    self.goodsType = goodsType
    self.itemId = dataInfo.itemId

    self.iconImg = prefab.transform:Find("goodsInfo/iconImg"):GetComponent("Image")
    self.nameBg = prefab.transform:Find("goodsInfo/nameBg")
    self.nameText = prefab.transform:Find("goodsInfo/nameBg/nameText"):GetComponent("Text")

    --需要隐藏的商品信息
    self.goods = prefab.transform:Find("goodsInfo/goods")
    self.levelImg = prefab.transform:Find("goodsInfo/goods/levelImg"):GetComponent("Image")
    self.brandNameText = prefab.transform:Find("goodsInfo/goods/detailsBg/brandNameText"):GetComponent("Text")
    self.brandValue = prefab.transform:Find("goodsInfo/goods/detailsBg/scoreBg/brandIcon/brandValue"):GetComponent("Text")
    self.qualityValue = prefab.transform:Find("goodsInfo/goods/detailsBg/scoreBg/qualityIcon/qualityValue"):GetComponent("Text")
    self.numberText = prefab.transform:Find("number/numberText"):GetComponent("Text")
    self.goodsPriceText = prefab.transform:Find("total/goodsCost/goodsPriceText"):GetComponent("Text")
    self.freightPriceText = prefab.transform:Find("total/freight/freightPriceText"):GetComponent("Text")
    self.deleBtn = prefab.transform:Find("deleBtn")

    luaBehaviour:AddClick(self.deleBtn.gameObject,self._closeDeleBtn,self)

    self:InitializeData()
end

function TransportItem:InitializeData()
    self.nameText.text = GetLanguage(self.itemId)
    self.numberText.text = "×"..self.dataInfo.number
    if self.goodsType == BuildingType.MaterialFactory then
        self.goods.transform.localScale = Vector3.zero
        self.nameBg.transform.localPosition = Vector3(-140,-100,0)
        LoadSprite(Material[self.itemId].img,self.iconImg,false)
    elseif self.goodsType == BuildingType.ProcessingFactory then
        self.goods.transform.localScale = Vector3.one
        LoadSprite(Good[self.itemId].img,self.iconImg,false)
        --self.levelImg
        --self.brandNameText
        --self.brandValue
        --self.qualityValue
    end
end

function TransportItem:_closeDeleBtn(ins)
    Event.Brocast("deleteItemPrefab",ins.keyId)
end

--刷新自身列表Id
function TransportItem:RefreshID(id)
    self.keyId = id
end

--local Math_Floor = math.floor
----初始化方法
--function TransportItem:initialize(goodsDataInfo,prefab,inluabehaviour,id)
--    self.prefab = prefab;
--    self.goodsDataInfo = goodsDataInfo;
--    self._luabehaviour = inluabehaviour;
--    self.id = id;
--    self.itemId = goodsDataInfo.key.id;
--    self.goodsIcon = self.prefab.transform:Find("goodsbg/goodsIcon"):GetComponent("Image");
--    self.nameText = self.prefab.transform:Find("nameText"):GetComponent("Text");
--    self.inputNumber = self.prefab.transform:Find("InputNumber"):GetComponent("InputField");
--    self.numberScrollbar = self.prefab.transform:Find("numberScrollbar"):GetComponent("Slider");
--    self.closeBtn = self.prefab.transform:Find("closeBtn");
--
--    self.inputNumber.text = 0;
--    self.inputNumber.characterLimit = string.len(goodsDataInfo.n)
--    self.numberScrollbar.value = 0;
--    self.numberScrollbar.minValue = 0;
--    self.numberScrollbar.maxValue = goodsDataInfo.n
--    self.nameText.text = GetLanguage(self.itemId);
--
--    local materialKey,goodsKey = 21,22
--    if Math_Floor(self.itemId / 100000) == materialKey then
--        LoadSprite(Material[self.itemId].img,self.goodsIcon,false)
--    elseif Math_Floor(self.itemId / 100000) == goodsKey then
--        LoadSprite(Good[self.itemId].img,self.goodsIcon,false)
--    end
--    self.numberScrollbar.onValueChanged:AddListener(function ()
--        self:scrollbarInfo();
--    end)
--    self.inputNumber.onValueChanged:AddListener(function ()
--        self:inputInfo();
--    end)
--    self._luabehaviour:AddClick(self.closeBtn.gameObject,self.OnClick_closeBtn,self);
--end
----删除
--function TransportItem:OnClick_closeBtn(ins)
--    PlayMusEff(1002)
--    Event.Brocast("SelectedGoodsItem",ins);
--end
----刷新滑动条
--function TransportItem:scrollbarInfo()
--    --当前数量
--    local number = self.numberScrollbar.value
--    self.inputNumber.text = number;
--end
----刷新输入框
--function TransportItem:inputInfo()
--    local number = self.inputNumber.text
--    if number ~= "" then
--        self.numberScrollbar.value = number;
--    else
--        self.numberScrollbar.value = 0;
--    end
--end