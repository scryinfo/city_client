---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Fisher.
--- DateTime: 2019/5/17 9:38
---Building information Model

BuildingInformationModel = class('BuildingInformationModel',ModelBase)

function BuildingInformationModel:initialize(insId)
    self.insId = insId
    self:OnCreate()
end

function BuildingInformationModel:OnCreate()
    --Local events
    Event.AddListener("m_ReqClosedBuilding",self.m_ReqClosedBuilding,self)
    Event.AddListener("m_ReqDemolitionBuilding",self.m_ReqDemolitionBuilding,self)
    Event.AddListener("m_ReqSetBuildingName",self.m_ReqSetBuildingName,self)
    Event.AddListener("m_ReqBuildingProsperity",self.m_ReqBuildingProsperity,self)
    --Construction closed
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","shutdownBusiness","gs.Id",self.n_ClosedBuilding,self)
    --Renamed building
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","updateBuildingName","gs.BuildingInfo",self.n_SetBuildingInfo,self)
    --Building prosperity
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","queryBuildingProsperity","gs.BuildingProsperity",self.n_buildingProsperity,self)
    --Raw material factory
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","queryMaterialInfo","gs.MaterialInfo",self.n_MaterialFactoryInfo,self)
    --Processing plant
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","queryProduceDepInfo","gs.ProduceDepInfo",self.n_ProcessingFactoryInfo,self)
    --Retail store
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","queryRetailShopOrApartmentInfo","gs.RetailShopOrApartmentInfo",self.n_RetailShopInfo,self)
    --Promote
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","queryPromotionCompanyInfo","gs.BuildingInfo",self.n_PromoteInfo,self)
    --graduate School
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","queryLaboratoryInfo","gs.BuildingInfo",self.n_LaboratoryInfo,self)

end

function BuildingInformationModel:Close()
    --local event 
    Event.RemoveListener("m_ReqClosedBuilding",self.m_ReqClosedBuilding,self)
    Event.RemoveListener("m_ReqDemolitionBuilding",self.m_ReqDemolitionBuilding,self)
    Event.RemoveListener("m_ReqSetBuildingName",self.m_ReqSetBuildingName,self)
    Event.RemoveListener("m_ReqBuildingProsperity",self.m_ReqBuildingProsperity,self)
    --Construction closed
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","shutdownBusiness","gs.Id",self.n_ClosedBuilding,self)
    --Renamed building
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","updateBuildingName","gs.BuildingInfo",self.n_SetBuildingInfo,self)
    --Building prosperity
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","queryBuildingProsperity","gs.BuildingProsperity",self.n_buildingProsperity,self)
    --Raw material factory
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","queryMaterialInfo","gs.MaterialInfo",self.n_MaterialFactoryInfo,self)
    --Processing plant
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","queryProduceDepInfo","gs.ProduceDepInfo",self.n_ProcessingFactoryInfo,self)
    --Retail store
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","queryRetailShopOrApartmentInfo","gs.RetailShopOrApartmentInfo",self.n_RetailShopInfo,self)
   --graduate School
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","queryLaboratoryInfo","gs.LaboratoryInfo",self.n_LaboratoryInfo,self)
    --Promote
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","queryPromotionCompanyInfo","gs.QueryBuildingInfo",self.n_PromoteInfo,self)
    --graduate School
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","queryLaboratoryInfo","gs.LaboratoryInfo",self.n_LaboratoryInfo,self)

end

---client request ----
--Construction closed
function BuildingInformationModel:m_ReqClosedBuilding(buildingId)
    FlightMainModel.OpenFlightLoading()
    DataManager.ModelSendNetMes("gscode.OpCode", "shutdownBusiness","gs.Id",{id = buildingId})
end
--Building demolition
function BuildingInformationModel:m_ReqDemolitionBuilding(buildingId)
    DataManager.ModelSendNetMes("gscode.OpCode", "delBuilding","gs.Id",{id = buildingId})
end
--Renamed building
function BuildingInformationModel:m_ReqSetBuildingName(buildingId,name)
    FlightMainModel.OpenFlightLoading()
    DataManager.ModelSendNetMes("gscode.OpCode", "updateBuildingName","gs.UpdateBuildingName",{buildingId = buildingId,name = name})
end
--Building prosperity
function BuildingInformationModel:m_ReqBuildingProsperity(buildingId)
    DataManager.ModelSendNetMes("gscode.OpCode", "queryBuildingProsperity","gs.Id",{id = buildingId})
end

--Request building information
--Raw material plant construction information
function BuildingInformationModel:m_ReqMaterialFactoryInfo(buildingId,playerId)
    FlightMainModel.OpenFlightLoading()
    local lMsg = {buildingId = buildingId,playerId = playerId}
    DataManager.ModelSendNetMes("gscode.OpCode", "queryMaterialInfo","gs.QueryBuildingInfo",lMsg)
end
--Processing plant building information
function BuildingInformationModel:m_ReqProcessingFactoryInfo(buildingId,playerId)
    FlightMainModel.OpenFlightLoading()
    local lMsg = {buildingId = buildingId,playerId = playerId}
    DataManager.ModelSendNetMes("gscode.OpCode", "queryProduceDepInfo","gs.QueryBuildingInfo",lMsg)
end
--Retail Store Building Information
function BuildingInformationModel:m_ReqRetailShopInfo(buildingId,playerId)
    FlightMainModel.OpenFlightLoading()
    local lMsg = {buildingId = buildingId,playerId = playerId}
    DataManager.ModelSendNetMes("gscode.OpCode", "queryRetailShopOrApartmentInfo","gs.QueryBuildingInfo",lMsg)
end
--Institute Building Information
function BuildingInformationModel:m_LaboratoryInfo(buildingId,playerId)
    FlightMainModel.OpenFlightLoading()
    local lMsg = {buildingId = buildingId,playerId = playerId}
    DataManager.ModelSendNetMes("gscode.OpCode", "queryLaboratoryInfo","gs.QueryBuildingInfo",lMsg)
end
--Promotion of building information
function BuildingInformationModel:m_ReqPromoteInfo(buildingId,playerId)
    FlightMainModel.OpenFlightLoading()
    local lMsg = {buildingId = buildingId,playerId = playerId}
    DataManager.ModelSendNetMes("gscode.OpCode", "queryPromotionCompanyInfo","gs.QueryBuildingInfo",lMsg)
end

---Server callback---
--Construction closed
function BuildingInformationModel:n_ClosedBuilding(data)
    FlightMainModel.CloseFlightLoading()
    DataManager.ControllerRpcNoRet(self.insId,"BuildingInformationCtrl", 'closedBuildingSucceed',data)
end
--Renamed building
function BuildingInformationModel:n_SetBuildingInfo(data,msgId)
    FlightMainModel.CloseFlightLoading()
    if msgId == 0 then
        Event.Brocast("setBuildingNameFailure",data)
    else
        DataManager.ControllerRpcNoRet(self.insId,"BuildingInformationCtrl", 'setBuildingNameSucceed',data)
    end
end
--Building prosperity
function BuildingInformationModel:n_buildingProsperity(data)
    DataManager.ControllerRpcNoRet(self.insId,"BuildingInformationCtrl", 'saveBuildingProsperity',data)
end

--Request building information
--Raw material plant construction information
function BuildingInformationModel:n_MaterialFactoryInfo(data)
    FlightMainModel.CloseFlightLoading()
    DataManager.ControllerRpcNoRet(self.insId,"BuildingInformationCtrl", 'builidngInfo',data)
end
--Processing plant building information
function BuildingInformationModel:n_ProcessingFactoryInfo(data)
    FlightMainModel.CloseFlightLoading()
    DataManager.ControllerRpcNoRet(self.insId,"BuildingInformationCtrl", 'builidngInfo',data)
end
--Retail Store Building Information
function BuildingInformationModel:n_RetailShopInfo(data)
    FlightMainModel.CloseFlightLoading()
    DataManager.ControllerRpcNoRet(self.insId,"BuildingInformationCtrl", 'builidngInfo',data)
end
--Institute Building Information
function BuildingInformationModel:n_LaboratoryInfo(data)
    FlightMainModel.CloseFlightLoading()
    DataManager.ControllerRpcNoRet(self.insId,"BuildingInformationCtrl", 'builidngInfo',data)
end
--Promotion of building information
function BuildingInformationModel:n_PromoteInfo(data)
    FlightMainModel.CloseFlightLoading()
    DataManager.ControllerRpcNoRet(self.insId,"BuildingInformationCtrl", 'builidngInfo',data)
end

