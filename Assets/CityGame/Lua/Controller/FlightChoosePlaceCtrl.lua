---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/9/21 10:35
---
-----

FlightChoosePlaceCtrl = class('FlightChoosePlaceCtrl',UIPanel)
UIPanel:ResgisterOpen(FlightChoosePlaceCtrl)

function FlightChoosePlaceCtrl:initialize()
    UIPanel.initialize(self, UIType.Normal, UIMode.DoNothing, UICollider.None)
end

function FlightChoosePlaceCtrl:bundleName()
    return "Assets/CityGame/Resources/View/FlightChoosePlacePanel.prefab"
end

function FlightChoosePlaceCtrl:OnCreate(obj)
    UIPanel.OnCreate(self, obj)
end

function FlightChoosePlaceCtrl:Awake(go)
    self.gameObject = go
    self:_getComponent(go)

    self.chooseEvent = VScrollEventData.New()
    self.chooseEvent.mProvideData = FlightChoosePlaceCtrl.static.ProvideFunc
    self.chooseEvent.mClearData = FlightChoosePlaceCtrl.static.ClearFunc
    self.chooseScroll:InitComponent(self.chooseEvent)

    local behaviour = self.gameObject:GetComponent('LuaBehaviour')
    behaviour:AddClick(self.backBtn.gameObject, function ()
        self:backFunc()
    end , self)
end

function FlightChoosePlaceCtrl:Refresh()
    self:_initData()
end

function FlightChoosePlaceCtrl:Active()
    UIPanel.Active(self)
    Event.AddListener("FlightChoosePlaceEvent", self.choosePlaceEvent, self)
end

function FlightChoosePlaceCtrl:Hide()
    UIPanel.Hide(self)
    Event.RemoveListener("FlightChoosePlaceEvent", self.choosePlaceEvent, self)
end
--
FlightChoosePlaceCtrl.static.ProvideFunc = function(transform, idx)
    idx = idx + 1
    local item = FlightSelectPlaceItem:new(transform, FlightChoosePlaceCtrl.totalValue[idx])
    if FlightChoosePlaceCtrl.static.itemsList[idx] ~= nil then
        FlightChoosePlaceCtrl.static.itemsList[idx]:Close()
    end
    FlightChoosePlaceCtrl.static.itemsList[idx] = item
end
--
FlightChoosePlaceCtrl.static.ClearFunc = function(transform) end

--
function FlightChoosePlaceCtrl:_getComponent(go)
    if go == nil then
        return
    end
    local trans = go.transform
    self.backBtn = trans:Find("topRoot/backBtn")
    self.chooseScroll = trans:Find("scrollRoot/scroll"):GetComponent("FlightScrollTool")
    self.titleText01 = trans:Find("topRoot/Text"):GetComponent("Text")
end
--
function FlightChoosePlaceCtrl:_initData()
    self:cleanItemList()
    self:_TempCreateConfig()
    self.chooseScroll:InitData(self.tempDetailDic, self.tempTitleData)
end
--
function FlightChoosePlaceCtrl:cleanItemList()
    if FlightChoosePlaceCtrl.static.itemsList == nil then
        FlightChoosePlaceCtrl.static.itemsList = {}
        return
    end
    for i, value in pairs(FlightChoosePlaceCtrl.static.itemsList) do
        value:Close()
    end
end
--
function FlightChoosePlaceCtrl:_TempCreateConfig()
    local searchDic, searchDetail = self:_getCorrectConfig()
    FlightChoosePlaceCtrl.totalValue = searchDetail

    self.tempDetailDic = System.Collections.Generic.Dictionary_string_strings.New()
    self.tempTitleData = {}
    for i, value in ipairs(searchDic) do
        self.tempTitleData[#self.tempTitleData + 1] = value.title
        local tempValue = value.value
        self.tempDetailDic:Add(value.title, tempValue)
    end

    --self.tempTitleData = {"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",}
    --self.tempDetailDic = System.Collections.Generic.Dictionary_string_strings.New()
    --FlightChoosePlaceCtrl.totalValue = {}
    --for i, value in ipairs(self.tempTitleData) do
    --    local tempValue = {value.."aaa", value.."bbb", value.."ddd", value.."ccc", value.."vvv"}
    --    --FlightChoosePlaceCtrl.totalValue:AddRange(tempValue)
    --    self.tempDetailDic:Add(value, tempValue)
    --end
end
--
function FlightChoosePlaceCtrl:_getCorrectConfig()
    local language = currentLanguage
    local SearchDetail
    local SearchDic
    if language == chinese then
        SearchDic = FlightSearchDicCnConfig
        SearchDetail = FlightSearchDetailCnConfig
    elseif language == english then
        SearchDic = FlightSearchDicEnConfig
        SearchDetail = FlightSearchDetailEnConfig
    end
    --万一其他多语言没有，则默认使用英文
    if SearchDic == nil then
        SearchDic = FlightSearchDicEnConfig
        SearchDetail = FlightSearchDetailEnConfig
    end
    return SearchDic, SearchDetail
end
--
function FlightChoosePlaceCtrl:_language()

end
--
function FlightChoosePlaceCtrl:backFunc()
    self.chooseScroll:CleanAll()
    self:cleanItemList()

    PlayMusEff(1002)
    UIPanel.ClosePage()
end

--
function FlightChoosePlaceCtrl:choosePlaceEvent(data)
    if data ~= nil and self.m_data.callback ~= nil then
        self.m_data.callback(data)
        self:backFunc()
    end
end