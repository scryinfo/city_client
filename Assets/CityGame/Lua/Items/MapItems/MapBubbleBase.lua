---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/2/27 18:13
---Small map bubble base class
MapBubbleBase = class('MapBubbleBase')

--
function MapBubbleBase:initialize(data, viewRect)
    self.viewRect = viewRect:GetComponent("RectTransform")
    self.data = data

    Event.AddListener("c_MapBubbleScale", self._changeScale, self)
    self:_childInit()
    self:toggleShowSelect(false)
end

--Initial setting to set zoom ratio and position
function MapBubbleBase:setScaleAndPos(scale, pos, sizeDelta)
    self.viewRect.transform.localScale = Vector3.one
    if scale ~= nil then
        if scale == 0 then
            scale = 1
        end
        local myScale = 1 / scale
        self.scaleRoot.transform.localScale = Vector3.one * myScale  --Set child object scaling size
    end
    if pos ~= nil then
        self.viewRect.anchoredPosition = pos
    end
    if sizeDelta ~= nil then
        self.viewRect.sizeDelta = sizeDelta  --Set parent object size
        if self.detailShowImg ~= nil then
            self.detailShowImg.enabled = false
        end
    end
end
--
function MapBubbleBase:_changeScale(mapScale)
    if mapScale == 0 or self.scaleRoot == nil then
        return
    end
    local scale = 1 / mapScale
    self.scaleRoot.localScale = Vector3.one * scale

    if self.detailShowImg ~= nil then
        self.detailShowImg.transform.localScale = Vector3.one * scale
        self.detailShowImg.rectTransform.sizeDelta = mapScale * self.viewRect.sizeDelta
    end
end
--
function MapBubbleBase:toggleShowSelect(show)
    if self.selectTran == nil then
        return
    end
    if show == true then
        self.selectTran.localScale = Vector3.one
    else
        self.selectTran.localScale = Vector3.zero
    end
end
--
function MapBubbleBase:close()
    if self.viewRect ~= nil and self.data ~= nil and self.data.poolName ~= nil then
        MapBubbleManager.recyclingObjToPool(self.data.poolName, self.viewRect.gameObject)
    end
    if self.avatar ~= nil then
        AvatarManger.CollectAvatar(self.avatar)
        self.avatar = nil
    end
    self:_childClose()
    self.data = nil
    self = nil
end

--
function MapBubbleBase:_childInit() end
--
function MapBubbleBase:_childClose() end


