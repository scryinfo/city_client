---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2018/10/25 11:49
---仓库商品
local class = require 'Framework/class'
require('Framework/UI/UIPage')
WareHouseGoodsItem = class('WareHouseGoodsItem')

--初始化方法   数据（读配置表）
function WareHouseGoodsItem:initialize(goodsDataInfo,prefab,inluabehaviour, mgr, id)
    self.prefab = prefab;
    self.goodsDataInfo = goodsDataInfo;
    self._luabehaviour = inluabehaviour
    self.manager = mgr
    self.name = goodsDataInfo.name;
    self.n = goodsDataInfo.number;
    self.id = id
    self.itemId = goodsDataInfo.itemId
    self.producerId = goodsDataInfo.producerId
    self.qty = goodsDataInfo.qty
    self.bg = self.prefab.transform:Find("TransportItem"):GetComponent("Image");
    self.material = self.prefab.transform:Find("TransportItem/Name");
    self.nameText = self.prefab.transform:Find("TransportItem/GoodsName").gameObject:GetComponent("Text");
    self.numberText = self.prefab.transform:Find("TransportItem/NumberText").gameObject:GetComponent("Text");
    self.downBG = self.prefab.transform:Find("TransportItem/downBG"):GetComponent("Image");
    self.deleteBtn = self.prefab.transform:Find("WareHouseItem/Delete/DeleteButton").gameObject;
    self.select = self.prefab.transform:Find("TransportItem/Select").gameObject;
    self.select_while = self.prefab.transform:Find("TransportItem/Select/Select-white").gameObject;
    self.bgItem = self.prefab.transform:Find("WareHouseItem").gameObject;
    self.transportBG = self.prefab.transform:Find("TransportItem").gameObject;
    self.nameText.text = goodsDataInfo.name
    self.numberText.text = goodsDataInfo.number

    --原料

    local materialKey,goodsKey = 21,22
    local type = ct.getType(UnityEngine.Sprite)
    if math.floor(self.itemId / 100000) == materialKey then            --原料
        LoadSprite("Assets/CityGame/Resources/Atlas/CenterWareHouse/bg-goods-white-s.png", self.bg)
        self.material.localScale = Vector3.zero
        self.downBG:GetComponent("RectTransform").localPosition = Vector3.New(165,200, 0)
        LoadSprite(Material[self.itemId].img, self.downBG,true)
        --panelMgr:LoadPrefab_A(Material[self.itemId].img,type,nil,function(goodData,obj)
        --    if obj ~= nil then
        --        local texture = ct.InstantiatePrefab(obj)
        --        self.downBG.sprite = texture
        --    end
        --end)
    elseif math.floor(self.itemId / 100000) == goodsKey then           --商品
        panelMgr:LoadPrefab_A(Good[self.itemId].img,type,nil,function(goodData,obj)
            if obj ~= nil then
                local texture = ct.InstantiatePrefab(obj)
                self.downBG.sprite = texture
            end
        end)
    end

    self._luabehaviour:AddClick(self.deleteBtn, self.OnDelete, self);
    self._luabehaviour:AddClick(self.bgItem, self.OnBGItem,self)
    self._luabehaviour:AddClick(self.transportBG,self.OnTransportBG,self)
   -- Event.AddListener("c_GsDelItem",self.c_GsDelItem,self);
end
--删除物品
function WareHouseGoodsItem:OnDelete(go)
    Event.Brocast("c_OnDelete",go)
end

--点击删除回调
function WareHouseGoodsItem:c_GsDelItem()

    --Event.Brocast("c_DeleteItem",self)
     --self.manager:_deleteGoods(self.id)
end

--点击BG
function WareHouseGoodsItem:OnBGItem()
    --Event.Brocast("c_OnBGItem")
end

--点击运输后的BG
function WareHouseGoodsItem:OnTransportBG(go)
    Event.Brocast("c_OnTransportBG",go)
end

--删除后刷新ID及刷新显示
function WareHouseGoodsItem:RefreshID(id)
    self.id = id
end

function WareHouseGoodsItem:setActiva(isSelect)
    self.select:SetActive(not isSelect);
    self.bgItem:SetActive(isSelect);
end

function WareHouseGoodsItem:Enabled()
    self.select_while:SetActive(true);
    self.transportBG:GetComponent("Button").enabled = true
end

--刷新ID数据
function WareHouseGoodsItem:RefreshData(data,id)
    self.id = id
    self.n = data.number
    self.name = data.name
    self.itemId = data.itemId
    --self.producerId = data.producerId
    --self.qty = data.qty
end