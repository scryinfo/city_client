---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/7/23 18:12
---
ResearchDatabaseDetailPart = class("ResearchDatabaseDetailPart", BasePartDetail)

function ResearchDatabaseDetailPart.PrefabName()
    return "ResearchDatabaseDetailPart"
end

function ResearchDatabaseDetailPart:_InitTransform()
    self.nullImage = self.transform:Find("Root/NullImage")

    self.databaseScrollContent = self.transform:Find("Root/DatabaseScroll/Viewport/Content")
    self.researchMaterialItem = self.transform:Find("Root/DatabaseScroll/Viewport/Content/ResearchMaterialItem").gameObject
end

--显示详情
function ResearchDatabaseDetailPart:Show(data)
    self.transform.localScale = Vector3.New(1,0,1)
    self.transform:DOScale(Vector3.one,BasePartDetail.static.OpenDetailPartTime):SetEase(BasePartDetail.static.OpenDetailPartEase)
    self:RefreshData(data)
    -- 监听获取科技资料仓库数据(研究所、推广公司)
    Event.AddListener("c_OnReceiveGetScienceStorageData",self.c_OnReceiveGetScienceStorageData,self)
end

-- 初始化的时候，监听事件
function  ResearchDatabaseDetailPart:_InitEvent()

end

function ResearchDatabaseDetailPart:_InitClick(mainPanelLuaBehaviour)

end

-- 销毁的时候，清除数据
function ResearchDatabaseDetailPart:_ResetTransform()
    if self.researchMaterialItems then
        for _, m in ipairs(self.researchMaterialItems) do
            destroy(m.prefab)
        end
    end
    self.researchMaterialItems = {}
end

-- 销毁的时候，清除事件
function ResearchDatabaseDetailPart:_RemoveEvent()
end

function ResearchDatabaseDetailPart:RefreshData(data)
    self.m_data = data

    -- 获取科技资料仓库数据(研究所、推广公司)
    DataManager.DetailModelRpcNoRet(self.m_data.info.id, 'm_ReqGetScienceStorageData')
    -- 监听使用研究资料的内容（_returnUse）
    -- 向服务器发消息查询当前资料库的内容
end

-- 销毁的时候，清除点击事件
function ResearchDatabaseDetailPart:_RemoveClick()

end

function ResearchDatabaseDetailPart:_ChildHide()
    -- 移除获取科技资料仓库数据(研究所、推广公司)
    Event.RemoveListener("c_OnReceiveGetScienceStorageData", self.c_OnReceiveGetScienceStorageData, self)
end

-- 查询到内容返回
function ResearchDatabaseDetailPart:_getDatabaseInfo(data)
    -- 如果有内容，显示内容，遍历data传入item里面显示ResearchMaterialItem   useType = 1
    -- self.researchMaterials = ResearchMaterialItem:new()
    -- 如果没有内容，显示空白页面
end

-- 使用返回监听
function ResearchDatabaseDetailPart:_returnUse(data)
    for i, v in ipairs(self.researchMaterials) do
        v.data = i -- 新的数据
        v:ShowView()
    end
end

function ResearchDatabaseDetailPart:c_OnReceiveGetScienceStorageData(scienceStorageData)
    self.scienceStorageData = scienceStorageData
    if self.researchMaterialItems then
        for _, m in ipairs(self.researchMaterialItems) do
            destroy(m.prefab)
        end
    end
    self.researchMaterialItems = {}
    if scienceStorageData.store and scienceStorageData.store[1] then
        self.nullImage.localScale = Vector3.zero
        for i, v in ipairs(scienceStorageData.store) do
            local go = ct.InstantiatePrefab(self.researchMaterialItem)
            local rect = go.transform:GetComponent("RectTransform")
            go.transform:SetParent(self.databaseScrollContent)
            rect.transform.localScale = Vector3.one
            rect.transform.localPosition = Vector3.zero
            go:SetActive(true)

            self.researchMaterialItems[i] = ResearchMaterialItem:new(go, v, 2, scienceStorageData.buildingId)
        end
    else
        self.nullImage.localScale = Vector3.one
    end
end
