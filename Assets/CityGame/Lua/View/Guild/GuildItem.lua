---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/2/19 11:23
---

GuildItem = class("GuildItem")

function GuildItem:initialize(prefab, data)
    self.prefab = prefab
    self.data = data

    local transform = prefab.transform
    self.leaderHeadBg = transform:Find("LeaderHeadBg")
    self.nameText = transform:Find("NameText"):GetComponent("Text")
    self.leaderNameText = transform:Find("LeaderNameText"):GetComponent("Text")
    self.memberNumberText = transform:Find("MemberNumberText"):GetComponent("Text")
    self.timeText = transform:Find("TimeText"):GetComponent("Text")
    self.introductionText = transform:Find("IntroductionText"):GetComponent("Text")
    self.applyBtn = transform:Find("ApplyBtn"):GetComponent("Button")

    self.nameText.text = self.data.name

    self.memberNumberText.text = self.data.allCount
    local timeTab = getFormatUnixTime(self.data.createTs/1000)
    self.timeText.text = string.format("%s/%s/%s", timeTab.day, timeTab.month, timeTab.year)
    self.introductionText.text = self.data.introduction

    PlayerInfoManger.GetInfos({data.chairmanId}, self._showNameHead, self)

    local societyId = DataManager.GetGuildID()
    if societyId then
        self.applyBtn.gameObject:SetActive(false)
    else
        self.applyBtn.gameObject:SetActive(true)
        self.applyBtn.onClick:RemoveAllListeners()
        self.applyBtn.onClick:AddListener(function ()
            self:_applyGuild()
        end)
    end
end

function GuildItem:_applyGuild()
    PlayMusEff(1002)
    local data = {}
    data.titleInfo = "REMINDER"
    data.tipInfo = "Please input Verification information!"
    data.inputInfo = ""
    data.btnCallBack = function(text)
        ct.log("tina_w8_friends", "向服务器发送加好友信息")
        DataManager.DetailModelRpcNoRet(OpenModelInsID.GuildListCtrl, 'm_JoinSociety', { id = self.data.id, desc = text })
    end
    ct.OpenCtrl("CommonDialogCtrl", data)
end

function GuildItem:_showNameHead(playerData)
    self.leaderNameText.text = playerData[1].name
    self.avatarData = AvatarManger.GetSmallAvatar(playerData[1].faceId, self.leaderHeadBg,0.2)
end

function GuildItem:CloseAvatar()
    if self.avatarData then
        AvatarManger.CollectAvatar(self.avatarData)
    end
end