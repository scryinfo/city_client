---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/8/31 10:55
---
require "Common/define"

GroundAuctionCtrl = {};
local this = GroundAuctionCtrl;

local groundAuctionBehaviour;
local gameObject;

--构建函数--
function GroundAuctionCtrl.New()
    return this;
end

--打开界面
function GroundAuctionCtrl.OpenPanel(elmData)
    this.elmData = elmData
    panelMgr:CreatePanel('GroundAuction', this.OnCreate, this);
end

--启动事件--
function GroundAuctionCtrl.OnCreate(obj)
    gameObject = obj;
    groundAuctionBehaviour = gameObject:GetComponent('LuaBehaviour');
    groundAuctionBehaviour:AddClick(GroundAuctionPanel.bidBtn.gameObject, this.BidGround);
    groundAuctionBehaviour:AddClick(GroundAuctionPanel.backBtn.gameObject, this.UnRegistGroundBid);

    GroundAuctionPanel.InitData(this.elmData)
    --如果已经开始拍卖，则向服务器发送打开了UI界面，开始接收拍卖信息
    if this.elmData.isStartBid then
        Event.Brocast("m_RegistGroundBidInfor");
    end
    Event.AddListener("c_BidInfoUpdate", this._bidInfoUpdate);  --拍卖信息更新
end

--出价--
function GroundAuctionCtrl.BidGround()
    local bidPrice = GroundAuctionPanel.bidInput.text;

    Event.Brocast("m_PlayerBidGround", this.elmData.id, bidPrice);
end

--正在拍卖中的地块关闭了界面 --停止接收拍卖价格的更新
function GroundAuctionCtrl.UnRegistGroundBid()
    if this.elmData.isStartBid then
        Event.Brocast("m_UnRegistGroundBidInfor");
    end
end

--拍卖信息更新
function GroundAuctionCtrl._bidInfoUpdate(data)
    GroundAuctionPanel.ChangeBidInfo(data)

    if data.id ~= this.elmData.id then
        local info = {}
        --self.titleInfo = titleInfo
        --self.contentInfo = contentInfo
        --self.tipInfo = tipInfo
        --self.btnCallBack = btnCallBack

        info.titleInfo = "CONGRATULATION";
        info.contentInfo = "Success!!!!";
        info.tipInfo = "lalalalalalalalla";
        info.btnCallBack = function ()
            log("cycle_w6_houseAndGround","[cycle_w6_houseAndGround] 回调啊回调")
        end;
        UIPage:ShowPage(BtnDialogPageCtrl, info)
    end
end

--出价失败
function GroundAuctionCtrl._bidFailFunc(data)

end

--关闭事件--
function GroundAuctionCtrl.Close()
    Event.RemoveListener("c_BidInfoUpdate", this._bidInfoUpdate);
    panelMgr:ClosePanel(CtrlNames.GroundAuction);
    destroy(gameObject);
end