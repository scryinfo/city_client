---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by cyz_scry.
--- DateTime: 2018/12/1 10:21
---
UnitTest.TestBlockStart()---------------------------------------------------------
--定义一个model基类
local ModelBase = class('ModelBase')
local ControllerBase = class('ControllerBase')

function ModelBase:initialize(name)
    self.name = name
end

function ControllerBase:initialize(name, newInsId)
    self.name = name
    self.insId = newInsId
end

--model类{
Model_1 = class('ModelBase')
function Model_1:testfun(arg_int1, arg_int2)
    log("wk16_abel_controller_model",'[ModelDerived_1:testfun] invoked! ')
    return #self.name+arg_int1+arg_int2
end

Model_2 = class('ModelBase')
function Model_2:testfun(arg_str)
    log("wk16_abel_controller_model",'[ModelDerived_2:testfun] invoked! ')
    return self.name..arg_str
end
--model类}

--model管理器类{
ModelManager = class('ModelManager')
function ModelBase:initialize(name)
    self.modelList = {}
end
function ModelManager.modelRpc(insId, modelMethord, ...,callback)
    local md = self.modelList[insId]
    if md ~= nil then
        local ret = md[modelMethord](...)
        if callback ~= nil then
            callback(ret)
        end
    end
end

--全局方法
function ct.model_rpc(insId, modelMethord, ...,callback)
    ModelManager.modelRpc(insId, modelMethord, ...,callback)
end
--model管理器类}

--controller类{
Crtl_1 = class('ControllerBase')
function Crtl_1:reqDatafun(arg_int1, arg_int2)
    ct.model_rpc(self.insId, 'testfun', arg_int1,arg_int2,function (retvalue)
        log('wk16_abel_controller_model', '[Crtl_1:reqDatafun] return: '..retvalue)
    end)
end

Crtl_2 = class('ControllerBase')
function Crtl_2:reqDatafun(arg_str)
    ct.model_rpc(self.insId, 'testfun', arg_str,function (retvalue)
        log('wk16_abel_controller_model', '[Crtl_2:reqDatafun] return: '..retvalue)
    end)
end
--controller类}


UnitTest.Exec("wk16_abel_controller_model", "test_wk16_abel_controller_model",  function ()
    --数据准备{
    local testlist = {}
    local testcount = 10000
    for i = 1, testcount do
        testlist[i] = Model_1.New(Model_1 ..i)
    end
    for i = testcount, testcount*2 do
        testlist[i] = Model_2.New(Model_2 ..i)
    end

    local pCrtl_1 = Crtl_1:New('Crtl_1_ins',1234)
    local pCrtl_2 = Crtl_2:New('Crtl_1_ins',11234)
    --数据准备}
    --测试{
    pCrtl_1:reqDatafun(1,2)
    pCrtl_2:reqDatafun('hello')

    ModelManager.modelRpc(ctr2_IdCache,'testfun', 1,2,function()

    end)

    --测试}
end)

UnitTest.TestBlockEnd()-----------------------------------------------------------