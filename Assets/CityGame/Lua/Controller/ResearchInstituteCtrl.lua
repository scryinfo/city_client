---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/7/22 16:57
---

ResearchInstituteCtrl = class("ResearchInstituteCtrl", UIPanel)
ResearchInstituteCtrl:ResgisterOpen(ResearchInstituteCtrl)

function ResearchInstituteCtrl:initialize()
    UIPanel.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function ResearchInstituteCtrl:bundleName()
    return "Assets/CityGame/Resources/View/ResearchInstitutePanel.prefab"
end

function ResearchInstituteCtrl:OnCreate(obj)
    UIPanel.OnCreate(self, obj)
end

function ResearchInstituteCtrl:Awake(go)
    local luaBehaviour = self.gameObject:GetComponent("LuaBehaviour")

    luaBehaviour:AddClick(ResearchInstitutePanel.bubbleMessageBtn, self.OpenBubbleMessage, self)
end

function ResearchInstituteCtrl:Active()
    UIPanel.Active(self)
end

function ResearchInstituteCtrl:Refresh()
    self:initializeData()
end

function ResearchInstituteCtrl:Hide()
    UIPanel.Hide(self)
end

---------------------------------------网络回调---------------------------------------
--进入查询研究所建筑信息
function ResearchInstituteCtrl:initializeData()
    if self.m_data then
        --向服务器请求建筑详情
        DataManager.OpenDetailModel(ResearchInstituteModel,self.m_data.insId)
        --DataManager.DetailModelRpcNoRet(self.m_data.insId, 'm_ReqOpenMaterial',self.m_data.insId)
    end
end

-- 收到回调， 刷新研究所信息
function ResearchInstituteCtrl:refreshResearchDataInfo(researchDataInfo)
    ResearchInstitutePanel.openBusinessItem:initData(researchDataInfo.info, BuildingType.Laboratory)  --初始化

    researchDataInfo.info.buildingType = BuildingType.Laboratory
    if panel.topItem ~= nil then
        panel.topItem:refreshData(researchDataInfo.info, function ()
            self:_clickCloseBtn(self)
        end)
    end

    --判断是自己还是别人打开了界面
    if researchDataInfo.info.ownerId ~= DataManager.GetMyOwnerID() then
        self.m_data.isOther = true
    else
        self.m_data.isOther = false
    end

    -- 判断是否是开业状态，是不是自己打开对应显示不同的界面
    self.groupMgr = BuildingInfoMainGroupMgr:new(MaterialFactoryPanel.groupTrans, self.materialBehaviour)
    self.groupMgr:AddParts(BuildingShelfPart,1)
    self.groupMgr:AddParts(TurnoverPart,0)
    self.groupMgr:AddParts(BuildingSalaryPart,0)
    self.groupMgr:AddParts(BuildingProductionPart,0)
    self.groupMgr:AddParts(BuildingWarehousePart,0)
    self.groupMgr:RefreshData(self.m_data)
    self.groupMgr:TurnOffAllOptions()
end

-------------------------------------按钮点击事件-------------------------------------
function ResearchInstituteCtrl:OpenBubbleMessage(go)
    PlayMusEff(1002)
    if go.m_data.info.id then
        ct.OpenCtrl("BubbleMessageCtrl", go.m_data.info)
    end
end