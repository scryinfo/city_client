---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/12/24 10:37
---土地交易详情界面
GroundTransState =
{
    None = 0,
    Sell = 1,
    Rent = 2
}

GroundTransDetailCtrl = class('GroundTransDetailCtrl',UIPage)
UIPage:ResgisterOpen(GroundTransDetailCtrl)

function GroundTransDetailCtrl:initialize()
    UIPage.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function GroundTransDetailCtrl:bundleName()
    return "GroundTransDetailPanel"
end

function GroundTransDetailCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)

    local groundAuctionBehaviour = obj:GetComponent('LuaBehaviour')
    groundAuctionBehaviour:AddClick(GroundTransDetailPanel.bgBtn.gameObject, self.BidGround, self)

end

function GroundTransDetailCtrl:Awake(go)
    --self.gameObject = go
    --UpdateBeat:Add(self._update, self)
end

function GroundTransDetailCtrl:Refresh()
    --Event.AddListener("c_BidInfoUpdate", self._bidInfoUpdate, self)  --拍卖信息更新
    self:_initPanelData()
end

function GroundTransDetailCtrl:Hide()
    Event.Brocast("c_ShowGroundBubble")

    self.startTimeDownForStart = false
    self.startTimeDownForFinish = false

    Event.RemoveListener("c_BidInfoUpdate", self._bidInfoUpdate, self)
    Event.RemoveListener("c_BidEnd", self._bidEnd, self)
    Event.RemoveListener("c_BidStart", self._bidStart, self)
    UIPage.Hide(self)
end

function GroundTransDetailCtrl:Close()
    --Event.RemoveListener("c_BidInfoUpdate", self._bidInfoUpdate, self)
    --Event.RemoveListener("c_NewGroundStartBid", self._changeToStartBidState, self)
end

---初始化
function GroundTransDetailCtrl:_initPanelData()
    if self.m_data and self.m_data.groundInfo then
        self:_setShowState(self.m_data.groundInfo)
    end
end
--根据状态显示界面
function GroundTransDetailCtrl:_setShowState(groundInfo)
    if not groundInfo.ownerId then  --判断是否有owner
        --显示标签icon，打开attribution界面，显示还未拍卖
        return
    end

    self.groundState = GroundTransState.None
    if groundInfo.rent then
        self.groundState = GroundTransState.Rent
    end
    if groundInfo.sell then
        self.groundState = GroundTransState.Sell
    end

    if groundInfo.ownerId == DataManager.GetMyOwnerID() then  --如果是自己打开
        --判断状态
        local tempPageType
        if self.groundState == GroundTransState.None then
            --显示可出租可出售状态
            return

        elseif self.groundState == GroundTransState.Sell then
            tempPageType = GroundTransState.Sell

            --显示selling按钮
        elseif self.groundState == GroundTransState.Rent then
            if groundInfo.renterId then  --是否已经租出去了
                --显示查看状态
                return
            end

            tempPageType = GroundTransState.Rent
            --显示renting按钮

        end
        if tempPageType == nil then
            return
        end
        local info = {groundInfo = groundInfo, groundState = self.groundState, showPageType = tempPageType}
        --打开设置租金/售卖金额界面，参数为info
        ct.OpenCtrl("GroundTransSetPriceCtrl", info)
    else
        --判断状态
        if self.groundState == GroundTransState.None then
            --显示标签icon，打开attribution界面，显示owner
        elseif self.groundState == GroundTransState.Sell then
            --显示selling按钮
        elseif self.groundState == GroundTransState.Rent then
            if groundInfo.renterId then
                if groundInfo.renterId == DataManager.GetMyOwnerID() then  --如果自己是租房子的人
                    --显示查看状态
                else
                    --显示标签icon，打开attribution界面，显示renter和owner
                end
            else
                --显示renting按钮
                --没有租出去，则可以点击按钮跳转到租的界面

            end
        end
    end
end
--按钮方法
function GroundTransDetailCtrl:_closeBtnFunc(ins)
    -- hide
end
--owner出租按钮
function GroundTransDetailCtrl:_rentFunc(ins)
    local info = {groundInfo = ins.m_data.groundInfo, groundState = ins.groundState, showPageType = GroundTransState.Rent}
    --打开设置租金/售卖金额界面，参数为info
    ct.OpenCtrl("GroundTransSetPriceCtrl", info)
end
--owner出售按钮
function GroundTransDetailCtrl:_sellFunc(ins)
    local info = {groundInfo = ins.m_data.groundInfo, groundState = ins.groundState, showPageType = GroundTransState.Sell}
    --打开设置租金/售卖金额界面，参数为info
    ct.OpenCtrl("GroundTransSetPriceCtrl", info)
end
--owner出售按钮
--function GroundTransDetailCtrl:_sellFunc(ins)
--    local info = {groundInfo = ins.m_data.groundInfo, groundState = ins.groundState, showPageType = GroundTransState.Sell}
--    --打开设置租金/售卖金额界面，参数为info
--    ct.OpenCtrl("GroundTransSetPriceCtrl", info)
--end