---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/3/30 11:07
---

BuildingInfoItem = class("BuildingInfoItem")

-- 初始化
function BuildingInfoItem:initialize(prefab, data)
    self.prefab = prefab
    self.data = data

    local transform = prefab.transform

    self.nameText = transform:Find("NameText"):GetComponent("Text")
    self.gradeImage = transform:Find("GradeImage")
    self.popularityGradeText = transform:Find("GradeImage/PopularityGradeText"):GetComponent("Text")
    self.qualityGradeText = transform:Find("GradeImage/QualityGradeText"):GetComponent("Text")

    self.buildingImage = transform:Find("BuildingImage"):GetComponent("Image")
    self.goBtn = transform:Find("GoBtn"):GetComponent("Button")

    self.goBtn.onClick:RemoveAllListeners()
    self.goBtn.onClick:AddListener(function ()
        self:_goPos()
    end)

    -- 名字
    self.nameText.text = string.format("%s's  %s", data.name, GetLanguage(PlayerBuildingBaseData[data.mId].typeName))

    -- 住宅、零售店才有品质、品牌评分
    local type = string.sub(tostring(data.mId), 1, 2)
    if type == "13" or type == "14" then
        self.gradeImage.localScale = Vector3.one
        self.popularityGradeText.text = data.brand
        self.qualityGradeText.text = data.quality
    else
        self.gradeImage.localScale = Vector3.zero
    end

    LoadSprite(BuildingIconConfig[data.mId], self.buildingImage, true)
end

-- 跳转到场景
function BuildingInfoItem:_goPos()
    UIPanel.ClosePage()
    local id = TerrainManager.GridIndexTurnBlockID(self.data.pos)
    local targetPos = TerrainManager.BlockIDTurnPosition(id)
    CameraMove.MoveCameraToPos(targetPos)
end