---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2018/11/28 15:15
---城市信息原料
CityMaterialCtrl = class('CityMaterialCtrl',UIPage)
UIPage:ResgisterOpen(CityMaterialCtrl) --注册打开的方法
local CityInfoCtrlBehaviour;
local gameObject;
local materialItems
local prafabItem = {}
local Items = {}

function  CityMaterialCtrl:bundleName()
    return "CityMaterialPanel"
end

function CityMaterialCtrl:initialize()
    UIPage.initialize(self,UIType.Normal,UIMode.HideOther,UICollider.None)--可以回退，UI打开后，隐藏其它面板
    --UIPage.initialize(self,UIType.Normal,UIMode.NeedBack,UICollider.None)--可以回退，UI打开后，不隐藏其它的UI
end

--启动事件--
function CityMaterialCtrl:OnCreate(obj)
    UIPage.OnCreate(self,obj)
    gameObject = obj;
    CityInfoCtrlBehaviour = self.gameObject:GetComponent('LuaBehaviour');
    CityInfoCtrlBehaviour:AddClick(CityMaterialPanel.backBtn,self.OnBackBtn,self);
    CityInfoCtrlBehaviour:AddClick(CityMaterialPanel.companyNumBtn,self.OnCompanyNumBtn,self);
    CityMaterialPanel.time.text = os.date("%m月".."\n".."%d");
    Event.AddListener("c_OnBtn",self.c_OnBtn,self)
end
function CityMaterialCtrl:Awake(go)
    self.gameObject = go
    materialItems = {}
    CityMaterialCtrl.CityMaterial = {}
    CityMaterialCtrl.CityMaterial = CityMaterial
    CityMaterialCtrl.static.luaBehaviour = self.gameObject:GetComponent('LuaBehaviour')

    self.material = UnityEngine.UI.LoopScrollDataSource.New()  --行情
    self.material.mProvideData = CityMaterialCtrl.static.MaterialProvideData
    self.material.mClearData = CityMaterialCtrl.static.MaterialClearData
    CityMaterialPanel.materialScroll:ActiveLoopScroll(self.material, #self.CityMaterial)

    --tableSort(test,CityMaterialPanel.cityName)

end

--返回按钮
function CityMaterialCtrl:OnBackBtn()
    UIPage.ClosePage();
end

--滑动互用
CityMaterialCtrl.static.MaterialProvideData = function(transform, idx)

    idx = idx + 1
   -- local id = CityMaterialPanel.content.transform.childCount
    local item = CityMaterialItem:new(CityMaterialCtrl.CityMaterial[idx], transform,idx)
    materialItems[idx] = item
--[[    for i = 1,  CityMaterialPanel.content.transform.childCount do
        prafabItem[i] = CityMaterialPanel.content.transform:GetChild(i-1);
    end
    for k, v in pairs(materialItems) do
        for i, j in pairs(prafabItem) do
            if v.data.name == prafabItem[i]:Find("cityinfoData/name/Text"):GetComponent("Text").text then
                v.id = i
                Items[k] = i
            end
        end
    end
    ct.log("system","人数不能为1111111111")]]
   -- materialItems[idx].line:SetActive(false)

end
CityMaterialCtrl.static.MaterialClearData = function(transform)
end

--点击参与公司人数排序
function CityMaterialCtrl:OnCompanyNumBtn(go)
    table.sort( go.CityMaterial, function (m, n) return m.companyNum > n.companyNum end)
    CityMaterialPanel.materialScroll:ActiveLoopScroll(go.material, #go.CityMaterial)
end

function CityMaterialCtrl:c_OnBtn(go)

    --  self.transform.sizeDelta.height = 130
    go.transform.sizeDelta = Vector2.New(1920,560)
    go.line:SetActive(true)
    --self.cityinfoData.sizeDelta.height = 0
    go.cityinfoData.offsetMin = Vector2.New(0,430)

    --[[    ct.log("system","人数不能为1111111111")
        CityMaterialPanel.content.enabled = false
        CityMaterialPanel.materialLoop.enabled = false
        go.line:SetActive( true)
        local b = Items[go.id ]
        for i =b+1, CityMaterialPanel.content.transform.childCount do
            local a = go.id
            a = a+1
            local temp = prafabItem[i].transform.anchoredPosition
            temp = temp + Vector2.New(0,-300);
            prafabItem[i].transform.anchoredPosition = temp
        end]]
end

--排序方法
--生成预制
function CityMaterialCtrl:_createCityInfoPab(path,parent)
    local prefab = UnityEngine.Resources.Load(path);
    local go = UnityEngine.GameObject.Instantiate(prefab);
    local rect = go.transform:GetComponent("RectTransform");
    go.transform:SetParent(parent.transform);
    rect.transform.localScale = Vector3.one;
    return rect
end
