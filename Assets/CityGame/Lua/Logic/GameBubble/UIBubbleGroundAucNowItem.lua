---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/11/21 15:47
---
UIBubbleGroundAucNowItem = class('UIBubbleGroundAucNowItem')
function UIBubbleGroundAucNowItem:initialize(data, viewRect)
    self.viewRect = viewRect
    self.data = data

    local viewTrans = self.viewRect
    self.soonTimeText = viewTrans:Find("bgBtn/timeDownRoot/soonTimeText"):GetComponent("Text")
    self.bgBtn = viewTrans:Find("bgBtn"):GetComponent("Button")

    self.collectBtn.onClick:RemoveAllListeners()
    self.collectBtn.onClick:AddListener(function ()
        self:_clickCollectBtn()
    end)
    self:_initData()
end

--初始化界面
function UIBubbleGroundAucNowItem:_initData()

end
--点击交易按钮
function UIBubbleGroundAucNowItem:_clickExchnageBtn()
    ct.OpenCtrl("ExchangeTransactionCtrl", self.data)
end

--Update
function UIBubbleGroundAucNowItem:Update()
    if self.startTimeDown then
        --倒计时
        local finishTime = self.data.beginTime + self.data.durationSec
        self.currentTime = self.currentTime or os.time()
        self.currentTime = self.currentTime + UnityEngine.Time.unscaledDeltaTime

        local remainTime = finishTime - self.currentTime
        if remainTime < 0 then
            self.startTimeDown = false
            self.data.elmObj.transform.localScale = Vector3.zero
            return
        end

        local timeTable = GameBubbleElm.FormatUnixTime(remainTime)
        local timeStr = timeTable.minute..":"..timeTable.second
        self.timeText.text = "拍卖结束倒计时："..timeStr

        if self.currentTime >= finishTime then
            self.startTimeDown = false
            self.data.elmObj.transform.localScale = Vector3.zero
            return
        end
    end

end

--把时间 秒转换成xx时xx分xx秒格式
function UIBubbleGroundAucNowItem.FormatUnixTime(time)
    local tb = {}
    tb.year = tonumber(os.date("%Y", time)) or 0;
    tb.month = tonumber(os.date("%m", time)) or 0;
    tb.day = tonumber(os.date("%d", time)) or 0;
    tb.hour = tonumber(os.date("%H", time)) or 0;
    tb.minute = tonumber(os.date("%M", time)) or 0;
    tb.second = tonumber(os.date("%S", time)) or 0;

    return tb
end