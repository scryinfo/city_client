---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2019/4/10/010 15:47
---
local pool={}
--临时对象池是做法
local  function InsAndObjectPool(config,class,prefabPath,parent,LuaBehaviour,this)
    if not pool[class] then
        pool[class]={}
    end
    --对象池创建物体
    local tempList={}
    for i, value in ipairs(config) do
        local ins =pool[class][1]
        if ins then  --有实例
            ins:updateData(value)
            value.id=i
            ins.prefab:SetActive(true)
            table.insert(tempList,ins)
            table.remove(pool[class],1)
        else--无实例
            local prefab=creatGoods(prefabPath,parent)
            value.id=i
            local ins=class:new(prefab,LuaBehaviour,value,this)
            table.insert(tempList,ins)
        end
    end
    --多余实例隐藏
    if #pool[class]>0 then
        for key, ins in ipairs(pool[class]) do
            ins.prefab:SetActive(false)
            table.insert(tempList,ins)
            pool[class][key]=nil
        end
    end
    --所有实例归还对象池
    for i, ins in ipairs(tempList) do
        table.insert(pool[class],ins)
    end
end
ResearchDetailPart = class('ResearchDetailPart', BasePartDetail)
local LuaBehaviour
local inventPrefab="View/Laboratory/InventGood"
---===================================================================================重写函数==============================================================================================

function ResearchDetailPart.PrefabName()
    return "ResearchDetailPart"
end
--
function ResearchDetailPart:_InitClick(mainPanelLuaBehaviour)
    LuaBehaviour=mainPanelLuaBehaviour
    mainPanelLuaBehaviour:AddClick(self.xBtn, self.OnXBtn, self)
    mainPanelLuaBehaviour:AddClick(self.goodsBtn.gameObject, self.onClick_good, self)
    mainPanelLuaBehaviour:AddClick(self.evaBtn.gameObject,self.onClick_eva, self)
    mainPanelLuaBehaviour:AddClick(self.setBtn.gameObject,self.onClick_set, self)

end
--
function ResearchDetailPart:RefreshData(data)
    if data == nil then
        return
    end
    self.m_data = data
    self:creatInvent()

    self:onClick_good(self)

end
--
function ResearchDetailPart:_InitTransform()
    local transform = self.transform
    self.xBtn = transform:Find("down/xBtn").gameObject
    self.goodsBtn = transform:Find("down/goods")
    self.evaBtn= transform:Find("down/eva")
    self.setBtn=transform:Find("down/set")


    self.inventGoodsRoot = transform:Find("down/bg/goodsRoot/Scroll/Viewport/Content")
    self.goodsRoot = transform:Find("down/bg/goodsRoot")
    self.evaRoot = transform:Find("down/bg/evaRoot")

end


---===================================================================================点击函数==============================================================================================
function ResearchDetailPart:OnXBtn(ins)
    ins.groupClass.TurnOffAllOptions(ins.groupClass)
end
--研究物品
function ResearchDetailPart:onClick_good(ins)
    ins:switchRoot(ins.goodsRoot)
    ins.type="good"
end
--研究eva
function ResearchDetailPart:onClick_eva(ins)
    ins:switchRoot(ins.evaRoot)
    ins.type="eva"
end
--设置
function ResearchDetailPart:onClick_set(ins)
    local data={ins = ins,func = function(Ins)
        local price = Ins.ctrl.price
        local count = Ins.ctrl.count
        local isopen = Ins.ctrl.isOpen
        DataManager.DetailModelRpcNoRet(LaboratoryCtrl.static.insId, 'm_labSettings',isopen)
        DataManager.DetailModelRpcNoRet(LaboratoryCtrl.static.insId, 'm_labSetting',price,count)
    end  }

   ct.OpenCtrl("InventSetPopCtrl",data)
end
---===================================================================================研究所业务逻辑==============================================================================================
function ResearchDetailPart:creatInvent()
    InsAndObjectPool(InventConfig,InventItem,inventPrefab,self.inventGoodsRoot,LuaBehaviour,self)
end
--切换Root
function ResearchDetailPart:switchRoot(panelTrans)
    if self.panelTrans then
        self.panelTrans.localScale = Vector3.zero
    end
    panelTrans.localScale = Vector3.one
    self.panelTrans=panelTrans
end

---===================================================================================释放==============================================================================================
function ResearchDetailPart:_RemoveClick()
    self.xBtn.onClick:RemoveAllListeners()
end
--
function ResearchDetailPart:_RemoveEvent()

end

