---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/2/14 17:27
---
GAucHistoryItem = class('GAucHistoryItem')
--GAucHistoryItem.static.NoRollColor = Vector3.New(22, 38, 94)  --没有成果时候的颜色

function GAucHistoryItem:initialize(data, viewRect)
    self.viewRect = viewRect

    local viewTrans = self.viewRect
    self.firstbg = viewTrans:Find("firstbg")
    self.protaitImg = viewTrans:Find("protaitRoot/bg/protaitImg"):GetComponent("Image")
    self.protaitBtn = viewTrans:Find("protaitRoot/protaitBtn"):GetComponent("Button")
    self.nameText = viewTrans:Find("nameText"):GetComponent("Text")
    self.firstTran = viewTrans:Find("first")
    self.firstPriceText = viewTrans:Find("first/firstPriceText"):GetComponent("Text")
    self.otherTran = viewTrans:Find("other")
    self.otherPriceText = viewTrans:Find("other/otherPriceText"):GetComponent("Text")
    self.protaitBtn.onClick:AddListener(function ()
        self:_clickProtaitFunc()
    end)

    Event.AddListener("c_GAucHistoryGetInfo", self._getInfo)

    self:_initData(data)
end
function GAucHistoryItem:_initData(data)
    self.data = data
    --self.nameText.text = ""
    if data.isFirst == true then
        self.firstbg.localScale = Vector3.one
        self.firstTran.localScale = Vector3.one
        self.otherTran.localScale = Vector3.zero
        self.firstPriceText.text = getPriceString(GetClientPriceString(data.price), 30, 24)
    else
        self.firstbg.localScale = Vector3.zero
        self.firstTran.localScale = Vector3.zero
        self.otherTran.localScale = Vector3.one
        self.otherPriceText.text = getPriceString(GetClientPriceString(data.price), 30, 24)
    end
end
--点击头像
function GAucHistoryItem:_clickProtaitFunc()
    if self.playerInfo == nil then
        return
    end
    ct.OpenCtrl("PersonalHomeDialogPageCtrl", self.playerInfo)
end
--拿到信息
function GAucHistoryItem:_getInfo(playerData)
    if playerData ~= nil and #playerData.info == 1 and playerData.info[1].id == self.data.id then
        local info = {}
        info.id = playerData.info[1].id
        info.name = playerData.info[1].name
        info.companyName = playerData.info[1].companyName
        info.des = playerData.info[1].des
        info.faceId = playerData.info[1].faceId
        info.male = playerData.info[1].male
        info.createTs = playerData.info[1].createTs
        self.playerInfo = info

        self.nameText.text = info.name
        LoadSprite(PlayerHead[info.faceId].GroundTransSmallPath, self.protaitImg, true)
    end
end

function GAucHistoryItem:close()
    self.data = nil
    self.playerInfo = nil
    self = nil
    Event.RemoveListener("c_GAucHistoryGetInfo", self._getInfo)
end