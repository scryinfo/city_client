---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/8/10 17:35
---城市信息Model
CityInfoModel = class("CityInfoModel",ModelBase)
local pbl = pbl

function CityInfoModel:initialize(insId)
    self.insId = insId
    self:OnCreate()
end

function CityInfoModel:OnCreate()
    DataManager.RegisterErrorNetMsg()
    --网络回调
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","eachTypeNpcNum","gs.EachTypeNpcNum",self.n_OnGetNpcNum,self) --npc类型数量
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","getPlayerAmount","gs.PlayerAmount",self.n_OnPlayerCountCurve,self) --玩家数量
    DataManager.ModelRegisterNetMsg(nil,"sscode.OpCode","queryIndustryIncome","ss.IndustryIncome",self.n_OnIndustryIncome,self)
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","querySupplyAndDemand","gs.SupplyAndDemand",self.n_OnSupplyAndDemand,self)
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","queryIndustryTopInfo","gs.IndustryTopInfo",self.n_OnIndustryTopInfo,self)
    DataManager.ModelRegisterNetMsg(nil,"sscode.OpCode","queryGroundOrApartmentAvgPrice","ss.AverageTransactionprice",self.n_OnAvgPrice,self)

end

function CityInfoModel:Close()
    --清空本地UI事件
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","eachTypeNpcNum","gs.EachTypeNpcNum",self.n_OnGetNpcNum,self)
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","getPlayerAmount","gs.PlayerAmount",self.n_OnPlayerCountCurve,self)
    DataManager.ModelRemoveNetMsg(nil,"sscode.OpCode","queryIndustryIncome","ss.IndustryIncome",self.n_OnIndustryIncome,self)
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","querySupplyAndDemand","gs.SupplyAndDemand",self.n_OnSupplyAndDemand,self)
    DataManager.ModelRemoveNetMsg(nil,"gscode.OpCode","queryIndustryTopInfo","gs.IndustryTopInfo",self.n_OnIndustryTopInfo,self)
    DataManager.ModelRemoveNetMsg(nil,"sscode.OpCode","queryGroundOrApartmentAvgPrice","ss.AverageTransactionprice",self.n_OnAvgPrice,self)

end
--客户端请求--

--获取npc数量
function CityInfoModel:m_GetNpcNum()
    local msgId = pbl.enum("gscode.OpCode","eachTypeNpcNum")
    CityEngineLua.Bundle:newAndSendMsg(msgId,nil)
end

--获取玩家数量
function CityInfoModel:m_GetPlayerNum()
    local msgId = pbl.enum("gscode.OpCode","getPlayerAmount")
    CityEngineLua.Bundle:newAndSendMsg(msgId,nil)
end

--查询行业收入
function CityInfoModel:m_queryIndustryIncome()
    local msgId = pbl.enum("sscode.OpCode","queryIndustryIncome")
    CityEngineLua.Bundle:newAndSendMsgExt(msgId, nil, CityEngineLua._tradeNetworkInterface1)
end

--查詢行业供需
function CityInfoModel:m_querySupplyAndDemand(type)
    DataManager.ModelSendNetMes("gscode.OpCode", "querySupplyAndDemand","gs.SupplyAndDemand",{type = type})
end

--查询行业排行
function CityInfoModel:m_queryIndustryTopInfo(ownerId,type)
    DataManager.ModelSendNetMes("gscode.OpCode", "queryIndustryTopInfo","gs.QueryIndustry",{pid = ownerId,type = type})
end

--查询成交均价
function CityInfoModel:m_queryAvgPrice(bool)
    local msgId = pbl.enum("sscode.OpCode","queryGroundOrApartmentAvgPrice")
    local lMsg = { b = bool }
    local pMsg = assert(pbl.encode("gs.Bool", lMsg))
    CityEngineLua.Bundle:newAndSendMsgExt(msgId, pMsg, CityEngineLua._tradeNetworkInterface1)
end

--服务器回调

--npc类型数量
function CityInfoModel:n_OnGetNpcNum(info)
    DataManager.ControllerRpcNoRet(self.insId,"CityInfoCtrl", 'c_NpcNum',info)
end

--玩家数量
function CityInfoModel:n_OnPlayerCountCurve(lMsg)
    DataManager.ControllerRpcNoRet(self.insId,"CityInfoCtrl", 'c_PlayerNum',lMsg.playerAmount)
end

--行业收入
function CityInfoModel:n_OnIndustryIncome(info)
    DataManager.ControllerRpcNoRet(self.insId,"CityInfoCtrl", '_receiveIndustryIncome',info)
end

--行业供需
function CityInfoModel:n_OnSupplyAndDemand(info)
    DataManager.ControllerRpcNoRet(self.insId,"CityInfoCtrl", '_receiveSupplyAndDemand',info)
end

--行业排行
function CityInfoModel:n_OnIndustryTopInfo(info)
    DataManager.ControllerRpcNoRet(self.insId,"CityInfoCtrl", '_receiveIndustryTopInfo',info)
end

--成交均价
function CityInfoModel:n_OnAvgPrice(info)
    DataManager.ControllerRpcNoRet(self.insId,"CityInfoCtrl", '_receiveAvgPrice',info)
end

