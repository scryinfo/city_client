---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/2/14 17:27
---
MapGAucHistoryItem = class('MapGAucHistoryItem')

function MapGAucHistoryItem:initialize(data, viewRect)
    self.viewRect = viewRect

    local viewTrans = self.viewRect.transform
    self.portraitTran = viewTrans:Find("portraitRoot/bg")
    self.portraitBtn = viewTrans:Find("portraitRoot/portraitBtn"):GetComponent("Button")
    self.nameText = viewTrans:Find("nameText"):GetComponent("Text")
    self.priceText = viewTrans:Find("priceText"):GetComponent("Text")
    self.otherTran = viewTrans:Find("otherBg")
    self.portraitBtn.onClick:AddListener(function ()
        self:_clickProtaitFunc()
    end)

    self:_initData(data)
end
function MapGAucHistoryItem:_initData(data)
    self.data = data
    if data.isFirst == true then
        self.otherTran.localScale = Vector3.zero
    else
        self.otherTran.localScale = Vector3.one
    end
    self.priceText.text = GetClientPriceString(data.price)
    if data.biderId ~= nil then
        PlayerInfoManger.GetInfos({[1] = data.biderId}, self._getInfo, self)
    end
end
--Click on the avatar
function MapGAucHistoryItem:_clickProtaitFunc()
    if self.playerInfo == nil then
        return
    end
    ct.OpenCtrl("PersonalHomeDialogPageCtrl", self.playerInfo)
end
--Get information
function MapGAucHistoryItem:_getInfo(data)
    local playerData = data[1]
    if playerData ~= nil and playerData.id == self.data.biderId then
        self.playerInfo = playerData
        self.nameText.text = playerData.name
        self.avatar = AvatarManger.GetSmallAvatar(playerData.faceId, self.portraitTran,0.2)
    end
end

function MapGAucHistoryItem:close()
    if self.avatar ~= nil then
        AvatarManger.CollectAvatar(self.avatar)
    end
    Event.Brocast("c_ReturnGAucHistoryObj", self.viewRect.gameObject)  --Recycle item
    self.data = nil
    self.playerInfo = nil
    self = nil
end