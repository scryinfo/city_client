---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2018/11/28 16:27
---
CityMaterialItem = class('CityMaterialItem')
--初始化方法
function CityMaterialItem:initialize(data, viewRect,id,iconTable,LineData)

    self. isoppen = false
    self.viewRect = viewRect
    self.data = data
    self.num = data.companyNum
    self.id = id
    self.MaterialData = iconTable
    self.LineData = LineData
   -- local luaCom = CityLuaUtil.AddLuaComponent( self.viewRect.gameObject,'View/Logic/test_cityInfo')
    --self:_initData()
    local viewTrans = self.viewRect

    self.transform = viewTrans:GetComponent("RectTransform")
    self.cityInfoData = viewTrans:Find("cityinfoData"):GetComponent("GridSort")
    self.sign = viewTrans:Find("GameObject/Sign"):GetComponent("GridSort")self.element = viewTrans:GetComponent("LayoutElement")
    self.change = viewTrans:GetComponent("ChangePreferredHeight")
    self.btn = viewTrans:Find("cityinfoData"):GetComponent("Button")
    self.lineBtn = viewTrans:Find("GameObject/Button"):GetComponent("Button")
    self.line = viewTrans:Find("GameObject/LineChartPanel/Image/Scroll View/Viewport/Content/GameObject"):GetComponent("LineChart");
    self.gameObject = viewTrans:Find("GameObject").gameObject

    self.prefabs = {}
    if  self.cityInfoData.transform.childCount == 0 then
       local item =  tableSort(self.MaterialData, self.cityInfoData)
        local a = 1
        for i, v in ipairs(self.data) do
            item[a].transform:Find("Text"):GetComponent("Text").text = v
            a = a+1
        end
        tableSort(MaterialCurve,self.sign)
    else
        for i = 1,  self.cityInfoData.transform.childCount do
             self.prefabs[i] = self.cityInfoData.gameObject:GetComponent("RectTransform"):GetChild(i-1)
        end
        local a = 1
        for i, v in ipairs(self.data) do
            self.prefabs[a].transform:Find("Text"):GetComponent("Text").text = v
            a = a+1
        end
    end

    self.transform.sizeDelta = Vector2.New(1920,130)
    self.change:Change(self.element,130)
    self.gameObject:SetActive(false)
    local verts={
        Vector2.New(0.0, 0.4),
        Vector2.New(0.10, 0.3),
        Vector2.New(0.15, 0.2),
        Vector2.New(0.20, 0.1),
        Vector2.New(0.25, 0.2),
        Vector2.New(0.30, 0.3),
        Vector2.New(0.35, 0.4),
        Vector2.New(0.40, 0.5),
        Vector2.New(0.45, 0.6),
        Vector2.New(0.50, 0.7),
        Vector2.New(0.55, 0.8),
        Vector2.New(0.60, 0.3),
        Vector2.New(0.65, 0.4),
        Vector2.New(0.70, 0.5),
        Vector2.New(0.75, 0.6),
        Vector2.New(0.80, 0.7),
        Vector2.New(0.85, 0.8),
        Vector2.New(0.90, 0.6),
        Vector2.New(0.95, 0.7),
        Vector2.New(1.00, 0.6),
    }
    local verts1={
        Vector2.New(0.0, 0.1),
        Vector2.New(0.10, 0.1),
        Vector2.New(0.15, 0.3),
        Vector2.New(0.20, 0.2),
        Vector2.New(0.25, 0.4),
        Vector2.New(0.30, 0.6),
        Vector2.New(0.35, 0.8),
        Vector2.New(0.40, 0.4),
        Vector2.New(0.45, 0.2),
        Vector2.New(0.50, 0.3),
        Vector2.New(0.55, 0.8),
        Vector2.New(0.60, 0.9),
        Vector2.New(0.65, 0.3),
        Vector2.New(0.70, 0.3),
        Vector2.New(0.75, 0.4),
        Vector2.New(0.80, 0.7),
        Vector2.New(0.85, 0.9),
        Vector2.New(0.90, 0.2),
        Vector2.New(0.95, 0.8),
        Vector2.New(1.00, 0.1),
    }

    self.line :InjectDatas(verts,Color.New(1,1,1,1))
    self.line:InjectDatas(verts1,Color.New(0,1,0,1))

    self.btn.onClick:AddListener(function ()
        self:_OnBtn()
    end)
    self.lineBtn.onClick:AddListener(function ()
        self:_OnLineBtn(self)
    end)
end

--初始化界面
function CityMaterialItem:_initData()

    local data = self.data
    CityMaterialItem. MaterialData = {}
    CityMaterialItem. MaterialData = {
        [1] = {
            ["data"] = data.name,
            ["space"] = 2,
            ["size"] = 30,
            ["width"] = 0,
            ["path"] = "View/CityInfoItem/Image",
            ["color"] = {r = 255, b = 255, g = 255, a = 255},
            ["itemPath"] = "CityInfo/0001",
            ["itemColor"] = {r = 255, b = 255, g = 255, a = 255},
        }, [2] = {
            ["data"] = data.companyNum,
            ["space"] = 2,
            ["size"] = 30,
            ["width"] = 0,
            ["path"] = "View/CityInfoItem/Image1",
            ["color"] = {r = 255, b = 255, g = 255, a = 255},
            ["itemPath"] = "",
            ["itemColor"] = {r = 255, b = 255, g = 255, a = 255},
        },[3] = {
            ["data"] = data.staffNum,
            ["space"] = 2,
            ["size"] = 30,
            ["width"] = 0,
            ["path"] = "View/CityInfoItem/Image1",
            ["color"] = {r = 255, b = 255, g = 255, a = 255},
            ["itemPath"] = "",
            ["itemColor"] = {r = 255, b = 255, g = 255, a = 255},
        },[4] = {
            ["data"] = data.stocks,
            ["space"] = 2,
            ["size"] = 30,
            ["width"] = 0,
            ["path"] = "View/CityInfoItem/Image1",
            ["color"] = {r = 255, b = 255, g = 255, a = 255},
            ["itemPath"] = "",
            ["itemColor"] = {r = 255, b = 255, g = 255, a = 255},
        },[5] = {
            ["data"] = data.dayProduction,
            ["space"] = 2,
            ["size"] = 30,
            ["width"] = 0,
            ["path"] = "View/CityInfoItem/Image1",
            ["color"] = {r = 255, b = 255, g = 255, a = 255},
            ["itemPath"] = "",
            ["itemColor"] = {r = 255, b = 255, g = 255, a = 255},
        },[6] = {
            ["data"] = data.averagePrice,
            ["space"] = 2,
            ["size"] = 30,
            ["width"] = 0,
            ["path"] = "View/CityInfoItem/Image1",
            ["color"] = {r = 255, b = 255, g = 255, a = 255},
            ["itemPath"] = "",
            ["itemColor"] = {r = 255, b = 255, g = 255, a = 255},
        },[7] = {
            ["data"] = data.totalProfit,
            ["space"] = 2,
            ["size"] = 30,
            ["width"] = 0,
            ["path"] = "View/CityInfoItem/Image1",
            ["color"] = {r = 255, b = 255, g = 255, a = 255},
            ["itemPath"] = "",
            ["itemColor"] = {r = 255, b = 255, g = 255, a = 255},
        },[8] = {
            ["data"] = data.totalProfitAdd,
            ["space"] = 2,
            ["size"] = 30,
            ["width"] = 0,
            ["path"] = "View/CityInfoItem/Image1",
            ["color"] = {r = 255, b = 255, g = 255, a = 255},
            ["itemPath"] = "",
            ["itemColor"] = {r = 255, b = 255, g = 255, a = 255},
        },
    }

end

function CityMaterialItem:_OnBtn()

    Event.Brocast("c_OnBtn",self,not self. isoppen)
    self. isoppen = not self. isoppen

end
--点击曲线Button
function CityMaterialItem:_OnLineBtn(go)
    ct.log("system","111111212122121")
    ct.OpenCtrl("CityinfoSurveyCtrl",go.LineData)
end