---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/8/13 10:39
---City Information titleItem
CityInfoTitleItem = class('CityInfoTitleItem')
local lastBg
local titleGoodsItem = {}
local titleInfoItem = {}
local prefabs = {}

--Initialization method data (read configuration table)
function CityInfoTitleItem:initialize(inluabehaviour, prefab, goodsDataInfo,msg)
    self.prefab = prefab;
    self.goodsDataInfo = goodsDataInfo;
    self._luabehaviour = inluabehaviour
    self.msg = msg
    self.id = goodsDataInfo.id
    self.type = goodsDataInfo.type

    self.notSelect = self.prefab.transform:Find("notSelectBg").gameObject
    self.notSelectText = self.prefab.transform:Find("notSelectBg/Text"):GetComponent("Text");
    self.select = self.prefab.transform:Find("selectBg")
    self.selectText = self.prefab.transform:Find("selectBg/Text"):GetComponent("Text");

    self.notSelect.transform.localScale = Vector3.one
    self.select.localScale = Vector3.zero

    self.notSelectText.text = GetLanguage(goodsDataInfo.name)
    self.selectText.text = GetLanguage(goodsDataInfo.name)

    self._luabehaviour:AddClick(self.notSelect, self.OnNotSelect, self);
    self._luabehaviour:AddClick(CityInfoPanel.evaTechnologyBtn, self.OnEvaTechnologyBtn, self);
    self._luabehaviour:AddClick(CityInfoPanel.evaAdvertisingBtn, self.OnEvaAdvertisingBtn, self);
end

function CityInfoTitleItem:OnNotSelect(go)
    if lastBg then
        lastBg.notSelect.transform.localScale = Vector3.one
        lastBg.select.localScale = Vector3.zero
    end
    go.notSelect.transform.localScale = Vector3.zero
    go.select.localScale = Vector3.one
    lastBg = go

    go:ShowPanel(go)
end

-- Click on Eva Technology
function CityInfoTitleItem:OnEvaTechnologyBtn(go)
    DataManager.DetailModelRpcNoRet(go.msg.msg.m_data.insId, 'm_queryEvaGrade',go.type,go.type,2)
    CityInfoPanel.evaTechnologyBtn.transform.localScale = Vector3.zero
    CityInfoPanel.evaAdvertisingBtn.transform.localScale = Vector3.one
end

-- Click Eva Promotion
function CityInfoTitleItem:OnEvaAdvertisingBtn(go)
    DataManager.DetailModelRpcNoRet(go.msg.msg.m_data.insId, 'm_queryEvaGrade',go.type,go.type,1)
    CityInfoPanel.evaTechnologyBtn.transform.localScale = Vector3.one
    CityInfoPanel.evaAdvertisingBtn.transform.localScale = Vector3.zero
end

function CityInfoTitleItem:SetLast(ins)
    lastBg = ins
end

function CityInfoTitleItem:GetLast()
    return lastBg
end

function CityInfoTitleItem:ShowPanel(data)
    CityInfoPanel.four.gameObject:SetActive(false)
    CityInfoPanel.five.gameObject:SetActive(false)
    CityInfoPanel.six.gameObject:SetActive(false)
    if data.id == 1 then
        DataManager.DetailModelRpcNoRet(data.msg.msg.m_data.insId, 'm_querySupplyAndDemand',data.type)  --Check industry supply and demand
        CityInfoPanel.supplyDemandSum.text = GetLanguage(45010013)
        CityInfoPanel.supplyDemandBg.localScale = Vector3.one
        CityInfoPanel.twoContent:SetActive(false)
        CityInfoPanel.rankList.localScale = Vector3.zero
        CityInfoPanel.twoContent:SetActive(false)
        CityInfoPanel.threeRank:SetActive(false)
        CityInfoPanel.shelves.localScale = Vector3.one
        CityInfoPanel.purchases.localScale = Vector3.one
        CityInfoPanel.eva.localScale = Vector3.zero
    elseif data.id == 2 then
        DataManager.DetailModelRpcNoRet(data.msg.msg.m_data.insId, 'm_queryIndustryTopInfo',data.msg.msg.ownerId,data.type)  --Check revenue ranking
        CityInfoPanel.supplyDemandBg.localScale = Vector3.zero
        CityInfoPanel.twoContent:SetActive(false)
        CityInfoPanel.threeRank:SetActive(false)
        CityInfoPanel.rankList.localScale = Vector3.one
        CityInfoPanel.twoContent:SetActive(false)
        if data.type == 20 then
            CityInfoPanel.four.gameObject:SetActive(true)
        elseif data.type ==11 or data.type ==15 or data.type ==16 then
            CityInfoPanel.five.gameObject:SetActive(true)
        elseif data.type ==12 or data.type ==13 or data.type ==14 then
            CityInfoPanel.six.gameObject:SetActive(true)
        end
    elseif data.id == 3 then            --Details
        DataManager.DetailModelRpcNoRet(data.msg.msg.m_data.insId, 'm_queryItemSales',data.type,data.goodsDataInfo.inside[1].itemId)  --Check turnover
        CityInfoPanel.productIcon.sprite = SpriteManager.GetSpriteByPool(data.goodsDataInfo.inside[1].itemId)
        CityInfoPanel.productText.text = GetLanguage(data.goodsDataInfo.inside[1].name)
        if data.goodsDataInfo.inside[1].date then
            if #prefabs < #data.goodsDataInfo.inside[1].date then
                for i = 1, #data.goodsDataInfo.inside[1].date - #prefabs do
                    local temp = createPrefabs(CityInfoPanel.productTitleInfoItem,CityInfoPanel.productContent)
                    table.insert(prefabs,temp)
                end
            elseif #prefabs > #data.goodsDataInfo.inside[1].date then
                for i = 1, #prefabs - #data.goodsDataInfo.inside[1].date do
                    destroy(prefabs[#prefabs].gameObject)
                    table.remove(prefabs)
                end
            end
            for i, v in ipairs(data.goodsDataInfo.inside[1].date) do
                titleInfoItem[i] = TitleInfoItem:new(self._luabehaviour,prefabs[i],v,data.goodsDataInfo.inside[1].itemId,data.type,data.msg.msg.m_data.insId)
            end
            titleInfoItem[1]:ShowPanel(titleInfoItem[1])
        end
        CityInfoPanel.twoContent:SetActive(true)
        CityInfoPanel.supplyDemandBg.localScale = Vector3.zero
        CityInfoPanel.rankList.localScale = Vector3.zero
        self:Close()
        if data.type == 11 then
            local material = DataManager.GetMaterial()
            local dataInfo = {}
            for i, v in ipairs(material) do
                dataInfo[i] = {}
                dataInfo[i].name = v
                dataInfo[i].itemId = v
                dataInfo[i].date = {
                    [1] ={
                        name = 45020017,
                        id = 1,
                    },
                    [2] ={
                        name = 45020033,
                        id = 2,
                    },
                    [3] ={
                        name = 45020018,
                        id = 3,
                    },
                    [4] ={
                        name = 45020019,
                        id = 4,
                    },
                    [5] ={
                        name = 45020020,
                        id = 5,
                    },
                }
            end
            for i, v in ipairs(dataInfo) do
                local prefab = createPrefabs(CityInfoPanel.productsListTitleGoodsItem,CityInfoPanel.productsListContent)
                titleGoodsItem[i] = TitleGoodsItem:new(self._luabehaviour,prefab,v,self,titleInfoItem,data.type,data.msg.msg.m_data.insId)
            end
            titleGoodsItem[1].bg.color = getColorByInt(225,233,255,255)
            titleGoodsItem[1]:SetLast(titleGoodsItem[1].bg)
        elseif data.type == 12 or data.type == 13 then
            local goods = DataManager.GetGoods()
            local dataInfo = {}
            for i, v in ipairs(goods) do
                dataInfo[i] = {}
                dataInfo[i].name = v
                dataInfo[i].itemId = v
                dataInfo[i].date = {
                    [1] ={
                        name = 45020017,
                        id = 1,
                    },
                    [2] ={
                        name = 45020033,
                        id = 2,
                    },
                    [3] ={
                        name = 45020018,
                        id = 3,
                    },
                    [4] ={
                        name = 45020019,
                        id = 4,
                    },
                    [5] ={
                        name = 45020020,
                        id = 5,
                    },
                }
            end
            for i, v in ipairs(dataInfo) do
                local prefab = createPrefabs(CityInfoPanel.productsListTitleGoodsItem,CityInfoPanel.productsListContent)
                titleGoodsItem[i] = TitleGoodsItem:new(self._luabehaviour,prefab,v,self,titleInfoItem,data.type,data.msg.msg.m_data.insId)
            end
            titleGoodsItem[1].bg.color = getColorByInt(225,233,255,255)
            titleGoodsItem[1]:SetLast(titleGoodsItem[1].bg)
        else
            if data.goodsDataInfo.inside then
                for i, v in ipairs(data.goodsDataInfo.inside) do
                    local prefab = createPrefabs(CityInfoPanel.productsListTitleGoodsItem,CityInfoPanel.productsListContent)
                    titleGoodsItem[i] = TitleGoodsItem:new(self._luabehaviour,prefab,v,self,titleInfoItem,data.type,data.msg.msg.m_data.insId)
                end
                titleGoodsItem[1].bg.color = getColorByInt(225,233,255,255)
                titleGoodsItem[1]:SetLast(titleGoodsItem[1].bg)
            end
        end
    elseif data.id == 4 then
        DataManager.DetailModelRpcNoRet(data.msg.msg.m_data.insId, 'm_queryEvaGrade',data.type,data.type,2)  --Get Eva distribution
        CityInfoPanel.supplyDemandBg.localScale = Vector3.one
        CityInfoPanel.twoContent:SetActive(false)
        CityInfoPanel.threeRank:SetActive(false)
        CityInfoPanel.rankList.localScale = Vector3.zero
        CityInfoPanel.shelves.localScale = Vector3.zero
        CityInfoPanel.purchases.localScale = Vector3.zero
        CityInfoPanel.eva.localScale = Vector3.one
        CityInfoPanel.evaTechnologyBtn.transform.localScale = Vector3.zero
        CityInfoPanel.evaAdvertisingBtn.transform.localScale = Vector3.one
    elseif data.id == 5 then
        local bool
        if data.type == 14 then
            bool = true
        elseif data.type == 20 then
            bool = false
        end
        DataManager.DetailModelRpcNoRet(data.msg.msg.m_data.insId, 'm_queryAvgPrice',bool)  --Check average transaction price
        CityInfoPanel.supplyDemandSum.text = GetLanguage(45020030)
        CityInfoPanel.supplyDemandBg.localScale = Vector3.one
        CityInfoPanel.twoContent:SetActive(false)
        CityInfoPanel.threeRank:SetActive(false)
        CityInfoPanel.rankList.localScale = Vector3.zero
        CityInfoPanel.shelves.localScale = Vector3.zero
        CityInfoPanel.purchases.localScale = Vector3.zero
        CityInfoPanel.eva.localScale = Vector3.zero
    end
end

function CityInfoTitleItem:Close()
    if next(titleGoodsItem) then
        for i, v in pairs(titleGoodsItem) do
            destroy(v.prefab.gameObject)
        end
        titleGoodsItem[1]:Close()
        titleGoodsItem = {}
    end
end