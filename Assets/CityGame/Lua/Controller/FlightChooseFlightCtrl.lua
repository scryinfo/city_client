---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/9/21 10:35
---

FlightChooseFlightCtrl = class('FlightChooseFlightCtrl',UIPanel)
UIPanel:ResgisterOpen(FlightChooseFlightCtrl)

function FlightChooseFlightCtrl:initialize()
    UIPanel.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function FlightChooseFlightCtrl:bundleName()
    return "Assets/CityGame/Resources/View/FlightChooseFlightPanel.prefab"
end

function FlightChooseFlightCtrl:OnCreate(obj)
    UIPanel.OnCreate(self, obj)
end

function FlightChooseFlightCtrl:Awake(go)
    self.gameObject = go
    local behaviour = self.gameObject:GetComponent('LuaBehaviour')
    behaviour:AddClick(FlightChooseFlightPanel.backBtn.gameObject, function ()
        self:backFunc()
    end , self)

    self.scrollEvent = VScrollEventData.New()
    self.scrollEvent.mProvideData = FlightChooseFlightCtrl.static.ProvideFunc
    self.scrollEvent.mClearData = FlightChooseFlightCtrl.static.ClearFunc
    FlightChooseFlightPanel.scrollLoop:InitComponent(self.scrollEvent)
end
--
FlightChooseFlightCtrl.static.ProvideFunc = function(transform, idx)
    idx = idx + 1
    local item = ChooseFlightItem:new(transform, FlightChooseFlightCtrl.listValue[idx])
    FlightChooseFlightCtrl.static.itemsList[idx] = item
end
--
FlightChooseFlightCtrl.static.ClearFunc = function(transform) end
--
function FlightChooseFlightCtrl:Refresh()
    self:_initData()
end
--
function FlightChooseFlightCtrl:Active()
    UIPanel.Active(self)
    self:_language()
end
--
function FlightChooseFlightCtrl:Hide()
    UIPanel.Hide(self)
end
--
function FlightChooseFlightCtrl:_initData()
    if self.m_data ~= nil then
        local flightData = self.m_data[1]
        FlightChooseFlightPanel.timeText.text = self:_getDayStr(flightData.FlightDeptimePlanDate)  --计划起飞时间
        --FlightChooseFlightPanel.flightText.text = flightData.FlightCompany  --需要多语言
        --FlightChooseFlightPanel.numText.text = flightData.FlightNo  --CA4506
        FlightChooseFlightPanel.endCodeText.text = flightData.FlightArrcode
        FlightChooseFlightPanel.endPlaceText.text = flightData.FlightArrAirport  --需要多语言
        FlightChooseFlightPanel.startCodeText.text = flightData.FlightDepcode
        FlightChooseFlightPanel.startPlaceText.text = flightData.FlightDepAirport  --需要多语言
        self:_updateText()

        FlightChooseFlightCtrl.static.itemsList = {}
        FlightChooseFlightCtrl.listValue = self.m_data
        FlightChooseFlightPanel.scrollLoop:InitData(#self.m_data)
    end
end
--
function FlightChooseFlightCtrl:_updateText()
    local str2 = FlightChooseFlightPanel.endPlaceText.text
    FlightChooseFlightPanel.endPlaceText.text = ct.getFlightSubString(str2, 42, 24)
    local str3 = FlightChooseFlightPanel.startPlaceText.text
    FlightChooseFlightPanel.startPlaceText.text = ct.getFlightSubString(str3, 42, 24)
end
--获得2019-05-01格式的时间
function FlightChooseFlightCtrl:_getDayStr(str)
    if str == nil or str == "" then
        return "--"
    end
    local temp = string.sub(str, 1, 10)
    return temp
end
--
function FlightChooseFlightCtrl:cleanItemList()
    if FlightChooseFlightCtrl.static.itemsList == nil then
        return
    end
    for i, value in pairs(FlightChooseFlightCtrl.static.itemsList) do
        value:Close()
    end
end
--
function FlightChooseFlightCtrl:_language()
    FlightChooseFlightPanel.titleText01.text = GetLanguage(32020005)
    FlightChooseFlightPanel.valueText02.text = GetLanguage(32020006)
    FlightChooseFlightPanel.valueText03.text = GetLanguage(32020007)
    FlightChooseFlightPanel.valueText04.text = GetLanguage(32020008)
    FlightChooseFlightPanel.valueText05.text = GetLanguage(32020009)
    FlightChooseFlightPanel.valueText06.text = GetLanguage(32020010)
    FlightChooseFlightPanel.valueText07.text = GetLanguage(32020011)
end
--
function FlightChooseFlightCtrl:backFunc()
    self:cleanItemList()
    FlightChooseFlightPanel.scrollLoop:CleanAll()
    PlayMusEff(1002)
    UIPanel.ClosePage()
end