---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/4/18 16:03
---

BuildingUpperItem = class('BuildingUpperItem')
BuildingUpperItem.static.NameColor = "#FFD562" -- Building name color
BuildingUpperItem.static.BuildingTypeColor = "#EFEFEF" -- Building type color

--Initialization method
function BuildingUpperItem:initialize(viewRect)
    self.viewRect = viewRect

    self.backBtn = self.viewRect.transform:Find("BackBtn"):GetComponent("Button")
    self.buildingNameText = self.viewRect.transform:Find("TitleBg/BuildingTypeNameText"):GetComponent("Text")
    self.titleBgBtn = self.viewRect.transform:Find("TitleBg"):GetComponent("Button")
    self.nameText = self.viewRect.transform:Find("TitleBg/NameText"):GetComponent("Text")
    self.peopleNumberText = self.viewRect.transform:Find("RightBg/PeopleNumberText"):GetComponent("Text")
    self.viewsText = self.viewRect.transform:Find("RightBg/ViewsText"):GetComponent("Text")
    self.gradeBg = self.viewRect.transform:Find("TitleBg/GradeBg")
    self.gradeText = self.viewRect.transform:Find("TitleBg/GradeBg/GradeText"):GetComponent("Text")

    self.backBtn.onClick:AddListener(function ()
        if self.closeCallBack ~= nil then
            self.closeCallBack()
        end
    end)

    self.titleBgBtn.onClick:AddListener(function ()
        --Event.Brocast("c_openBuildingInfo",self.data)
        ct.OpenCtrl("BuildingInformationCtrl",self.data)
    end)
end

--Refresh data
function BuildingUpperItem:refreshData(data, closeCallBack)
    if data == nil then
        return
    end
    --if self.avatar == nil and data.ownerId ~= nil then
    --    PlayerInfoManger.GetInfos({[1] = data.ownerId}, self.initPlayerInfo, self)
    --end
    Event.Brocast("c_GetBuildingInfo",data)
    self.data = data
    self.closeCallBack = closeCallBack
    local name = data.name or "SRCY CITY"
    self.nameText.text = name -- .. GetLanguage(PlayerBuildingBaseData[data.mId].typeName)
    self.peopleNumberText.text = tostring(data.todayVisitor)
    -- Building Type
    local type = string.sub(tostring(data.mId), 1, 2)
    if type == "13" or type == "14" then
        self.gradeBg.localScale = Vector3.one
        self.gradeText.text = math.ceil((data.brand + data.quality) / 2)   -- The formula must be changed
    else
        self.gradeBg.localScale = Vector3.zero
    end
    self.buildingNameText.text = string.format("%s %s", GetLanguage(PlayerBuildingBaseData[data.mId].sizeName), GetLanguage(PlayerBuildingBaseData[data.mId].typeName))
    self.showBubble = data.showBubble
    self.viewsText.text = GetLanguage(25020026)
end