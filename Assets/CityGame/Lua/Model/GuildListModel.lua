---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/2/20 15:05
---

GuildListModel = class("GuildListModel",ModelBase)

function GuildListModel:initialize(insId)
    self.insId = insId
    self:OnCreate()
end

function GuildListModel:OnCreate()
    -- Network callback registration
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","getSocietyList","gs.SocietyList", self.n_OnSocietyList, self)
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","createSociety","gs.SocietyInfo", self.n_OnSocietyInfo, self)
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","joinSociety","gs.ByteStr", self.n_OnJoinSociety, self)
    DataManager.ModelRegisterNetMsg(nil,"gscode.OpCode","joinHandle", "gs.SocietyInfo", self.n_JoinHandle, self)
end

function GuildListModel.Close()
end

-- 创建公会
function GuildListModel:m_CreateSociety(createGuildInfo)
    DataManager.ModelSendNetMes("gscode.OpCode", "createSociety","gs.CreateSociety",createGuildInfo)
end

-- 创建公会返回
function GuildListModel:n_OnSocietyInfo(societyInfo, msgId)
    --异常处理
    if msgId == 0 then
        if societyInfo.reason == "societyNameDuplicated"then
            Event.Brocast("SmallPop",GetLanguage(12050007), 80)
        elseif societyInfo.reason == "moneyNotEnough"then
            Event.Brocast("SmallPop","钱不够！",80)
        end
        return
    end
    Event.Brocast("c_OnSocietyInfo", societyInfo)
end

-- 获取公会列表
function GuildListModel:m_GetSocietyList()
    local msgId = pbl.enum("gscode.OpCode", "getSocietyList")
    CityEngineLua.Bundle:newAndSendMsg(msgId, nil)
end

-- 获取公会列表返回
function GuildListModel:n_OnSocietyList(societyList)
    Event.Brocast("c_OnSocietyList", societyList)
end

-- 申请加入
function GuildListModel:m_JoinSociety(applyGuildInfo)
    DataManager.ModelSendNetMes("gscode.OpCode", "joinSociety","gs.ByteStr",applyGuildInfo)
end

-- 申请加入返回
function GuildListModel:n_OnJoinSociety(guildIdDes, msgId)
    --Event.Brocast("SmallPop", string.format("已提交申请公会%s", guildIdDes.id),80)
    --异常处理
    if msgId == 0 then
        Event.Brocast("c_OnJoinSociety")
        return
    end
    Event.Brocast("SmallPop", GetLanguage(12010012),80)
end

-- 申请加入公会通过
function GuildListModel:n_JoinHandle(societyList)
    Event.Brocast("c_JoinHandle", societyList)
end