---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/7/20 15:16
---公司流水ctrl
CompanyWaterCtrl = class('CompanyWaterCtrl',UIPanel)
UIPanel:ResgisterOpen(CompanyWaterCtrl)
CompanyWaterCtrl.static.PATH = "Assets/CityGame/Resources/View/GoodsItem/CompanyBuildingItem.prefab";

local companyWaterBehaviour;

function  CompanyWaterCtrl:bundleName()
    return "Assets/CityGame/Resources/View/CompanyWaterPanel.prefab"
end

function CompanyWaterCtrl:initialize()
    UIPanel.initialize(self,UIType.PopUp,UIMode.NeedBack,UICollider.None)--可以回退，UI打开后，隐藏其它面板
end

function CompanyWaterCtrl:Awake()
    self.insId = OpenModelInsID.CompanyWaterCtrl
    self.income = true
    companyWaterBehaviour = self.gameObject:GetComponent('LuaBehaviour');
    companyWaterBehaviour:AddClick(CompanyWaterPanel.backBtn,self.c_OnBack,self);
    companyWaterBehaviour:AddClick(CompanyWaterPanel.incomeBg,self.c_OnIncomeBg,self);
    companyWaterBehaviour:AddClick(CompanyWaterPanel.expendBg,self.c_OnExpendBg,self);

    CompanyWaterPanel.income.text = GetLanguage(19020008)   --收入
    CompanyWaterPanel.expend.text = GetLanguage(19020010)   --支出

    --玩家id
    self.playerId = DataManager.GetMyOwnerID()

    self.buildingItem = {}
    for i, v in ipairs(CompanyWaterConfig) do
        local function callback(prefab)
            self.buildingItem[i] = CompanyBuildingItem:new(companyWaterBehaviour,prefab,v)
            if i == 1 then
                self.buildingItem[1]:OnBg(self.buildingItem[1])
            end
        end
        createPrefab(CompanyWaterCtrl.static.PATH,CompanyWaterPanel.buildingContent, callback)
    end

    --滑动互用
    self.companyWater = UnityEngine.UI.LoopScrollDataSource.New()  --行情
    self.companyWater.mProvideData = CompanyWaterCtrl.static.CompanyWaterProvideData
    self.companyWater.mClearData = CompanyWaterCtrl.static.CompanyWaterClearData

end

function CompanyWaterCtrl:Active()
    UIPanel.Active(self)
    Event.AddListener("c_companyBuildingWater",self.c_companyBuildingWater,self)
end

function CompanyWaterCtrl:Refresh()
    DataManager.OpenDetailModel(CompanyWaterModel, self.insId)
end

function CompanyWaterCtrl:Hide()
    UIPanel.Hide(self)
    Event.RemoveListener("c_companyBuildingWater",self.c_companyBuildingWater,self)
end

function CompanyWaterCtrl:Close()
    UIPanel.Close(self)
    if self.buildingItem then
        for i, v in pairs(self.buildingItem) do
            destroy(v.prefab.gameObject)
        end
        self.buildingItem = {}
    end
end

--返回
function CompanyWaterCtrl:c_OnBack(go)
    PlayMusEff(1002)
    go:Hide()
end

function CompanyWaterCtrl:c_OnIncomeBg()
    PlayMusEff(1002)
    CompanyWaterPanel.expendBg.transform.localScale = Vector3.one
    CompanyWaterPanel.incomeBg:GetComponent("Button").enabled = false
    CompanyWaterPanel.open.localScale = Vector3.zero
    CompanyWaterPanel.close.localScale = Vector3.one
end

function CompanyWaterCtrl:c_OnExpendBg(go)
    PlayMusEff(1002)
    go.income = not go.income
    if go.income then
        CompanyWaterPanel.income.text = GetLanguage(19020008)   --收入
        CompanyWaterPanel.expend.text = GetLanguage(19020010)   --支出
    else
        CompanyWaterPanel.income.text = GetLanguage(19020010)   --支出
        CompanyWaterPanel.expend.text = GetLanguage(19020008)   --收入
    end
    CompanyWaterPanel.expendBg.transform.localScale = Vector3.zero
    CompanyWaterPanel.incomeBg:GetComponent("Button").enabled = true
    CompanyWaterPanel.open.localScale = Vector3.one
    CompanyWaterPanel.close.localScale = Vector3.zero
    DataManager.DetailModelRpcNoRet(go.insId, 'm_queryPlayerIncomePay',go.playerId, go.type,go.income)
end

--滑动互用
CompanyWaterCtrl.static.CompanyWaterProvideData = function(transform, idx)
    idx = idx + 1
    local item = CompanyWaterItem:new(transform,idx)
end

CompanyWaterCtrl.static.CompanyWaterClearData = function()

end

function CompanyWaterCtrl:c_companyBuildingWater(type)
    self.type = type
    DataManager.DetailModelRpcNoRet(self.insId, 'm_queryPlayerIncomePay',self.playerId,type,self.income)
end