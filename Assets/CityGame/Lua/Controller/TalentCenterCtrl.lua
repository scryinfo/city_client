---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2018/12/21 11:45
---人才中心

TalentCenterCtrl = class('TalentCenterCtrl',UIPage)
UIPage:ResgisterOpen(TalentCenterCtrl)

function TalentCenterCtrl:initialize()
    UIPage.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function TalentCenterCtrl:bundleName()
    return "TalentCenterPanel"
end

function TalentCenterCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)
    self:_receiveTanlentDetailInfo()
end

function TalentCenterCtrl:Awake(go)
    self.gameObject = go
    self.talentBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    self.talentBehaviour:AddClick(TalentCenterPanel.backBtn.gameObject, self._backBtn, self)
    self.talentBehaviour:AddClick(TalentCenterPanel.changeNameBtn.gameObject, self._changeName, self)

end

function TalentCenterCtrl:Refresh()
    --self:_initData()
    --self:_receiveTanlentDetailInfo()
end

--创建好建筑之后，每个建筑会存基本数据，比如id
function TalentCenterCtrl:_initData()
    if self.m_data then
        --向服务器请求建筑详情
        DataManager.OpenDetailModel(TalentCenterModel,self.m_data.insId)
        DataManager.DetailModelRpcNoRet(self.m_data.insId, 'm_ReqHouseDetailInfo',self.m_data.insId)
    end
end

function TalentCenterCtrl:_receiveTanlentDetailInfo(talentDetailData)
    --TalentCenterPanel.buildingNameText.text = PlayerBuildingBaseData[talentDetailData.info.mId].sizeName..PlayerBuildingBaseData[talentDetailData.info.mId].typeName
    --self.m_data = talentDetailData
    --if talentDetailData.info.ownerId ~= DataManager.GetMyOwnerID() then  --判断是自己还是别人打开了界面
    --    self.m_data.isOther = true
    --    TalentCenterPanel.changeNameBtn.localScale = Vector3.zero
    --else
    --    self.m_data.isOther = false
    --    TalentCenterPanel.changeNameBtn.localScale = Vector3.one
    --end
    if self.m_data == nil then
        return
    end
    self.m_data.buildingType = BuildingType.TalentCenter
    if not self.talentToggleGroup then
        self.talentToggleGroup = BuildingInfoToggleGroupMgr:new(TalentCenterPanel.leftRootTran, TalentCenterPanel.rightRootTran, self.talentBehaviour, self.m_data)
    else
        self.talentToggleGroup:updateInfo(self.m_data)
    end
end
---更改名字
function TalentCenterCtrl:_changeName(ins)
    local data = {}
    data.titleInfo = "RENAME"
    data.tipInfo = "Modified every seven days"
    data.inputDialogPageServerType = InputDialogPageServerType.UpdateBuildingName
    data.btnCallBack = function(name)
        ct.log("cycle_w12_hosueServer", "向服务器发送请求更改名字的协议")

        ---临时代码，直接改变名字
        ins:_updateName(name)
    end
    ct.OpenCtrl("InputDialogPageCtrl", data)
end
---返回
function TalentCenterCtrl:_backBtn(ins)
    if ins.talentToggleGroup then
        ins.talentToggleGroup:cleanItems()
    end
    UIPage.ClosePage()
end
---更改名字成功
function TalentCenterCtrl:_updateName(name)
    TalentCenterPanel.nameText.text = name
end
