---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/4/28 14:56
---Promotion of contract items
PromoteSignItem = class('PromoteSignItem')
--Initialization method
function PromoteSignItem:initialize(dataInfo, viewRect,luaBehavior)
    self.dataInfo = dataInfo
    self.viewRect = viewRect
    self.luaBehavior = luaBehavior
    local viewTrans = self.viewRect

    self.bg = viewTrans:Find("bg").gameObject
    self.head = viewTrans:Find("head/headBg"):GetComponent("Image")  --Avatar
    self.name = viewTrans:Find("head/headBg/name"):GetComponent("Text")  --first name
    self.building = viewTrans:Find("building"):GetComponent("Image")  --Architectural picture
    self.buildingName = viewTrans:Find("building/name"):GetComponent("Text")  --Building name
    self.buildingType = viewTrans:Find("building/buildingNmae"):GetComponent("Text")  --Building Type
    self.time = viewTrans:Find("signTime/time"):GetComponent("Text")  --Signing time
    self.slider = viewTrans:Find("Slider"):GetComponent("Slider")

    self.price = viewTrans:Find("unitPrice/price"):GetComponent("Text")  --Signing price
    self.bonus = viewTrans:Find("promoteBonus/bonus"):GetComponent("Text")  --Signing bonus

    self.insId = dataInfo.insId
    if dataInfo.typeId == 13 then
        LoadSprite("Assets/CityGame/Resources/Atlas/PromoteCompany/icon-supermarket.png", self.building, true)
    elseif dataInfo.typeId  == 14 then
        LoadSprite("Assets/CityGame/Resources/Atlas/PromoteCompany/icon-house.png", self.building, true)
    end
    local plyaeeId = DataManager.GetMyOwnerID()
    local currentTime = TimeSynchronized.GetTheCurrentServerTime()    --Current server time (ms)
    if plyaeeId == dataInfo.sellerPlayerId then
        self.time.text = "- -"
    else
        if math.floor((currentTime - dataInfo.startTs)/3600000) < 1 then
            self.time.text = "<1h"
        else
            self.time.text = math.ceil((currentTime - dataInfo.startTs)/3600000) .. "h"
        end
    end

    self.buildingName.text = dataInfo.buildingName

    self.buildingType.text = GetLanguage(PlayerBuildingBaseData[dataInfo.typeId].typeName)

    self.slider.value = (currentTime - dataInfo.startTs) / (dataInfo.signingHours*3600000)
    PlayerInfoManger.GetInfos({dataInfo.sellerPlayerId}, self.c_OnHead, self)

    self.price.text = GetClientPriceString(dataInfo.pricePerHour)
    self.bonus.text = math.ceil(dataInfo.lift *100) .. "%"

    self.luaBehavior:AddClick(self.bg, self.OnBg, self)
end

function PromoteSignItem:c_OnHead(info)
    AvatarManger.GetSmallAvatar(info[1].faceId,self.head.transform,0.14)
    self.name.text = info[1].name
end

function PromoteSignItem:OnBg(go)
   ct.OpenCtrl("PromoteSignCurveCtrl",{insId = go.dataInfo.insId , buildingId = go.dataInfo.sellerBuildingId,dataInfo = go.dataInfo})
end