---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/12/26 17:29
---GroundTransSelfCheckInfoCtrl
GroundTransSelfCheckInfoCtrl = class('GroundTransSelfCheckInfoCtrl',UIPanel)
UIPanel:ResgisterOpen(GroundTransSelfCheckInfoCtrl)

function GroundTransSelfCheckInfoCtrl:initialize()
    UIPanel.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function GroundTransSelfCheckInfoCtrl:bundleName()
    return "Assets/CityGame/Resources/View/GroundTransSelfCheckInfoPanel.prefab"
end

function GroundTransSelfCheckInfoCtrl:OnCreate(obj)
    UIPanel.OnCreate(self, obj)
end

function GroundTransSelfCheckInfoCtrl:Awake(go)
    local groundAuctionBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    groundAuctionBehaviour:AddClick(GroundTransSelfCheckInfoPanel.bgBtn.gameObject, self._closeBtnFunc, self)
    groundAuctionBehaviour:AddClick(GroundTransSelfCheckInfoPanel.backBtn.gameObject, self._backBtnFunc, self)
end

function GroundTransSelfCheckInfoCtrl:Refresh()
    self:_initPanelData()
end

function GroundTransSelfCheckInfoCtrl:Hide()
    UIPanel.Hide(self)
end

function GroundTransSelfCheckInfoCtrl:Active()
    UIPanel.Active(self)
    GroundTransSelfCheckInfoPanel.rentalText01.text = GetLanguage(22050006)
    GroundTransSelfCheckInfoPanel.tenancyText02.text = GetLanguage(22060005)
    GroundTransSelfCheckInfoPanel.remainDayText03.text = GetLanguage(22060008)
    GroundTransSelfCheckInfoPanel.titleText04.text = GetLanguage(22060001)
end

function GroundTransSelfCheckInfoCtrl:Close()
    UIPanel.Close(self)
end

---initialization
function GroundTransSelfCheckInfoCtrl:_initPanelData()
    if self.m_data and self.m_data.groundInfo.rent then
        self:_setShowState(self.m_data.groundInfo.rent)
    end
end
--
function GroundTransSelfCheckInfoCtrl:_setShowState(rent)
    GroundTransSelfCheckInfoPanel.rentalText.text = "E"..GetClientPriceString(rent.rentPreDay)
    GroundTransSelfCheckInfoPanel.tenancyText.text = GetLanguage(18020016, rent.rentDays)
    local showStr
    local remainDay = math.floor(((rent.rentBeginTs / 1000 + rent.rentDays * 86400) - TimeSynchronized.GetTheCurrentTime()) / 86400)
    if remainDay <= 0 then
        local remainHour = math.floor(((rent.rentBeginTs / 1000 + rent.rentDays * 86400) - TimeSynchronized.GetTheCurrentTime()) / 3600)
        if remainHour <= 0 then
            showStr = "<1"..GetLanguage(20100003)
        else
            showStr = remainHour..GetLanguage(20100003)
        end
    else
        showStr = GetLanguage(18020016, remainDay)
    end
    GroundTransSelfCheckInfoPanel.remainDayText.text = showStr
end

---Button method
--Click elsewhere to close the entire stack and open the main interface
function GroundTransSelfCheckInfoCtrl:_closeBtnFunc()
    PlayMusEff(1002)
    --Close all interfaces
    GroundTransSetPriceCtrl._closeBackToMain()
end
--Back button
function GroundTransSelfCheckInfoCtrl:_backBtnFunc()
    PlayMusEff(1002)
    UIPanel:ClosePage()
end
