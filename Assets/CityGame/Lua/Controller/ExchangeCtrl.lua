---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/10/15 17:16
---交易所
ExchangeTitleType =
{
    Quotes = 1,
    Collect = 2,
    Record = 3,
}

require('Framework/UI/UIPage')
require('Logic/ExchangeAbout/ExchangeQuoteItem')
local class = require 'Framework/class'

ExchangeCtrl = class('ExchangeCtrl',UIPage)

function ExchangeCtrl:initialize()
    UIPage.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function ExchangeCtrl:bundleName()
    return "Exchange"
end

function ExchangeCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)
end

function ExchangeCtrl:Awake(go)
    self.gameObject = go
    ExchangeCtrl.static.luaBehaviour = self.gameObject:GetComponent('LuaBehaviour');

    self.titleType = ExchangeTitleType.Quotes  --默认打开行情
    self.sortMgr = ExchangeSortMgr:new(ExchangePanel.titleRoot)

    --行情收藏记录toggle
    ExchangePanel.quotesToggle.onValueChanged:AddListener(function (isOn)
        self:_quotesToggleValueChange(isOn)
    end)
    ExchangePanel.collectToggle.onValueChanged:AddListener(function (isOn)
        self:_collectToggleValueChange(isOn)
    end)
    ExchangePanel.recordToggle.onValueChanged:AddListener(function (isOn)
        self:_recordToggleValueChange(isOn)
    end)

    self:_initPanelData()
end

function ExchangeCtrl:Refresh()
    self:_initPanelData()
end

function ExchangeCtrl:Close()
    ExchangePanel.quotesToggle.onValueChanged:RemoveAllListeners();
    ExchangePanel.collectToggle.onValueChanged:RemoveAllListeners();
    ExchangePanel.recordToggle.onValueChanged:RemoveAllListeners();
end

function ExchangeCtrl:_initPanelData()
    --设置默认行情打开
    ExchangePanel._quotesToggleState(true)
    ExchangePanel._collectToggleState(false)
    ExchangePanel._recordToggleState(false)
    ExchangePanel.recordPage.localScale = Vector3.zero

    --测试创建items
    local sourceInfo = {}
    sourceInfo[1] = {name = 001, isCollected = false, high = 1000, low = 0.5, volume = 5.003}
    sourceInfo[2] = {name = 002, isCollected = true , high = 1230, low = 1.5, volume = 52.003}
    sourceInfo[3] = {name = 003, isCollected = false, high = 1233, low = 15, volume = 12.003}
    sourceInfo[4] = {name = 004, isCollected = false, high = 1234, low = 12.5, volume = 52.3}
    sourceInfo[5] = {name = 005, isCollected = false, high = 1005, low = 45.5, volume = 59}
    ExchangeCtrl.sourceInfo = sourceInfo

    local loopSource = UnityEngine.UI.LoopScrollDataSource.New()
    loopSource.mProvideData = ExchangeCtrl.static.ProvideData
    loopSource.mClearData = ExchangeCtrl.static.ClearData
    ExchangePanel.quotesCollectScroll:ActiveScroll(loopSource, 5);

end
---行情收藏记录的toggle
function ExchangeCtrl:_quotesToggleValueChange(isOn)
    if isOn then
        if self.titleType ~= ExchangeTitleType.Quotes then
            --判断是否有数据，没有的话，就显示提示 text
            --打开详情界面

            ExchangePanel._quotesToggleState(isOn)
            self.titleType = ExchangeTitleType.Quotes
            ExchangePanel.quotesAndCollectPage.localScale = Vector3.one
        end
    else
        if self.titleType == ExchangeTitleType.Quotes then
            ExchangePanel._quotesToggleState(isOn)
            ExchangePanel.quotesAndCollectPage.localScale = Vector3.zero
        end
    end
end
function ExchangeCtrl:_collectToggleValueChange(isOn)
    if isOn then
        if self.titleType ~= ExchangeTitleType.Collect then
            --判断是否有数据，没有的话，就显示提示 text
            --打开详情界面

            ExchangePanel._collectToggleState(isOn)
            self.titleType = ExchangeTitleType.Collect
            ExchangePanel.quotesAndCollectPage.localScale = Vector3.one
        end
    else
        if self.titleType == ExchangeTitleType.Collect then
            ExchangePanel._collectToggleState(isOn)
            ExchangePanel.quotesAndCollectPage.localScale = Vector3.zero
        end
    end
end
function ExchangeCtrl:_recordToggleValueChange(isOn)
    if isOn then
        if self.titleType ~= ExchangeTitleType.Record then
            --判断是否有数据，没有的话，就显示提示 text
            --打开详情界面

            ExchangePanel._recordToggleState(isOn)
            self.titleType = ExchangeTitleType.Record
            ExchangePanel.recordPage.localScale = Vector3.one
        end
    else
        if self.titleType == ExchangeTitleType.Record then
            ExchangePanel._recordToggleState(isOn)
            ExchangePanel.recordPage.localScale = Vector3.zero
        end
    end
end
---over

---滑动复用
ExchangeCtrl.static.ProvideData = function(transform, idx)
    idx = idx + 1
    if not ExchangeCtrl.sourceInfo[idx] then
        return
    end
    ExchangeCtrl.sourceInfo[idx].transform = transform
    --self.itemlist[#self.itemlist+1] = item

    local item = ExchangeQuoteItem:new(ExchangeCtrl.sourceInfo[idx], transform, ExchangeCtrl.static.luaBehaviour)
end

ExchangeCtrl.static.ClearData = function(transform)
    --log("cycle_w8_exchange01_loopScroll", "回收"..transform.name)
end

