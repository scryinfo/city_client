---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/11/16 15:48
---
LabResearchCtrl = class('LabResearchCtrl',UIPage)
UIPage:ResgisterOpen(LabResearchCtrl)

LaboratoryCtrl.static.EmptyBtnPath = "View/Items/LaboratoryItems/EmptyBtn"  --按钮的预制
LaboratoryCtrl.static.LabResearchItemPath = "View/Items/LaboratoryItems/LabResearchItem"  --研究
LaboratoryCtrl.static.LabInventionItemPath = "View/Items/LaboratoryItems/LabInventionItem"  --发明

function LabResearchCtrl:initialize()
    UIPage.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function LabResearchCtrl:bundleName()
    return "LabResearchPanel"
end

function LabResearchCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)
end

function LabResearchCtrl:Awake(go)
    self.gameObject = go
    self.luaBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    self.luaBehaviour:AddClick(LabResearchPanel.backBtn.gameObject, function()
        UIPage.ClosePage()
    end)
    self.luaBehaviour:AddClick(LabResearchPanel.researchBtn.gameObject, function()
        self:_researchLineOpen()
    end)
    self.luaBehaviour:AddClick(LabResearchPanel.inventionBtn.gameObject, function()
        self:_inventionLineOpen()
    end)

    --滑动复用部分
    self.researchSource = UnityEngine.UI.LoopScrollDataSource.New()  --研究
    self.researchSource.mProvideData = LabResearchCtrl.static.researchProvideData
    self.researchSource.mClearData = LabResearchCtrl.static.researchClearData
    self.inventionSource = UnityEngine.UI.LoopScrollDataSource.New()  --发明
    self.inventionSource.mProvideData = LabResearchCtrl.static.inventionProvideData
    self.inventionSource.mClearData = LabResearchCtrl.static.inventionClearData
end

function LabResearchCtrl:Refresh()
    self:_initPanelData()
end

function LabResearchCtrl:Close()
    self:_removeListener()
end

function LabResearchCtrl:_addListener()
    Event.AddListener("c_OnReceiveLaboratoryDetailInfo", self._onReceiveLabResearchData, self)

end
function LabResearchCtrl:_removeListener()
    --Event.RemoveListener("c_onExchangeSort", self._exchangeSortByValue, self)
end

function LabResearchCtrl:_initPanelData()
    self:_addListener()
    self:_researchLineOpen()
    LabResearchCtrl.researchItems = {}
    LabResearchCtrl.inventionItems = {}

    --模拟服务器发来的数据
    --self:_onReceiveLabResearchData()

    Event.Brocast("m_ReqLaboratoryDetailInfo")
end

---按钮切页
function LabResearchCtrl:_researchLineOpen()
    LabResearchPanel._researchToggleState(true)
    LabResearchPanel._inventionToggleState(false)

    self:_onReceiveLabResearchData()
end
function LabResearchCtrl:_inventionLineOpen()
    LabResearchPanel._researchToggleState(false)
    LabResearchPanel._inventionToggleState(true)

    self:c_onReceiveLabInventionData()
end

---滑动复用
--研究
LabResearchCtrl.static.researchProvideData = function(transform, idx)
    if idx == 0 then
        LabResearchCtrl.researchEmptyBtn = LabScrollEmptyBtn:new(transform, function ()
            --打开研究选择界面
            ct.log("cycle_w13_laboratory", "打开研究选择界面")
        end)
        return
    end

    idx = idx + 1
    local item = LabResearchLineItem:new(LabResearchCtrl.researchInfoData[idx], transform)
    LabResearchCtrl.researchItems[idx] = item
end
LabResearchCtrl.static.researchClearData = function(transform)
end
--发明
LabResearchCtrl.static.inventionProvideData = function(transform, idx)
    if idx == 0 then
        LabResearchCtrl.inventionEmptyBtn = LabScrollEmptyBtn:new(transform, function ()
            --打开研究选择界面
            ct.log("cycle_w13_laboratory", "打开发明选择界面")
        end)
        return
    end

    idx = idx + 1
    local item = LabInventionLineItem:new(LabResearchCtrl.inventionInfoData[idx], transform)
    LabResearchCtrl.inventionItems[idx] = item
end
LabResearchCtrl.static.inventionClearData = function(transform)
end

---从modle传来的回调
--研究
function LabResearchCtrl:_onReceiveLabResearchData(datas)
    local researchInfoData = {}
    researchInfoData[1] = {itemId = 2151001, staffCount = 20}
    researchInfoData[2] = {itemId = 2151002, staffCount = 22}
    researchInfoData[3] = {itemId = 2151003, staffCount = 25}
    researchInfoData[4] = {itemId = 2151004, staffCount = 21}
    researchInfoData[5] = {itemId = 2152001, staffCount =  2}
    researchInfoData[6] = {itemId = 2152002, staffCount = 32}
    researchInfoData[7] = {itemId = 2152003, staffCount = 12}
    researchInfoData[8] = {itemId = 2152004, staffCount =  7}
    researchInfoData[9] = {itemId = 2153001, staffCount =  9}
    researchInfoData[10] = {itemId = 2153002, staffCount = 11}
    researchInfoData[11] = {itemId = 2153003, staffCount = 15}
    researchInfoData[12] = {itemId = 2153004, staffCount = 19}

    if not self.researchPrefabList then
        self.researchPrefabList = {}
    end
    local researchPrefabList = {}
    for i, item in ipairs(researchInfoData) do
        researchPrefabList[i] = LaboratoryCtrl.static.LabResearchItemPath
    end
    --预留第一个数据给按钮
    table.insert(researchInfoData, 1, {})
    table.insert(researchPrefabList, 1, LaboratoryCtrl.static.EmptyBtnPath)

    LabResearchCtrl.researchInfoData = researchInfoData
    self.researchPrefabList = researchPrefabList
    LabResearchPanel.researchScroll:ActiveDiffItemLoop(self.researchSource, self.researchPrefabList)
end
--发明
function LabResearchCtrl:c_onReceiveLabInventionData(datas)
    local inventionInfoData = {}
    inventionInfoData[1] = {itemId = 2151004, staffCount = 20}
    inventionInfoData[2] = {itemId = 2151003, staffCount = 22}
    inventionInfoData[3] = {itemId = 2151002, staffCount = 25}
    inventionInfoData[4] = {itemId = 2151001, staffCount = 21}
    inventionInfoData[5] = {itemId = 2152001, staffCount =  2}
    inventionInfoData[6] = {itemId = 2152002, staffCount = 32}
    inventionInfoData[7] = {itemId = 2152003, staffCount = 12}
    inventionInfoData[8] = {itemId = 2152004, staffCount =  7}
    inventionInfoData[9] = {itemId = 2153001, staffCount =  9}
    inventionInfoData[10] = {itemId = 2153002, staffCount = 11}
    inventionInfoData[11] = {itemId = 2153003, staffCount = 15}
    inventionInfoData[12] = {itemId = 2153004, staffCount = 19}

    if not self.inventionPrefabList then
        self.inventionPrefabList = {}
    end
    local inventionPrefabList = {}
    for i, item in ipairs(inventionInfoData) do
        inventionPrefabList[i] = LaboratoryCtrl.static.LabInventionItemPath
    end
    --预留第一个数据给按钮
    table.insert(inventionInfoData, 1, {})
    table.insert(inventionPrefabList, 1, LaboratoryCtrl.static.EmptyBtnPath)

    LabResearchCtrl.inventionInfoData = inventionInfoData
    self.inventionPrefabList = inventionPrefabList
    LabResearchPanel.inventionScroll:ActiveDiffItemLoop(self.inventionSource, self.inventionPrefabList)
end