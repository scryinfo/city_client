---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2018/11/29 14:31
---

FriendsItem = class('FriendsItem')

-- 初始化
function FriendsItem:initialize(type, luaBehaviour, prefab, data)
    self.prefab = prefab
    self.data = data

    local transform = prefab.transform
    self.bgBtn = transform:Find("Bg").gameObject
    self.headBtn = transform:Find("HeadBtn").gameObject
    -- 好友名
    self.nameText = transform:Find("NameText"):GetComponent("Text")
    -- 好友所在公司名字
    self.companyText = transform:Find("CompanyText"):GetComponent("Text")
    -- 好友签名
    self.signature = transform:Find("SignatureBg").gameObject
    self.signatureText = transform:Find("SignatureBg/SignatureText"):GetComponent("Text")
    -- 删除好友按钮
    self.deleteBtn = transform:Find("DeleteBtn").gameObject
    -- 解除屏蔽
    self.removeMaskBtn = transform:Find("RemoveMaskBtn").gameObject
    -- 小签名
    self.sign = transform:Find("SignatureImage").gameObject
    self.signText = transform:Find("SignatureImage/SignatureText"):GetComponent("Text")
    -- 同意好友申请
    self.agreeBtn  = transform:Find("AgreeBtn").gameObject
    -- 拒绝好友申请
    self.refuseBtn  = transform:Find("RefuseBtn").gameObject
    -- 加好友
    self.addFriendsBtn  = transform:Find("AddFriendsBtn").gameObject
    -- 发送私聊
    self.sendMsgBtn  = transform:Find("SendMsgBtn").gameObject

    self.nameText.text = data.name
    self.companyText.text = data.company
    self.signatureText.text = data.sign
    self.signText.text = data.sign
    self.deleteBtn:SetActive(false)

    if type == 1 then -- 好友主界面
        self.signature:SetActive(true)

        self.bgBtn:GetComponent("Button").interactable = true
        self.headBtn:GetComponent("Button").interactable = true

        luaBehaviour:AddClick(self.bgBtn, self.OnBg, self)
        luaBehaviour:AddClick(self.headBtn, self.OnHead, self)
        luaBehaviour:AddClick(self.deleteBtn, self.OnDelete, self)
    elseif type == 3 then -- 好友管理
        self.signature:SetActive(true)
        self.deleteBtn:SetActive(true)
        self.removeMaskBtn:SetActive(false)
    elseif type == 4 then -- 黑名单
        self.removeMaskBtn:SetActive(true)
        self.signature:SetActive(false)
        luaBehaviour:AddClick(self.removeMaskBtn, self.OnRemoveMask, self)
    elseif type == 5 then -- 添加好友
        self.addFriendsBtn:SetActive(true)
        self.sendMsgBtn:SetActive(true)
    elseif type == 6 then -- 申请列表
        self.sign:SetActive(true)
        self.agreeBtn:SetActive(true)
        self.refuseBtn:SetActive(true)
    end
end

function FriendsItem:OnBg(go)
    --UIPage.ClosePage()
    --GameObject.Destroy(go.prefab)
    ct.log("tina_w15_friends", "向好友发起聊天")
end

function FriendsItem:OnHead(go)
    UIPage.ClosePage()
    ct.log("tina_w15_friends", "显示好友个人信息")
end

function FriendsItem:OnDelete(go)
    --UIPage.ClosePage()
    --打开弹框
    local data = {}
    data.titleInfo = "WARNING"
    data.contentInfo = "Delete the production line?"
    data.tipInfo = "(The production schedule will be empty!)"
    data.btnCallBack = function()
        ct.log("cycle_w11_exchange03", "向服务器发送删除好友请求")
        --UIPage.ClosePage()
        GameObject.Destroy(go.prefab)
    end
    ct.OpenCtrl("BtnDialogPageCtrl", data)
end

function FriendsItem:OnRemoveMask(go)
    --UIPage.ClosePage()
    --打开弹框
    local data = {}
    data.titleInfo = "WARNING"
    data.contentInfo = "Delete the production line?"
    data.tipInfo = "(The production schedule will be empty!)"
    data.btnCallBack = function()
        ct.log("cycle_w11_exchange03", "向服务器发送删除好友请求")
        --UIPage.ClosePage()
        GameObject.Destroy(go.prefab)
    end
    ct.OpenCtrl("BtnDialogPageCtrl", data)
end

function FriendsItem:_setBtnState()
    self.deleteBtn:SetActive(not self.deleteBtn.activeSelf)
end