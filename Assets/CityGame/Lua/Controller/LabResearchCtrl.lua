---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/11/29 17:38
---
LabResearchCtrl = class('LabResearchCtrl',UIPage)
UIPage:ResgisterOpen(LabResearchCtrl)

LabResearchCtrl.static.EmptyBtnPath = "View/Items/LaboratoryItems/EmptyBtn"  --按钮的预制

function LabResearchCtrl:initialize()
    UIPage.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function LabResearchCtrl:bundleName()
    return "LabScientificLinePanel"
end

function LabResearchCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)
end

function LabResearchCtrl:Awake(go)
    self.gameObject = go
    self.luaBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    self.luaBehaviour:AddClick(LabScientificLinePanel.backBtn.gameObject, function()
        UIPage.ClosePage()
    end)
    self.luaBehaviour:AddClick(LabScientificLinePanel.researchBtn.gameObject, function()
        self:_researchLineOpen()
    end)
    self.luaBehaviour:AddClick(LabScientificLinePanel.inventionBtn.gameObject, function()
        self:_inventionLineOpen()
    end)

    --滑动复用部分
    self.researchSource = UnityEngine.UI.LoopScrollDataSource.New()  --研究
    self.researchSource.mProvideData = LabResearchCtrl.static.researchProvideData
    self.researchSource.mClearData = LabResearchCtrl.static.researchClearData
    self.inventionSource = UnityEngine.UI.LoopScrollDataSource.New()  --发明
    self.inventionSource.mProvideData = LabResearchCtrl.static.inventionProvideData
    self.inventionSource.mClearData = LabResearchCtrl.static.inventionClearData
end

function LabResearchCtrl:Refresh()
    self:_initPanelData()
end

function LabResearchCtrl:Close()
    self:_removeListener()
end

function LabResearchCtrl:_addListener()
    --Event.AddListener("c_OnReceiveLaboratoryDetailInfo", self._onReceiveLabResearchData, self)

end
function LabResearchCtrl:_removeListener()
    --Event.RemoveListener("c_onExchangeSort", self._exchangeSortByValue, self)
end

function LabResearchCtrl:_initPanelData()
    self:_addListener()
    LabResearchCtrl.researchItems = {}
    LabResearchCtrl.inventionItems = {}
    self.researchDatas = {}
    self.inventionDatas = {}

    --这个界面的数据是从主界面拿到的，然后数据有变化的时候才会更新，所以不需要请求服务器数据
    --将数据分开
    if self.m_data.line then
        for key, itemData in pairs(self.m_data.line) do
            if itemData.type == 0 then
                self.researchDatas[#self.researchDatas] = itemData
            elseif itemData.type == 1 then
                self.inventionDatas[#self.inventionDatas] = itemData
            end
        end
    end
    self:_researchLineOpen()
end

---按钮切页
function LabResearchCtrl:_researchLineOpen()
    LabScientificLinePanel._researchToggleState(true)
    LabScientificLinePanel._inventionToggleState(false)

    self:_onReceiveLabResearchData(self.researchDatas)
end