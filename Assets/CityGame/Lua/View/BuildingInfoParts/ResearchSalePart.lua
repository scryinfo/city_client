---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/7/24 16:05
---

ResearchSalePart = class("ResearchSalePart", BasePart)

function ResearchSalePart:PrefabName()
    return "ResearchSalePart"
end

function ResearchSalePart:GetDetailClass()
    return ResearchSaleDetailPart
end

function ResearchSalePart:_InitTransform()
    local transform = self.transform
    self.text = transform:Find("Top/Text"):GetComponent("Text")
    self.quantityNumText = transform:Find("Top/QuantityNumText"):GetComponent("Text")
end

function ResearchSalePart:_InitChildClick(mainPanelLuaBehaviour)
    -- 监听上架内容
    DataManager.ModelRegisterNetMsg(nil, "gscode.OpCode", "scienceShelfAdd", "gs.ShelfAdd", self.n_OnReceiveScienceShelfAdd, self)
    -- 监听下架内容
    DataManager.ModelRegisterNetMsg(nil, "gscode.OpCode", "scienceShelfDel", "gs.ShelfDel", self.n_OnReceiveScienceShelfDel, self)
    -- 监听修改内容
    DataManager.ModelRegisterNetMsg(nil, "gscode.OpCode", "scienceShelfSet", "gs.ShelfSet", self.n_OnReceiveScienceShelfSet, self)
end

function  ResearchSalePart:_ResetTransform()
    -- 移除监听上架内容
    DataManager.ModelNoneInsIdRemoveNetMsg("gscode.OpCode", "scienceShelfAdd", self.n_OnReceiveScienceShelfAdd, self)
    -- 移除监听下架内容
    DataManager.ModelNoneInsIdRemoveNetMsg("gscode.OpCode", "scienceShelfDel", self.n_OnReceiveScienceShelfDel, self)
    -- 移除监听修改内容
    DataManager.ModelNoneInsIdRemoveNetMsg("gscode.OpCode", "scienceShelfSet", self.n_OnReceiveScienceShelfSet, self)
end

function ResearchSalePart:Refresh(data)
    --刷新自身数据,不刷新详情页面数据
    self:RefreshData(data)
end

function ResearchSalePart:RefreshData(data)
    self.m_data = data
    self.text.text = "Quantity:"
    self:_showQuantityNum()
end

-- 修改上架信息(研究所、推广公司)
function ResearchSalePart:_showQuantityNum()
    self.quantityNumText.text = self.m_data.shelfNum
end

-- 上架(研究所、推广公司)
function ResearchSalePart:n_OnReceiveScienceShelfAdd(shelfAdd)
    self.m_data.shelfNum = shelfAdd.curCount
    self:_showQuantityNum()
end

-- 全部下架该科技(研究所、推广公司)
function ResearchSalePart:n_OnReceiveScienceShelfDel(shelfDel)
    self.m_data.shelfNum = shelfDel.curCount
    self:_showQuantityNum()
end

-- 修改上架信息(研究所、推广公司)
function ResearchSalePart:n_OnReceiveScienceShelfSet(shelfSet)
    self.m_data.shelfNum = shelfSet.curCount
    self:_showQuantityNum()
end