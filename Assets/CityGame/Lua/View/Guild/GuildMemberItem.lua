---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/2/21 15:40
---

GuildMemberItem = class("GuildMemberItem")
GuildMemberItem.static.NomalColor = Vector3.New(255, 255, 255) -- Default background color
GuildMemberItem.static.OwnColor = Vector3.New(255, 247, 223) -- Own background color
GuildMemberItem.static.SelectColor = Vector3.New(193, 201, 229) -- Selected background color

function GuildMemberItem:initialize(prefab, data)
    self.prefab = prefab
    self.data = data

    local transform = prefab.transform
    self.memberHeadBg = transform:Find("MemberHeadBg")
    self.nameText = transform:Find("NameText"):GetComponent("Text")
    self.jobText = transform:Find("JobText"):GetComponent("Text")
    self.staffNumberText = transform:Find("StaffNumberText"):GetComponent("Text")
    self.joinTimeText = transform:Find("JoinTimeText"):GetComponent("Text")

    --self.nameText.text = self.data.id
    if self.data.identity == "CHAIRMAN" then
        self.jobText.text = GetLanguage( 12030001) -- "President"
    elseif self.data.identity == "VICE_CHAIRMAN" then
        self.jobText.text = GetLanguage( 12030002) --"Vice president"
    elseif self.data.identity == "ADMINISTRATOR" then
        self.jobText.text = GetLanguage( 12030003) -- "management"
    elseif self.data.identity == "MEMBER" then
        self.jobText.text = GetLanguage( 12030004) -- "member"
    end
    self.staffNumberText.text = self.data.staffCount
    local timeTab = getFormatUnixTime(self.data.joinTs/1000)
    self.joinTimeText.text = string.format("%s/%s/%s", timeTab.day, timeTab.month, timeTab.year)

    self.clickBtn = transform:Find("ClickBtn"):GetComponent("Button")
    self.clickImage = transform:Find("ClickBtn"):GetComponent("Image")

    PlayerInfoManger.GetInfos({data.id}, self._showNameHead, self)

    -- Your background color is light yellow and cannot be clicked
    if data.id ==DataManager.GetMyOwnerID() then
        self:_setClickImageColor(false)
        self:_setButtonInteractable(false)
    else
        self:_setClickImageColor(true)
        self:_setButtonInteractable(true)
        self.clickBtn.onClick:RemoveAllListeners()
        self.clickBtn.onClick:AddListener(function ()
            self:_openMenu()
        end)
    end
end

-- Click the member item to open the operation menu
function GuildMemberItem:_openMenu()
    local position = self.prefab.transform.position
    self:_setButtonInteractable(false)
    GuildOwnCtrl.static.guildMgr:SetSelectMemberItem(self)
    GuildOwnCtrl.static.guildMgr:ShowGuildMenu(position)
    --GuildOwnCtrl.static.guildMgr:SetIdentity()
    --GuildOwnCtrl.static.guildMgr:SetGuildMenuShow(true)
end

-- Set the background color of the item
function GuildMemberItem:_setClickImageColor(isDefault)
    if isDefault then
        self.clickImage.color = getColorByVector3(GuildMemberItem.static.NomalColor)
    else
        self.clickImage.color = getColorByVector3(GuildMemberItem.static.OwnColor)
    end
end

-- Set whether item can be clicked
function GuildMemberItem:_setButtonInteractable(isinteractable)
    self.clickBtn.interactable = isinteractable
end

-- Display basic information such as member avatar names
function GuildMemberItem:_showNameHead(playerData)
    self.nameText.text = playerData[1].name
    self.data.playerData = playerData[1]
    self.avatarData = AvatarManger.GetSmallAvatar(playerData[1].faceId, self.memberHeadBg,0.2)
end

-- Delete avatar
function GuildMemberItem:CloseAvatar()
    if self.avatarData then
        AvatarManger.CollectAvatar(self.avatarData)
    end
end