---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by allen.
--- DateTime: 2018/11/2 17:01
---Construction panel
-----

ConstructDialogPageCtrl = class('ConstructDialogPageCtrl',UIPage)
UIPage:ResgisterOpen(ConstructDialogPageCtrl)

function ConstructDialogPageCtrl:initialize()
    UIPage.initialize(self, UIType.PopUp, UIMode.DoNothing, UICollider.None)
end

function ConstructDialogPageCtrl:bundleName()
    return "Assets/CityGame/Resources/View/ConstructDialogPagePanel.prefab"
end

function ConstructDialogPageCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)
    --Close panel
    local LuaBehaviour = self.gameObject:GetComponent('LuaBehaviour');
    LuaBehaviour:AddClick(ConstructDialogPagePanel.btn_confirm.gameObject, function()
        Event.Brocast("m_constructBuildConfirm")
        Event.Brocast("m_abolishConstructBuild")
        self:Hide()
    end );
    LuaBehaviour:AddClick(ConstructDialogPagePanel.btn_abolish.gameObject, function()
        self:Hide()
    end );
end

function ConstructDialogPageCtrl:Awake(go)
    self.gameObject = go
    Event.AddListener("m_constructBuildConfirm", self.ConstructBuildConfirm, self);
end

function ConstructDialogPageCtrl:Refresh()
    ConstructDialogPagePanel.titleText.text = PlayerBuildingBaseData[DataManager.TempDatas.constructID].sizeName .. "  " .. PlayerBuildingBaseData[DataManager.TempDatas.constructID].typeName
    ConstructDialogPagePanel.buildSizeText.text = PlayerBuildingBaseData[DataManager.TempDatas.constructID].x * PlayerBuildingBaseData[DataManager.TempDatas.constructID].y
end

--Confirm construction
function ConstructDialogPageCtrl:ConstructBuildConfirm()
    --TODOï¼šSend construction data to the server
    if DataManager.TempDatas.constructID ~= nil then
        local tempPos = DataManager.TempDatas.constructObj.transform.position
        PlayerTempModel.m_ReqAddBuilding(DataManager.TempDatas.constructID, math.floor(tempPos.x) ,  math.floor(tempPos.z))
    end
end
