---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/2/27 18:13
---自己的建筑
MapRightSelfBuildingPage = class('MapRightSelfBuildingPage', MapRightPageBase)

--初始化方法
function MapRightSelfBuildingPage:initialize(viewRect)
    self.viewRect = viewRect:GetComponent("RectTransform")

    self.closeBtn = self.viewRect.transform:Find("topRoot/closeBtn"):GetComponent("Button")
    self.protaitImg = self.viewRect.transform:Find("topRoot/protaitRoot/bg/protaitImg"):GetComponent("Image")
    self.nameText = self.viewRect.transform:Find("topRoot/nameText"):GetComponent("Text")
    self.companyText = self.viewRect.transform:Find("topRoot/companyText"):GetComponent("Text")
    self.buildingNameText = self.viewRect.transform:Find("topRoot/bg/buildingNameText"):GetComponent("Text")
    self.femaleIconTran = self.viewRect.transform:Find("topRoot/nameText/femaleIcon")
    self.manIconTran = self.viewRect.transform:Find("topRoot/nameText/manIcon")

    --btn
    self.goHereBtn = self.viewRect.transform:Find("bottomRoot/btnRoot/goHereBtn"):GetComponent("Button")
    self.goHereText01 = self.viewRect.transform:Find("bottomRoot/btnRoot/goHereBtn/Text"):GetComponent("Text")

    self.closeBtn.onClick:AddListener(function ()
        self:close()
    end)
    self.goHereBtn.onClick:AddListener(function ()
        self:_goHereBtn()
    end)
end
--
function MapRightSelfBuildingPage:refreshData(data)
    self.viewRect.anchoredPosition = Vector2.zero
    self.data = data

    local buildingDetail = DataManager.GetSelfBuildingDetailByBlockId(data.buildingId).info
    self.data.pos = buildingDetail.pos
    local playerInfo = DataManager.GetMyPersonalHomepageInfo()
    if playerInfo ~= nil then
        self.nameText.text = playerInfo.name
        self.companyText.text = playerInfo.companyName
        if playerInfo.male == true then
            self.manIconTran.localScale = Vector3.one
            self.femaleIconTran.localScale = Vector3.zero
        else
            self.manIconTran.localScale = Vector3.zero
            self.femaleIconTran.localScale = Vector3.one
        end
        self.avatar = AvatarManger.GetSmallAvatar(playerInfo.faceId, self.protaitImg.transform,0.2)
    end
    self.buildingNameText.text = buildingDetail.name
    self:openShow()
end
--重置状态
function MapRightSelfBuildingPage:openShow()
    self:_language()
    self.viewRect.anchoredPosition = Vector2.zero
end
--多语言
function MapRightSelfBuildingPage:_language()
    --正式代码
    --self.goHereText01.text = GetLanguage()
    self.goHereText01.text = "Go here"
end
--关闭
function MapRightSelfBuildingPage:close()
    self.viewRect.anchoredPosition = Vector2.New(506, 0)
    if self.avatar ~= nil then
        AvatarManger.CollectAvatar(self.avatar)
    end
end
--去地图上的一个建筑
function MapRightSelfBuildingPage:_goHereBtn()
    MapBubbleManager.GoHereFunc(self.data)
    local blockId = TerrainManager.GridIndexTurnBlockID(self.data.pos)
    local tempValue = DataManager.GetBaseBuildDataByID(blockId)
    if tempValue ~= nil then
        tempValue:OpenPanel()
        CameraMove.MoveIntoUILayer(blockId)
    end
end
--
function MapRightSelfBuildingPage:_initPersonalInfo(data)
    if data ~= nil then
        self.nameText.text = data.name
        self.companyText.text = data.companyName
        if data.male == true then
            self.manIconTran.localScale = Vector3.one
            self.femaleIconTran.localScale = Vector3.zero
        else
            self.manIconTran.localScale = Vector3.zero
            self.femaleIconTran.localScale = Vector3.one
        end
        self.avatar = AvatarManger.GetSmallAvatar(data.faceId, self.protaitImg.transform,0.2)
    end
end
