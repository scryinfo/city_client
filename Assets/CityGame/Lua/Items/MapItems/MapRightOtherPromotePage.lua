---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/2/27 18:13
---Click on others to promote the building
MapRightOtherPromotePage = class('MapRightOtherPromotePage')
MapRightOtherPromotePage.moneyColor = "#F4AD07FF"

--Initialization method
function MapRightOtherPromotePage:initialize(viewRect)
    self.viewTrans = viewRect.transform

    self.showInfoRoot = self.viewTrans:Find("showInfoRoot")
    self.iconImg = self.viewTrans:Find("abilityRoot/bg/iconImg"):GetComponent("Image")
    self.infoText = self.viewTrans:Find("abilityRoot/bg/Image/infoText"):GetComponent("Text")
end
--data is the data sent from the server, typeData must include typeId, refers to the search type on the left, the type of this interface is search promotion company
-- Since the promotion company has a secondary interface, there will be a detailId
function MapRightOtherPromotePage:refreshData(data, typeData)
    self.viewTrans.localScale = Vector3.one
    self.data = data
    if typeData.typeId == EMapSearchType.Promotion then
        --Depending on the type replacement Icon / multilingual
        if typeData.detailId ~= nil then
            for i, value in pairs(MapPromotionInfoConfig) do --Silly approach
                if value.type == typeData.detailId then
                    self.infoText.text = GetLanguage(value.languageId)
                    LoadSprite(value.imgPath, self.iconImg, false)
                end
            end
        end
        self:_createPromotion()
        self:_sortInfoItems()
    end
end
--
function MapRightOtherPromotePage:_sortInfoItems()
    if self.items == nil or #self.items == 0 then
        return
    end
    local pos = Vector3.zero
    for i, item in ipairs(self.items) do
        item:setPos(pos)
        pos.y = pos.y - 66  --66 is the height of the item + interval-TODO: // parameter adjustment
    end
end
--Promote
function MapRightOtherPromotePage:_createPromotion()
    --Quantity
    local str1 = self.data.sale.count
    local data1 = {infoTypeStr = "PromoteQuantity", value = str1}  --Quantity
    self.items[#self.items + 1] = self:_createShowItem(data1, self.showInfoRoot)
    --price
    local str2 = string.format("<color=%s>E%s</color>", MapRightOtherPromotePage.moneyColor, GetClientPriceString(self.data.sale.price))
    local data2 = {infoTypeStr = "Price", value = str2}  --price
    self.items[#self.items + 1] = self:_createShowItem(data2, self.showInfoRoot)
    --Competitiveness
    local str3 = ct.CalculationAdvertisementCompetitivePower(self.data.sale.guidePrice,self.data.sale.price,self.data.typeIds)
    local data3 = {infoTypeStr = "CompetitivePower", value = str3}  --Competitiveness
    self.items[#self.items + 1] = self:_createShowItem(data3, self.showInfoRoot)
end
--
function MapRightOtherPromotePage:_createShowItem(data, parentTrans, hasDetail)
    local obj
    if hasDetail == true then
        obj = MapPanel.prefabPools[MapPanel.MapShowInfoHasImgPoolName]:GetAvailableGameObject()
    else
        obj = MapPanel.prefabPools[MapPanel.MapShowInfoPoolName]:GetAvailableGameObject()
    end
    obj.transform:SetParent(parentTrans)
    obj.transform.localScale = Vector3.one
    local item = MapRightShowInfoItem:new(obj)
    item:initData(data)
    return item
end
--Prefabricated recycling and clearing data
function MapRightOtherPromotePage:_cleanItems()
    if self.items == nil then
        self.items = {}
        return
    end
    for i, item in pairs(self.items) do
        if item:getIsDetail() == true then
            MapPanel.prefabPools[MapPanel.MapShowInfoHasImgPoolName]:RecyclingGameObjectToPool(item.viewRect.gameObject)
        else
            MapPanel.prefabPools[MapPanel.MapShowInfoPoolName]:RecyclingGameObjectToPool(item.viewRect.gameObject)
        end
        item = nil
    end
    self.items = {}
end
--shut down
function MapRightOtherPromotePage:close()
    self:_cleanItems()
    self.viewTrans.localScale = Vector3.zero
end