---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/12/3 10:14
---
LabInventionCtrl = class('LabInventionCtrl',UIPage)
UIPage:ResgisterOpen(LabInventionCtrl)

LabInventionCtrl.static.InventionBulbItemPath = "View/Items/LaboratoryItems/LabInventionBulbItem"  --灯泡的预制

function LabInventionCtrl:initialize()
    UIPage.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end
function LabInventionCtrl:bundleName()
    return "LabInventionPanel"
end
function LabInventionCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)
end
function LabInventionCtrl:Awake(go)
    self.gameObject = go
    self.luaBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    self.bulbPrefab = UnityEngine.Resources.Load(LabInventionCtrl.static.InventionBulbItemPath)
    self.luaBehaviour:AddClick(LabInventionPanel.backBtn.gameObject, function()
        UIPage.ClosePage()
    end)
    self.luaBehaviour:AddClick(LabInventionPanel.inventionBtn.gameObject, function()
        self:_researchBtnFunc()
    end)
end
function LabInventionCtrl:Refresh()
    self:_addListener()
    self:_initPanelData()
end
function LabInventionCtrl:Hide()
    UIPage.Hide(self)
    self._removeListener()
end
function LabInventionCtrl:Close()
    self:_removeListener()
end

function LabInventionCtrl:_addListener()
    Event.AddListener("c_OnReceiveLaboratoryStoreInfo", self._getStoreData, self)  --DBMgr发送过来的store数据
end
function LabInventionCtrl:_removeListener()
    Event.AddListener("c_OnReceiveLaboratoryStoreInfo", self._getStoreData, self)
end
--初始化数据
function LabInventionCtrl:_initPanelData()
    self:_addListener()
    local formularItem = FormularConfig[self.m_data.itemId]
    if formularItem.phase ~= 5 then
        ct.log("cycle_w15_laboratory03", "阶段数不为5")
        return
    end
    --Event.Brocast("m_ReqLabStoreInfo", self.m_data.buildingId)  --本地，向DBMgr请求仓库信息

    --总阶段数，然后roll个数，当前阶段，当前阶段的剩余时间
    for i, index in pairs(self.m_data.totalPhase) do
        local go = UnityEngine.GameObject.Instantiate(self.bulbPrefab)
        go.transform:SetParent(LabInventionPanel.workingRootTran)
        go.transform.localScale = Vector3.one

    end
end
--拿到仓库信息
function LabInventionCtrl:_getStoreData(data)
    --获取基础数据
    local itemInfo
    if self.m_data.isMaterial then
        itemInfo = Material[self.data.itemId]
    else
        itemInfo = Good[self.data.itemId]
    end
    LabInventionPanel.itemNameText.text = itemInfo.name
    --LabInventionPanel.iconImg.mainTexture = itemInfo.img
    LabInventionPanel:showLine(formularItem.materials)
end