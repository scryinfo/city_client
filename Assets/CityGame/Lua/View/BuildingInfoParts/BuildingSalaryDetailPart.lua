---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/2/27 18:13
---建筑主界面调整工资
BuildingSalaryDetailPart = class('BuildingSalaryDetailPart', BasePartDetail)
--
function BuildingSalaryDetailPart:PrefabName()
    return "BuildingSalaryDetailPart"
end
--
function BuildingSalaryDetailPart:RefreshData(data)
    self.m_data = data
    self:_initFunc()
end
--
function BuildingSalaryDetailPart:_InitTransform()
    self:_getComponent(self.transform)
    self:_Awake()
end
--关掉界面时的操作
function BuildingSalaryDetailPart:_Hide()

end


--function BuildingSalaryDetailPart:Refresh()
--    DataManager.ModelRegisterNetMsg(nil, "gscode.OpCode", "queryIndustryWages", "gs.QueryIndustryWages", self._getStandardWage, self)
--end
--
--function BuildingSalaryDetailPart:Hide()
--    DataManager.ModelNoneInsIdRemoveNetMsg("gscode.OpCode", "queryIndustryWages", self)
--end


--
function BuildingSalaryDetailPart:_Awake()
    self.wageSlider.onValueChanged:AddListener(function (value)
        local tempValue = math.floor(value)
        self:_showPercentValue(tempValue)
    end)

    --self.closeBtn.onClick:RemoveAllListeners()
    self.closeBtn.onClick:AddListener(function ()
        self:clickCloseBtn()
    end)
    --self.confirmBtn.onClick:RemoveAllListeners()
    self.confirmBtn.onClick:AddListener(function ()
        self:clickConfirmBtn()
    end)

    --self.luaBehaviour:AddClick(self.closeBtn, function ()
    --    self:clickCloseBtn()
    --end , self)
    --self.luaBehaviour:AddClick(self.confirmBtn, function ()
    --    self:clickConfirmBtn()
    --end , self)
end
--
function BuildingSalaryDetailPart:_getComponent(transform)
    if transform == nil then
        return
    end
    self.closeBtn = transform:Find("root/closeBtn"):GetComponent("Button")
    self.confirmBtn = transform:Find("root/confirmBtn"):GetComponent("Button")

    self.staffNumText = transform:Find("root/staffNum/staffNumText"):GetComponent("Text")
    self.standardWageText = transform:Find("root/wage/standardWageText"):GetComponent("Text")
    self.wageSlider = transform:Find("root/wageSlider"):GetComponent("Slider")
    self.effectiveDateText = transform:Find("root/effectiveDateText"):GetComponent("Text")

    self.select50Text = transform:Find("root/wageLevel/00/selectText")
    self.select75Text = transform:Find("root/wageLevel/01/selectText")
    self.select100Text = transform:Find("root/wageLevel/02/selectText")
    self.simple50Text = transform:Find("root/wageLevel/00/Text")
    self.simple75Text = transform:Find("root/wageLevel/01/Text")
    self.simple100Text = transform:Find("root/wageLevel/02/Text")

    self.effectText = transform:Find("root/bg/bg01/effectText"):GetComponent("Text")
    self.effectExpWordText = transform:Find("root/bg/bg01/Text01"):GetComponent("Text")
    self.totalText = transform:Find("root/bg/bg02/totalText"):GetComponent("Text")
end
--
function BuildingSalaryDetailPart:_initFunc()
    if self.m_data == nil or self.m_data.info == nil then
        self.wageSlider.value = 0
        self:_showPercentValue(0)
        return
    end

    if self.m_data.info.salary ~= nil then
        local value = (self.m_data.info.salary - 50) / 15
        if value < 0 then
            value = 0
        end
        self.wageSlider.value = value
        self:_showPercentValue(value)  --工资比率
    else
        self:_showPercentValue(2)
    end

    self.effectExpWordText.text = GetLanguage(BuildingSalaryEffectConfig[self.m_data.info.mId].languageId)
    local staffNum = PlayerBuildingBaseData[self.m_data.info.mId].maxWorkerNum
    self.staffNumText.text = staffNum
    local standardWage = DataManager.GetBuildingStandardWage()
    if standardWage == nil then
        DataManager.m_ReqStandardWage(self.m_data.info.mId)
    else
        self.standardWageText.text = string.format("E%s/d", GetClientPriceString(standardWage))
        self.totalText.text = "E"..self.m_data.info.salary * staffNum * GetClientPriceString(standardWage)
    end

    local trueTextW = self.effectiveDateText.preferredWidth
    self.effectiveDateText.rectTransform.sizeDelta = Vector2.New(trueTextW, self.effectiveDateText.rectTransform.sizeDelta.y)
    self.effectTime = TimeSynchronized.GetTheCurrentTime()
    self.effectiveDateText.text = os.date("%Y/%m%d %H:%M:%S", self.effectTime)
end

--根据选中的档位显示数据
function BuildingSalaryDetailPart:_showPercentValue(level)
    if self.m_data == nil then
        return
    end
    if level == 0 then
        self.simple50Text.localScale = Vector3.zero
        self.simple75Text.localScale = Vector3.one
        self.simple100Text.localScale = Vector3.one

        self.select50Text.localScale = Vector3.one
        self.select75Text.localScale = Vector3.zero
        self.select100Text.localScale = Vector3.zero
        self.effectText.text = BuildingSalaryEffectConfig[self.m_data.info.mId].effect50
    elseif level == 1 then
        self.simple50Text.localScale = Vector3.one
        self.simple75Text.localScale = Vector3.zero
        self.simple100Text.localScale = Vector3.one

        self.select50Text.localScale = Vector3.zero
        self.select75Text.localScale = Vector3.one
        self.select100Text.localScale = Vector3.zero
        self.effectText.text = BuildingSalaryEffectConfig[self.m_data.info.mId].effect75
    elseif level == 2 then
        self.simple50Text.localScale = Vector3.one
        self.simple75Text.localScale = Vector3.one
        self.simple100Text.localScale = Vector3.zero

        self.select50Text.localScale = Vector3.zero
        self.select75Text.localScale = Vector3.zero
        self.select100Text.localScale = Vector3.one
        self.effectText.text = BuildingSalaryEffectConfig[self.m_data.info.mId].effect100
    end
end
--
function BuildingSalaryDetailPart:_getStandardWage(data)
    if data.industryWages ~= nil then
        DataManager.SetBuildingStandardWage(data.type, data.industryWages)
        self.standardWageText.text = string.format("E%s/d", GetClientPriceString(data.industryWages))
        self.totalText.text = "E"..self.m_data.info.salary * PlayerBuildingBaseData[self.m_data.info.mId].maxWorkerNum * GetClientPriceString(data.industryWages)
    end
end
--
function BuildingSalaryDetailPart:clickConfirmBtn()

end
--
function BuildingSalaryDetailPart:clickCloseBtn()
    self.groupClass.TurnOffAllOptions(self.groupClass)
end
