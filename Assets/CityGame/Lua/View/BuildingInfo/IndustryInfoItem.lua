---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/8/12 10:15
---Industry information item
IndustryInfoItem = class('IndustryInfoItem')
local lastBg
local instance = {}
local titleItem = {}

--Initialization method data (read configuration table)
function IndustryInfoItem:initialize(inluabehaviour, prefab, goodsDataInfo,msg)
    self.prefab = prefab;
    self.goodsDataInfo = goodsDataInfo;
    self._luabehaviour = inluabehaviour
    self.msg = msg

    self.notSelect = self.prefab.transform:Find("notSelectBg").gameObject
    self.notSelectText = self.prefab.transform:Find("notSelectBg/Text"):GetComponent("Text");
    self.select = self.prefab.transform:Find("selectBg")
    self.selectText = self.prefab.transform:Find("selectBg/Text"):GetComponent("Text");

    self.notSelectText.text = GetLanguage(goodsDataInfo.name)
    self.selectText.text = GetLanguage(goodsDataInfo.name)

    self._luabehaviour:AddClick(self.notSelect, self.OnNotSelect, self);
end

function IndustryInfoItem:OnNotSelect(go)
    PlayMusEff(1002)
    if lastBg then
        lastBg.notSelect.transform.localScale = Vector3.one
        lastBg.select.localScale = Vector3.zero
    end
    go.notSelect.transform.localScale = Vector3.zero
    go.select.localScale = Vector3.one
    lastBg = go

    CityInfoPanel.threeRank:SetActive(false)
    if go.goodsDataInfo.content == nil then
        DataManager.DetailModelRpcNoRet(go.msg.m_data.insId, 'm_queryIndustryIncome')  --Check industry income
        CityInfoPanel.industryBg.localScale = Vector3.one
        CityInfoPanel.oneContent.localScale = Vector3.zero
    else
        CityInfoPanel.industryBg.localScale = Vector3.zero
        CityInfoPanel.oneContent.localScale = Vector3.one
        CityInfoPanel.titleBg:GetComponent("GridLayoutGroup").cellSize = Vector2.New(go.msg.width / #go.goodsDataInfo.content,84)
        if #instance == #go.goodsDataInfo.content then
            titleItem = {}
            for i, v in ipairs(go.goodsDataInfo.content) do
                titleItem[v.id] = CityInfoTitleItem:new(go._luabehaviour,instance[i],v,go)
            end
        elseif #instance < #go.goodsDataInfo.content then
            if #titleItem == 0 then   --the first time
                for i, v in ipairs(go.goodsDataInfo.content) do
                    local temp = createPrefabs(CityInfoPanel.title,CityInfoPanel.titleBg)
                    table.insert(instance,temp)
                    titleItem[v.id] = CityInfoTitleItem:new(go._luabehaviour,instance[i],v,go)
                end
            else
                for i = 1, #go.goodsDataInfo.content - #instance do
                     local temp = createPrefabs(CityInfoPanel.title,CityInfoPanel.titleBg)
                    table.insert(instance,temp)
                end
                    titleItem = {}
                for i, v in ipairs(go.goodsDataInfo.content) do
                  titleItem[v.id] = CityInfoTitleItem:new(go._luabehaviour,instance[i],v,go)
                   end
            end
        elseif #instance > #go.goodsDataInfo.content then
            for i = 1, #instance - #go.goodsDataInfo.content do
                destroy(titleItem[1].prefab.gameObject)
                table.remove(instance,1)
            end
            titleItem = {}
            for i, v in ipairs(go.goodsDataInfo.content) do
                titleItem[v.id] = CityInfoTitleItem:new(go._luabehaviour,instance[i],v,go)
            end
        end
        titleItem[1].notSelect.transform.localScale = Vector3.zero
        titleItem[1].select.localScale = Vector3.one
        titleItem[1]:SetLast(titleItem[1])
        titleItem[1]:ShowPanel(titleItem[1])
    end
end

function IndustryInfoItem:_initPanel()
    lastBg.notSelect.transform.localScale = Vector3.one
    lastBg.select.localScale = Vector3.zero
    if next(titleItem) then
        titleItem[1]:SetLast(titleItem[1])
    end
end

function IndustryInfoItem:GetLast()
    return lastBg
end

function IndustryInfoItem:SetLast(ins)
    lastBg = ins
end

function IndustryInfoItem:GetTitle()
    return titleItem[1]
end

