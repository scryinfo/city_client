---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2018/10/25/025 17:47
---


require "Common/define"

require('Framework/UI/UIPage')

local class = require 'Framework/class'
ScienceSellPopCtrl = class('ScienceSellPopCtrl',UIPage)
UIPage:ResgisterOpen(ScienceSellPopCtrl) --注册打开的方法

---构建函数
function ScienceSellPopCtrl:initialize()
    UIPage.initialize(self,UIType.PopUp,UIMode.DoNothing,UICollider.None);
end

function ScienceSellPopCtrl:bundleName()
    return "Assets/CityGame/Resources/View/ScienceSellPopPanel.prefab";
end

function ScienceSellPopCtrl:OnCreate(obj)
    UIPage.OnCreate(self,obj);
end
local panel
local Mgr
function ScienceSellPopCtrl:Awake(go)
    self.gameObject = go;
    panel=ScienceSellPopPanel
    local materialBehaviour = self.gameObject:GetComponent('LuaBehaviour');
    materialBehaviour:AddClick(panel.backBtn.gameObject,self.OnClick_backBtn,self);
    materialBehaviour:AddClick(panel.okBtn.gameObject,self.OnClick_confirm,self);
    materialBehaviour:AddClick(panel.plusBtn.gameObject,self.OnClick_plus,self);
    materialBehaviour:AddClick(panel.cutBtn.gameObject,self.OnClick_cut,self);
   Mgr=ScienceSellHallModel.Mgr
end

---close
function ScienceSellPopCtrl:OnClick_backBtn(ins)
    ins:Hide()
end

---cut
function ScienceSellPopCtrl:OnClick_cut()
    if panel.levleInp.text=="" or tonumber(panel.levleInp.text) <0 then
        panel.levleInp.text=0
    end
    if tonumber(panel.levleInp.text)- 1<0 then
        panel.levleInp.text=0
        return
    end
    panel.levleInp.text=panel.levleInp.text-1
end

---plus
function ScienceSellPopCtrl:OnClick_plus()
    if panel.levleInp.text=="" or tonumber(panel.levleInp.text) <0 then
        panel.levleInp.text=0
    end
 panel.levleInp.text=panel.levleInp.text+1
end

---confirm
function ScienceSellPopCtrl:OnClick_confirm(ins)
    if panel.levleInp.text=="" or tonumber(panel.levleInp.text) <0 or
      panel.priceInp.text=="" or tonumber(panel.priceInp.text) <=0    then
       return
    end

    Mgr.scienceInsList[1].levelText.text =panel.levleInp.text
    Mgr.scienceInsList[1].priceText.text = getPriceString(panel.priceInp.text..".0000",30,24)
    Mgr.scienceItemList[1]:SetActive(true)

    Event.Brocast("SmallPop","Success",257)
    Event.Brocast("m_techTradeAdd",ins.m_data.itemId,tonumber(panel.levleInp.text),tonumber(panel.priceInp.text))
    ---clear
    panel.levleInp.text=0
    panel.priceInp.text=0
    ins:Hide();
end

function ScienceSellPopCtrl:Refresh()

    panel.iconImage.sprite=self.m_data.iconImage.sprite
    panel.iconImage:SetNativeSize()


end





