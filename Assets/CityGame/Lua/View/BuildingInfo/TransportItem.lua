---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Fisher.
--- DateTime: 2019/4/18 11:07
---
TransportItem = class('TransportItem')

local ToNumber = tonumber
local StringSun = string.sub
--奢侈等级
local oneLevel = Vector3.New(105,174,238)
local twoLevel = Vector3.New(156,136,228)
local threeLevel = Vector3.New(243,185,45)
function TransportItem:initialize(dataInfo,prefab,luaBehaviour,keyId,goodsType,unitPrice)
    self.keyId = keyId
    self.prefab = prefab
    self.dataInfo = ct.deepCopy(dataInfo)
    self.goodsType = goodsType
    self.unitPrice = unitPrice
    self.itemId = dataInfo.itemId

    self.iconImg = prefab.transform:Find("goodsInfo/iconImg"):GetComponent("Image")
    self.nameBg = prefab.transform:Find("goodsInfo/nameBg")
    self.nameText = prefab.transform:Find("goodsInfo/nameBg/nameText"):GetComponent("Text")

    --需要隐藏的商品信息
    self.goods = prefab.transform:Find("goodsInfo/goods")
    self.levelImg = prefab.transform:Find("goodsInfo/goods/levelImg"):GetComponent("Image")
    self.brandNameText = prefab.transform:Find("goodsInfo/goods/detailsBg/brandNameText"):GetComponent("Text")
    self.brandValue = prefab.transform:Find("goodsInfo/goods/detailsBg/scoreBg/brandIcon/brandValue"):GetComponent("Text")
    self.qualityValue = prefab.transform:Find("goodsInfo/goods/detailsBg/scoreBg/qualityIcon/qualityValue"):GetComponent("Text")
    self.numberText = prefab.transform:Find("number/numberText"):GetComponent("Text")
    self.goodsCost = prefab.transform:Find("total/goodsCost"):GetComponent("Text")
    self.goodsPriceText = prefab.transform:Find("total/goodsCost/goodsPriceText"):GetComponent("Text")
    self.freight = prefab.transform:Find("total/freight"):GetComponent("Text")
    self.freightPriceText = prefab.transform:Find("total/freight/freightPriceText"):GetComponent("Text")
    self.deleBtn = prefab.transform:Find("deleBtn")

    self:_language()
    luaBehaviour:AddClick(self.deleBtn.gameObject,self._closeDeleBtn,self)

    self:InitializeData()
end

function TransportItem:InitializeData()
    self.nameText.text = GetLanguage(self.itemId)
    self.numberText.text = "×"..self.dataInfo.number
    --运输还是购买（购买会有物品价格，运输只有运费）
    if self.dataInfo.state == GoodsItemStateType.buy then
        self.goodsCost.transform.localScale = Vector3.one
        self.goodsPriceText.text = GetClientPriceString(self.dataInfo.number * self.dataInfo.price)
        self.freightPriceText.text = GetClientPriceString(ToNumber(self.dataInfo.number) * ToNumber(self.unitPrice))
    elseif self.dataInfo.state == GoodsItemStateType.transport then
        self.goodsCost.transform.localScale = Vector3.zero
        self.freight.transform.localPosition = Vector3(-310,0,0)
        self.freightPriceText.text = GetClientPriceString(ToNumber(self.dataInfo.number) * ToNumber(self.unitPrice))
    end
    local materialKey,goodsKey = 21,22
    if ToNumber(StringSun(self.itemId,1,2)) == materialKey then
        self.goods.transform.localScale = Vector3.zero
        self.nameBg.transform.localPosition = Vector3(-140,-100,0)
        LoadSprite(Material[self.itemId].img,self.iconImg,false)
    elseif ToNumber(StringSun(self.itemId,1,2)) == goodsKey then
        self.goods.transform.localScale = Vector3.one
        LoadSprite(Good[self.itemId].img,self.iconImg,false)
        --如果是商品，判断原料等级
        if Good[self.itemId].luxury == 1 then
            self.levelImg.color = getColorByVector3(oneLevel)
        elseif Good[self.itemId].luxury == 2 then
            self.levelImg.color = getColorByVector3(twoLevel)
        elseif Good[self.itemId].luxury == 3 then
            self.levelImg.color = getColorByVector3(threeLevel)
        end
        self.brandNameText.text = self.dataInfo.brandName
        self.brandValue.text = self.dataInfo.brandScore
        self.qualityValue.text = self.dataInfo.qualityScore
    end
end

function TransportItem:_language()
    self.goodsCost.text = "商品费用:"
    self.freight.text = "运输费用:"
end
function TransportItem:_closeDeleBtn(ins)
    Event.Brocast("deleteItemPrefab",ins.keyId)
end

--刷新自身列表Id
function TransportItem:RefreshID(id)
    self.keyId = id
end