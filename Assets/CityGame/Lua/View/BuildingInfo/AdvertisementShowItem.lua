---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/9/20 11:00
---
local class = require 'Framework/class'

AdvertisementShowItem = class('AdvertisementShowItem')
AdvertisementShowItem.static.TOTAL_H = 781 --The height of the entire Item
AdvertisementShowItem.static.CONTENT_H = 700  --Display height
AdvertisementShowItem.static.TOP_H = 100  --the height of the top bar


function AdvertisementShowItem:initialize(itemlData, clickOpenFunc, itemRect, mainPanelLuaBehaviour, toggleData, mgrTable)
    self.viewRect = itemRect
    self.rentalData = itemlData
    self.toggleData = toggleData  --Located in the first few of toggle, left or right

    self.contentRoot = self.viewRect.transform:Find("contentRoot"):GetComponent("RectTransform");  --Content Rect
    self.openStateTran = self.viewRect.transform:Find("topRoot/open");  --Open state
    self.closeStateTran = self.viewRect.transform:Find("topRoot/close");  --Disabled
    self.openBtns = self.viewRect.transform:Find("topRoot/close/openBtns");  --Open button
    self.toDoBtn = self.viewRect.transform:Find("topRoot/open/doSthBtn");  --Execute button after opening

    --todo:Text assignment
    self.price = itemRect:Find("contentRoot/head/Text/numText"):GetComponent("Text")
    self.acount = itemRect:Find("contentRoot/head/Text (1)/numText"):GetComponent("Text")
    self.day = itemRect:Find("contentRoot/head/Text (2)/numText"):GetComponent("Text")

    --todo:Multilingual assignment
    self.topicText = itemRect:Find("contentRoot/head/toptic/Text"):GetComponent("Text")
    self.priceText = itemRect:Find("contentRoot/head/Text"):GetComponent("Text")
    self.acountText = itemRect:Find("contentRoot/head/Text (1)"):GetComponent("Text")
    self.dayText = itemRect:Find("contentRoot/head/Text (2)"):GetComponent("Text")

    mainPanelLuaBehaviour:AddClick(self.openBtns.gameObject, function()
        clickOpenFunc(mgrTable, self.toggleData)
    end);
    mainPanelLuaBehaviour:AddClick(self.toDoBtn.gameObject,self.OntodoBtn)

    Event.AddListener("c_AdvertisementShowValueChange", self.updateInfo, self);
    Event.AddListener("c_ShowItemValueChange", self.c_ShowItemValueChange, self);
    Event.AddListener("c_ShowItemTextChange", self.c_ShowItemTextChange, self);

end

--Text assignment
function AdvertisementShowItem:c_ShowItemValueChange(price,acount,day)
    self.price.text = price
    self.acount .text= acount
    self.day.text = day.."(day)"
end
--Multilingual assignment
function AdvertisementShowItem:c_ShowItemTextChange()
    --self.topicText = itemRect:Find("contentRoot/head/toptic/Text"):GetComponent("Text")
    --self.priceText = itemRect:Find("contentRoot/head/Text"):GetComponent("Text")
    --self.acountText = itemRect:Find("contentRoot/head/Text (1)"):GetComponent("Text")
    --self.dayText = itemRect:Find("contentRoot/head/Text (2)"):GetComponent("Text")
end

--Get the number of clicks
function AdvertisementShowItem:getToggleIndex()
    return self.toggleData.index
end

--open
function AdvertisementShowItem:openToggleItem(targetMovePos)
    self.buildingInfoToggleState = BuildingInfoToggleState.Open;

    self.openStateTran.localScale = Vector3.one;
    self.closeStateTran.localScale = Vector3.zero;

    self.viewRect:DOAnchorPos(targetMovePos, BuildingInfoToggleGroupMgr.static.ITEM_MOVE_TIME):SetEase(DG.Tweening.Ease.OutCubic);
    self.contentRoot:DOSizeDelta(Vector2.New(self.contentRoot.sizeDelta.x, AdvertisementShowItem.static.CONTENT_H), BuildingInfoToggleGroupMgr.static.ITEM_MOVE_TIME):SetEase(DG.Tweening.Ease.OutCubic);

    return Vector2.New(targetMovePos.x,targetMovePos.y - AdvertisementShowItem.static.TOTAL_H);
end

--shut down
function AdvertisementShowItem:closeToggleItem(targetMovePos)
    self.buildingInfoToggleState = BuildingInfoToggleState.Close;

    self.openStateTran.localScale = Vector3.zero;
    self.closeStateTran.localScale = Vector3.one;

    self.contentRoot:DOSizeDelta(Vector2.New(self.contentRoot.sizeDelta.x,0),BuildingInfoToggleGroupMgr.static.ITEM_MOVE_TIME):SetEase(DG.Tweening.Ease.OutCubic);
    self.viewRect:DOAnchorPos(targetMovePos, BuildingInfoToggleGroupMgr.static.ITEM_MOVE_TIME):SetEase(DG.Tweening.Ease.OutCubic);

    return Vector2.New(targetMovePos.x,targetMovePos.y - AdvertisementShowItem.static.TOP_H);
end

--Refresh data
function AdvertisementShowItem:updateInfo(data)

end

function AdvertisementShowItem:OntodoBtn(ins)
    ---test
    local data={}
    data.Buildingowner=Buildingowner.other
    ct.OpenCtrl('AdvertisementPosCtrl',Buildingowner.other)
end
