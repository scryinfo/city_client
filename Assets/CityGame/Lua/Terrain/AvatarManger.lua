---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2019/2/27/027 18:03
---

HeadSizeType={
    small={
        [0]={width=70,heigth=70},
        [1]={ type="body",width=70,heigth=70},
        [2]={ type="backHat",width=70,heigth=70},
        [3]={ type="head",width=70,heigth=70},
        [4]={ type="decal",width=70,heigth=70},
        [5]={ type="brow",width=70,heigth=70},
        [6]={ type="hair",width=70,heigth=70},
        [7]={ type="eyes",width=70,heigth=70},
        [8]={ type="nose",width=70,heigth=70},
        [9]={ type="frontHat",width=70,heigth=70},
        [10]={ type="mouth",width=70,heigth=70},
    },
    big={




    },
}

AvatarManger={}

local  appearance={}
local headPool={}

local num,sex,currHead,headTypeId

function  AvatarManger.Awake()
    headPool={}
    headPool[1],headPool[2]={},{}
    for i = 1, 6 do
        headPool[1][i]= LuaGameObjectPool:new(i,creatGoods(HeadConfig.man[i].path),1,Vector3.New(0,0,0) )
    end
    for i = 1, 8 do
        headPool[2][i]= LuaGameObjectPool:new((i+10),creatGoods(HeadConfig.woMan[i].path),1,Vector3.New(0,0,0) )
    end
end

 function AvatarManger.setSize(go,configType)
    local V,H=UnityEngine.RectTransform.Axis.Vertical,UnityEngine.RectTransform.Axis.Horizontal
     go.transform:GetComponent("RectTransform"):SetSizeWithCurrentAnchors(H,configType[0].width)
     go.transform:GetComponent("RectTransform"):SetSizeWithCurrentAnchors(V,configType[0].heigth)

     for i, sizeData in ipairs(configType) do
        local trans=go.transform:Find(sizeData.type)
        if trans then
            local ima=trans:GetComponent("Image")
            ima.rectTransform:SetSizeWithCurrentAnchors(V,sizeData.heigth)
            ima.rectTransform:SetSizeWithCurrentAnchors(H,sizeData.width)
        end
    end
    return go
end

local function FindOrgan(transform)
    if not appearance["body"] then
        appearance["body"]={}
        appearance["backHat"]={}
        appearance["head"]={}
        appearance["haircut"]={}
        appearance["nose"]={}
        appearance["brow"]={}
        appearance["frontHat"]={}
        appearance["eyes"]={}
        appearance["mouth"]={}
        appearance["decal"]={}
        appearance["goatee"]={}
    end

    appearance["body"].ima=transform:Find("body"):GetComponent("Image")
    appearance["backHat"].ima=transform:Find("backHat"):GetComponent("Image")
    appearance["head"].ima=transform:Find("head"):GetComponent("Image")
    appearance["haircut"].ima=transform:Find("hair"):GetComponent("Image")
    appearance["nose"].ima=transform:Find("nose"):GetComponent("Image")
    appearance["brow"].ima=transform:Find("brow"):GetComponent("Image")
    appearance["frontHat"].ima=transform:Find("frontHat"):GetComponent("Image")
    appearance["eyes"].ima=transform:Find("eyes"):GetComponent("Image")
    appearance["mouth"].ima=transform:Find("mouth"):GetComponent("Image")

    appearance["decal"].ima=transform:Find("decal")
    appearance["goatee"].ima=transform:Find("goatee")

    if appearance["decal"].ima then
        appearance["decal"].ima=transform:Find("decal"):GetComponent("Image")
        appearance["goatee"].ima=transform:Find("goatee"):GetComponent("Image")
    end


end

local function changAparance(kind)
    local arr,path,type,nums
    arr=split(kind.path,",")
    path=arr[1]
    type=arr[2]

    nums=num
    --特殊处理头和帽子
    if type=="head" then
        local config
        if sex==1 then
            config=HeadConfig.man
        else
            config=HeadConfig.woMan
        end
        headTypeId=nums

        currHead=headPool[sex][headTypeId]:GetAvailableGameObject()

        FindOrgan(currHead.transform)

        --加载原来服饰
        for key, value in pairs(appearance) do
            if key ~= "head"  then

                if appearance[key].path=="" then--部件不要的处理
                    if appearance[key].ima and appearance[key].ima.transform then
                        appearance[key].ima.transform.gameObject:SetActive(false)
                    end
                else--部件要的处理
                    if appearance[key].ima and appearance[key].ima.transform and appearance[key].path then
                        appearance[key].ima.transform.gameObject:SetActive(true)
                        LoadSprite(appearance[key].path,appearance[key].ima)
                    end
                end

                if key=="frontHat" then
                    if appearance["backHat"].path=="" then--部件不要的处理
                        appearance["backHat"].ima.transform.gameObject:SetActive(false)
                    else--部件不要的处理
                        appearance["backHat"].ima.transform.gameObject:SetActive(true)
                        LoadSprite(appearance["backHat"].path,appearance["backHat"].ima)
                    end
                end

            end
        end

    elseif type=="frontHat" then
        if arr[3]=="" then
            appearance[arr[4]].ima.transform.gameObject:SetActive(false)
        else
            appearance[arr[4]].ima.transform.gameObject:SetActive(true)
            LoadSprite(arr[3],appearance[arr[4]].ima)
        end
        appearance["backHat"]={}
        appearance["backHat"].path=arr[3]
    end

    appearance[type].typeId=nums
    appearance[type].type=type
    appearance[type].path=path


    if path=="" then
        appearance[type].ima.transform.gameObject:SetActive(false)
    else
        appearance[type].ima.transform.gameObject:SetActive(true)
        LoadSprite(path,appearance[type].ima)
    end

end

function AvatarManger.GetBigAvatar(faceId)
    local arr,config=split(faceId,"-")

    sex=tonumber(arr[1])
    --加载小人头像
    currHead =headPool[sex][1]:GetAvailableGameObject()
    FindOrgan(currHead.transform)
    --配置表
    if sex==1 then
        config=AvtarConfig.man
    else
        config=AvtarConfig.woMan
    end
    --换装
    local temp=split(arr[2],",")
    for i = 1, #temp ,2 do
        if temp[i]~="" then
            local type=tonumber(temp[i])
            local typeId=tonumber(temp[i+1])
            local kind=config[type].kinds[typeId]
            num=type
            changAparance(kind)
        end
    end

    --便于回收
    local temp ={}
    temp.sex=sex
    temp.headTypeId=headTypeId
    temp.go=currHead

    return temp
end

function AvatarManger.GetSmallAvatar(faceId)
    local AvatarData= AvatarManger.GetBigAvatar(faceId)

    local go= AvatarManger.setSize(AvatarData.go,HeadSizeType.small)
    AvatarData.go=go
    return AvatarData
end

function AvatarManger.CollectAvatar(AvatarData)
    if AvatarData then
        headPool[AvatarData.sex][AvatarData.headTypeId]:RecyclingGameObjectToPool(AvatarData.go)
    end
end























--function AvatarManger.GetBigAvtar(faceId)
--    local arr=split(faceId,"-")
--    if arr[1]=="1" then--男人
--        sex=1
--        --todo：加载小人头像
--        headPrefab[sex][1]=creatGoods(HeadConfig.man[1].path,panel.showContent)
--        currHead=headPrefab[sex][1]
--        FindOrgan(headPrefab[sex][1].transform)
--        local temp=split(arr[2],",")
--        for i = 1, #temp ,2 do
--            if temp[i]~="" then
--                local type=tonumber(temp[i])
--                local typeId=tonumber(temp[i+1])
--                local kind=AvtarConfig.man[type].kinds[typeId]
--                num=type
--                this:changAparance(kind)
--            end
--        end
--
--    else--女人
--        sex=2
--        --todo：加载小人头像
--        local temp=split(arr[2],",")
--        for i = 1, #temp ,2 do
--            local kind=AvtarConfig.woMan[temp[i]].kinds[temp[i+1]].path
--            this:changAparance(kind)
--        end
--
--    end
--
--    return currHead
--end
