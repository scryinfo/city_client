---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/2/28 15:26
---

GuildMenu = class("GuildMemberItem")
GuildMenu.static.NomalColor = Vector3.New(19, 27, 56) -- 默认的背景色
GuildMenu.static.SelectColor = Vector3.New(46, 58, 100) -- 被选中的背景色
GuildMenu.static.IdentityTable = -- 不同职位的匹配
{
    ["MEMBER"] = {index = 1},
    ["ADMINISTRATOR"] = {index = 2},
    ["VICE_CHAIRMAN"] = {index = 3},
    ["CHAIRMAN"] = {index = 4},
}

function GuildMenu:initialize(prefab)
    self.prefab = prefab
    local transform = prefab.transform

    self.outBtn = transform:Find("OutBtn")
    self.appointBtn = transform:Find("AppointBtn")
    self.appointImage = transform:Find("AppointBtn"):GetComponent("Image")
    self.addFriendsBtn = transform:Find("AddFriendsBtn"):GetComponent("Button")
    self.addFriendsBtnRt = transform:Find("AddFriendsBtn"):GetComponent("RectTransform")
    self.personalDataButton = transform:Find("PersonalDataButton"):GetComponent("Button")
    self.personalDataButtonRt = transform:Find("PersonalDataButton"):GetComponent("RectTransform")
    self.appointRoot = transform:Find("AppointRoot")
    self.identity4Btn = transform:Find("AppointRoot/Identity4Btn").gameObject
    self.identity3Btn = transform:Find("AppointRoot/Identity3Btn").gameObject
    self.identity2Btn = transform:Find("AppointRoot/Identity2Btn").gameObject
    self.identity1Btn = transform:Find("AppointRoot/Identity1Btn").gameObject

    self:SetAppointRoot(false)

    self.outBtn:GetComponent("Button").onClick:AddListener(function ()
        self:_onOut()
    end)
    self.appointBtn:GetComponent("Button").onClick:AddListener(function ()
        self:_onAppoint()
    end)
    self.addFriendsBtn.onClick:AddListener(function ()
        self:_onAddFriends()
    end)
    self.personalDataButton.onClick:AddListener(function ()
        self:_onPersonalData()
    end)
    self.identity4Btn:GetComponent("Button").onClick:AddListener(function ()
        self:_onAppointerPost(0)
    end)
    self.identity3Btn:GetComponent("Button").onClick:AddListener(function ()
        self:_onAppointerPost(2)
    end)
    self.identity2Btn:GetComponent("Button").onClick:AddListener(function ()
        self:_onAppointerPost(3)
    end)
    self.identity1Btn:GetComponent("Button").onClick:AddListener(function ()
        self:_onAppointerPost(1)
    end)
end

function GuildMenu:SetAppointRoot(isShow)
    if isShow then
        self.appointRoot.localScale = Vector3.one
    else
        self.appointRoot.localScale = Vector3.zero
    end
end

function GuildMenu:SetPrefabShow(isShow)
    self.prefab:SetActive(isShow)
end

function GuildMenu:SetAppointImageColor(isShow)
    if isShow then
        self.appointImage.color = getColorByVector3(GuildMenu.static.NomalColor, 230)
    else
        self.appointImage.color = getColorByVector3(GuildMenu.static.SelectColor, 230)
    end
end

function GuildMenu:_onOut()
    PlayMusEff(1002)
    self:SetPrefabShow(false)
    GuildOwnCtrl.static.guildMgr:SetClickInteractable()
    --打开弹框
    local showData = {}
    showData.titleInfo = "提示"
    showData.contentInfo = "确定踢出成员?"
    showData.tipInfo = ""
    showData.btnCallBack = function()
        DataManager.DetailModelRpcNoRet(OpenModelInsID.GuildOwnCtrl, "m_KickMember", {societyId = DataManager.GetGuildID(), playerId = GuildOwnCtrl.static.guildMgr:GetPlayerId()})
    end
    ct.OpenCtrl("BtnDialogPageCtrl", showData)
end

function GuildMenu:_onAppoint()
    PlayMusEff(1002)
    self:SetAppointRoot(true)
    self:SetAppointImageColor(false)
    --local playerData = GuildOwnCtrl.static.guildMgr:GetPlayerData()
    --if playerData.identity == "CHAIRMAN"then
    --    self.identity4Btn:SetActive(false)
    --    self.vicechairmanBtn:SetActive(true)
    --    self.administratorBtn:SetActive(true)
    --    self.memberBtn:SetActive(true)
    --elseif playerData.identity == "VICE_CHAIRMAN"then
    --    self.identity4Btn:SetActive(true)
    --    self.vicechairmanBtn:SetActive(false)
    --    self.administratorBtn:SetActive(true)
    --    self.memberBtn:SetActive(true)
    --elseif playerData.identity == "ADMINISTRATOR"then
    --    self.identity4Btn:SetActive(true)
    --    self.vicechairmanBtn:SetActive(true)
    --    self.administratorBtn:SetActive(false)
    --    self.memberBtn:SetActive(true)
    --elseif playerData.identity == "MEMBER"then
    --    self.identity4Btn:SetActive(true)
    --    self.vicechairmanBtn:SetActive(true)
    --    self.administratorBtn:SetActive(true)
    --    self.memberBtn:SetActive(false)
    --end
end

function GuildMenu:_onAddFriends()
    PlayMusEff(1002)
    self:SetPrefabShow(false)
    GuildOwnCtrl.static.guildMgr:SetClickInteractable()
    local data = {}
    data.titleInfo = GetLanguage(12040002)
    data.tipInfo = GetLanguage(12040003)
    data.inputInfo = GetLanguage(15010023)
    data.btnCallBack = function(text)
        ct.log("tina_w8_friends", "向服务器发送加好友信息")
        DataManager.DetailModelRpcNoRet(OpenModelInsID.GuildOwnCtrl, "m_AddFriends", { id = GuildOwnCtrl.static.guildMgr:GetPlayerId(), desc = text })
        Event.Brocast("SmallPop", GetLanguage(12040004),80)
    end
    ct.OpenCtrl("CommonDialogCtrl", data)
end

function GuildMenu:_onPersonalData()
    PlayMusEff(1002)
    self:SetPrefabShow(false)
    GuildOwnCtrl.static.guildMgr:SetClickInteractable()
end

function GuildMenu:_onAppointerPost(index)
    PlayMusEff(1002)
    self:SetPrefabShow(false)
    GuildOwnCtrl.static.guildMgr:SetClickInteractable()
    --打开弹框
    local tips
    if index == 0 then
        tips = "确认退位让贤？"
    elseif index == 1 then
        tips = "确认任命为会员？"
    elseif index == 2 then
        tips = "确认任命为副会长？"
    elseif index == 3 then
        tips = "确认任命为管理？"
    end
    local showData = {}
    showData.titleInfo = "提示"
    showData.contentInfo = tips
    showData.tipInfo = ""
    showData.btnCallBack = function()
        DataManager.DetailModelRpcNoRet(OpenModelInsID.GuildOwnCtrl, "m_AppointerPost", {societyId = DataManager.GetGuildID(), playerId = GuildOwnCtrl.static.guildMgr:GetPlayerId(), identity = index})
    end
    ct.OpenCtrl("BtnDialogPageCtrl", showData)
end

function GuildMenu:_SetIdentity()
    local playerDataIndex = GuildMenu.static.IdentityTable[GuildOwnCtrl.static.guildMgr:GetPlayerData().identity].index
    local ownIdentityIndex = GuildMenu.static.IdentityTable[GuildOwnCtrl.static.guildMgr:GetOwnGuildIdentity()].index
    if playerDataIndex < ownIdentityIndex then
        self.outBtn.localScale  = Vector3.one
        self.appointBtn.localScale  = Vector3.one
        self.addFriendsBtnRt.anchoredPosition = Vector2.New(0, 254)
        self.personalDataButtonRt.anchoredPosition = Vector2.New(0, 356)
        if ownIdentityIndex == 4 then
            self.identity4Btn:SetActive(true)
            self.identity3Btn:SetActive(true)
            self.identity2Btn:SetActive(true)
            self.identity1Btn:SetActive(true)
            self["identity".. tostring(playerDataIndex) .. "Btn"]:SetActive(false)
        else
            for i = 1, ownIdentityIndex - 1 do
                if i == playerDataIndex then
                    self["identity".. tostring(i) .. "Btn"]:SetActive(false)
                else
                    self["identity".. tostring(i) .. "Btn"]:SetActive(true)
                end
            end
        end
    else
        self.outBtn.localScale  = Vector3.zero
        self.appointBtn.localScale  = Vector3.zero
        self.addFriendsBtnRt.anchoredPosition = Vector2.New(0, 50)
        self.personalDataButtonRt.anchoredPosition = Vector2.New(0, 152)
    end
end