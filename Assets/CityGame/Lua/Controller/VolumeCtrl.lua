---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/3/1 9:51
---交易量ctrl
VolumeCtrl = class('VolumeCtrl',UIPanel)
UIPanel:ResgisterOpen(VolumeCtrl)
--VolumeCtrl.static.Head_PATH = "View/GoodsItem/RoleHeadItem"

local volumeBehaviour;
local isClother = true
local clothes =  {
    [1] = {
        itemId = 2251101,
        demand = 2000,
        supply = 500,
    },
    [2] = {
        itemId = 2251102,
        demand = 2000,
        supply = 300,
    },
    [3] = {
        itemId = 2251103,
        demand = 2000,
        supply = 2100,
    },
    [4] = {
        itemId = 2251201,
        demand = 1500,
        supply = 2100,
    },
    [5] = {
        itemId = 2251202,
        demand = 3600,
        supply = 2100,
    },[6] = {
        itemId = 2251203,
        demand = 4000,
        supply = 2100,
    },
}
local food = {
    [1] = {
        itemId = 2252101,
        demand = 1800,
        supply = 2100,
    },[2] = {
        itemId = 2252102,
        demand = 2000,
        supply = 300,
    },[3] = {
        itemId = 2252103,
        demand = 2000,
        supply = 450,
    },[4] = {
        itemId = 2252201,
        demand = 2000,
        supply = 120,
    },[5] = {
        itemId = 2252202,
        demand = 2000,
        supply = 1000,
    },[6] = {
        itemId = 2252203,
        demand = 3000,
        supply = 2100,
    },
}

function  VolumeCtrl:bundleName()
    return "Assets/CityGame/Resources/View/VolumePanel.prefab"
end

function VolumeCtrl:initialize()
    UIPanel.initialize(self,UIType.Normal,UIMode.HideOther,UICollider.None)--可以回退，UI打开后，隐藏其它面板
    --UIPanel.initialize(self,UIType.Normal,UIMode.NeedBack,UICollider.None)--可以回退，UI打开后，不隐藏其它的UI
end
function VolumeCtrl:Awake()
    volumeBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    volumeBehaviour:AddClick(VolumePanel.back,self.OnBack,self)
    volumeBehaviour:AddClick(VolumePanel.clotherBtn,self.OnClotherBtn,self)
    volumeBehaviour:AddClick(VolumePanel.foodBtn,self.OnFoodBtn,self)
    self.insId = OpenModelInsID.VolumeCtrl

    DataManager.OpenDetailModel(VolumeModel,self.insId )

    DataManager.DetailModelRpcNoRet(self.insId , 'm_GoodsNpcNum') --每种商品购买的npc数量

    --滑动互用
    self.supplyDemand = UnityEngine.UI.LoopScrollDataSource.New()  --行情
    self.supplyDemand.mProvideData = VolumeCtrl.static.SupplyDemandProvideData
    self.supplyDemand.mClearData = VolumeCtrl.static.SupplyDemandClearData

    VolumePanel.scroll:ActiveLoopScroll(self.supplyDemand, #clothes)

    self.initData()
end

function VolumeCtrl:Active()
    UIPanel.Active(self)
    Event.AddListener("c_NpcNum",self.c_NpcNum,self)
end

function VolumeCtrl:Refresh()
    --打开Model
    self:initInsData()
end

function VolumeCtrl:Hide()
    UIPanel.Hide(self)
    Event.RemoveListener("c_NpcNum",self.c_NpcNum,self)
end

function VolumeCtrl:OnCreate(obj)
    UIPanel.OnCreate(self,obj)
end

function VolumeCtrl:initInsData()
    DataManager.OpenDetailModel(VolumeModel,self.insId )
    DataManager.DetailModelRpcNoRet(self.insId , 'm_GetNpcNum')
end

--NPC数量
function VolumeCtrl:c_NpcNum(countNpc)
   local adult = 0
   local old = 0
   local youth = 0
    for i, v in pairs(countNpc) do
        if v.key == 10 then
            old = old + v.value
        elseif v.key == 11 then
            youth = youth + v.value
        else
            adult = adult + v.value
        end
    end
    VolumePanel.adult.text = adult
    VolumePanel.old.text = old
    VolumePanel.youth.text = youth
end

--初始化
function VolumeCtrl:initData()

end

--返回
function VolumeCtrl:OnBack()
    UIPanel.ClosePage()
end

--ClotherBtn
function VolumeCtrl:OnClotherBtn(go)
    isClother = true
    --VolumePanel.clotherBtn.transform.localScale = Vector3.zero
    VolumePanel.clotherBtn:SetActive(false)
    VolumePanel.foodBtn:SetActive(true)

    VolumePanel.scroll:ActiveLoopScroll(go.supplyDemand, #clothes)

end

--FoodBtn
function VolumeCtrl:OnFoodBtn(go)
    isClother = false
    VolumePanel.foodBtn:SetActive(false)
    VolumePanel.clotherBtn:SetActive(true)
    VolumePanel.scroll:ActiveLoopScroll(go.supplyDemand, #food)
end

--滑动互用
VolumeCtrl.static.SupplyDemandProvideData = function(transform, idx)

    idx = idx + 1
    local item
    if isClother then
        item = SupplyDemandItem:new(clothes[idx],transform)
    else
        item = SupplyDemandItem:new(food[idx],transform)
    end

    local supplyDemand = {}
    supplyDemand[idx] = item
end

VolumeCtrl.static.SupplyDemandClearData = function(transform)

end

