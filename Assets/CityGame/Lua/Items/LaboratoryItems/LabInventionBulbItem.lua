---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/11/29 18:42
---
LabInventionBulbItemState =
{
    Empty = 0,
    Locked = 1,
    Working = 2,
    Finish = 3,
}
LabInventionBulbItem = class('LabInventionBulbItem')

function LabInventionBulbItem:initialize(viewRect, data)
    self.viewRect = viewRect
    self.data = data

    self.finishBtn = viewRect:Find("finishBtn"):GetComponent("Button")
    self.lockIconImgTran = viewRect:Find("lockIconImg")
    self.ingImg = viewRect:Find("ingImg"):GetComponent("Image")
    self.timeDownText = viewRect:Find("ingImg/timeDownText"):GetComponent("Text")

    self.finishBtn.onClick:RemoveAllListeners()
    self.finishBtn.onClick:AddListener(function ()
        data.func()
    end)

    if not self.bulbState then
        self.bulbState = LabInventionBulbItemState.Locked
    end
    self:updateData()
    UpdateBeat:Add(self._update, self)
end
--更新显示数据
function LabInventionBulbItem:updateData(data)
    self.bulbState = data.bulbState
    self.leftSec = data.leftSec
    self.phaseSec = data.phaseSec
    self.remainTime = nil

    self:_setBulbState(self.bulbState)
end
--清除数据
function LabInventionBulbItem:cleanData()
    self.bubleObj = nil
    self.bulbState = LabInventionBulbItemState.Empty
end
--设置
function LabInventionBulbItem:_setBulbState(state)
    if state == LabInventionBulbItemState.Locked then
        self.lockIconImgTran.localScale = Vector3.one
        self.finishBtn.localScale = Vector3.zero
        self.ingImg.localScale = Vector3.zero
    elseif state == LabInventionBulbItemState.Working then
        self.lockIconImgTran.localScale = Vector3.zero
        self.finishBtn.localScale = Vector3.zero
        self.ingImg.localScale = Vector3.one
    elseif state == LabInventionBulbItemState.Finish then
        self.lockIconImgTran.localScale = Vector3.zero
        self.finishBtn.localScale = Vector3.one
        self.ingImg.localScale = Vector3.zero
    end
end

function LabInventionBulbItem:_update()
    if self.bulbState == LabInventionBulbItemState.Working then
        if self.remainTime then
            self.remainTime = self.leftSec
        else
            self.remainTime = self.remainTime - UnityEngine.Time.unscaledDeltaTime
        end
        self.ingImg.fillAmount = self.remainTime / self.phaseSec  --设置图片进度

        if self.remainTime < 0 then
            self.startTimeDown = false
            self.bulbState = LabInventionBulbItemState.Finish
            self:_setBulbState(self.bulbState)
            return
        end

        local timeTable = getTimeBySec(self.remainTime)
        local timeStr = timeTable.hour..":"..timeTable.minute..":"..timeTable.second
        self.timeDownText.text = timeStr
    end
end

