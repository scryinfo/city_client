---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/11/21 15:47
---土地拍卖即将开始气泡
UIBubbleGroundAucSoonItem = class('UIBubbleGroundAucSoonItem')
function UIBubbleGroundAucSoonItem:initialize(data)
    self.data = data
    self.bubbleRect = data.bubbleRect

    local viewTrans = self.bubbleRect.transform
    self.soonTimeText = viewTrans:Find("bgBtn/timeDownRoot/soonTimeText"):GetComponent("Text")
    self.bgBtn = viewTrans:Find("bgBtn"):GetComponent("Button")

    self.bgBtn.onClick:RemoveAllListeners()
    self.bgBtn.onClick:AddListener(function ()
        self:_clickBtn()
    end)

    self.startTimeDown = true
    Event.AddListener("c_RefreshLateUpdate", self.LateUpdate, self)
    --UpdateBeat:Add(self.Update, self)
    --LateUpdateBeat:Add(self.LateUpdate, self)
end

--打开拍卖界面，即将拍卖
function UIBubbleGroundAucSoonItem:_clickBtn()
    ct.OpenCtrl("GroundAuctionCtrl", self.data)
end

function UIBubbleGroundAucSoonItem:Update()

end

function UIBubbleGroundAucSoonItem:LateUpdate()
    self.bubbleRect.anchoredPosition = UnityEngine.Camera.main:WorldToScreenPoint(self.data.groundObj.transform.position)

    if self.startTimeDown then
        --即将拍卖倒计时
        local finishTime = self.data.beginTime
        self.currentTime = self.currentTime or os.time()
        self.currentTime = self.currentTime + UnityEngine.Time.unscaledDeltaTime

        local remainTime = finishTime - self.currentTime
        if remainTime < 0 then
            self.startTimeDown = false
            --Event.Brocast("m_GroundAucStateChange", self.data.id)
            return
        end

        local timeTable = getFormatUnixTime(remainTime)
        local timeStr = timeTable.minute..":"..timeTable.second
        self.soonTimeText.text = timeStr

        if self.currentTime >= finishTime then
            self.startTimeDown = false
            --Event.Brocast("m_GroundAucStateChange", self.data.id)
            return
        end
    end

end