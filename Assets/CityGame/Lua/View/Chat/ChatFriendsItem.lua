---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2018/12/14 20:44
---

ChatFriendsItem = class('ChatFriendsItem')

-- 初始化
function ChatFriendsItem:initialize(itemId, index, prefab, isFrist, data)
    --prefab:GetComponent("Image").sprite = UnityEngine.Resources.Load("1")
    --ChatCtrl.static.luaBehaviour:AddClick(prefab, self.OnExpressionBtn, self)
    self.prefab = prefab
    self.data = data
    self.data.itemId = itemId
    self.data.index = index
    --self.data.company = "Scry"

    local transform = prefab.transform
    -- 复选框提示
    self.toggle = transform:Find("Toggle"):GetComponent("Toggle")
    -- 好友名
    self.nameText = transform:Find("NameText"):GetComponent("Text")
    -- 好友所在公司名字
    self.companyText = transform:Find("CompanyText"):GetComponent("Text")
    -- 好友消息红点提示
    self.noticeImage = transform:Find("NoticeImage").gameObject
    self.noticeText = transform:Find("NoticeImage/NoticeText"):GetComponent("Text")
    -- 头像
    --self.friendsImage = transform:Find("HeadBg/FriendsImage"):GetComponent("Image")
    self.friendsImage = transform:Find("HeadBg/FriendsImage")

    self.toggle.isOn = false
    self.nameText.text = self.data.name
    self.companyText.text = self.data.companyName
    self.noticeImage:SetActive(false)
    --LoadSprite(PlayerHead[self.data.faceId].FriendsPath, self.friendsImage, true)
    self.headPrefab = AvatarManger.GetSmallAvatar(self.data.faceId, self.friendsImage,0.2)
    self.headPrefabTrans = self.headPrefab.transform

    self.toggle.onValueChanged:AddListener(function (isOn)
        self:_toggleValueChange(isOn)
    end)

    if isFrist then
        transform:SetSiblingIndex(0)
    end

    if index == 1 and not data.b then
        self:SetHeadColor(false)
    end

    if index == 3 and not data.b then
        self:SetHeadColor(false)
    end
end

function ChatFriendsItem:SetNoticeText(text)
    if text and text > 0 then
        self.noticeImage:SetActive(true)
        self.noticeText.text = text
    else
        self.noticeImage:SetActive(false)
    end
end

function ChatFriendsItem:SetHeadColor(isOnline)
    if isOnline then
        --self.friendsImage.color = Color.New(1, 1, 1, 1)
        for i = 1, self.headPrefabTrans.childCount do
            --UnityEngine.GameObject.Destroy(self.headImage:GetChild(i-1).gameObject)
            self.headPrefabTrans:GetChild(i-1):GetChild(0):GetComponent("Image").color = Color.New(1, 1, 1, 1)
        end
    else
        --self.friendsImage.color = Color.New(83/255, 83/255, 83/255, 110/255)
        for i = 1, self.headPrefabTrans.childCount do
            --UnityEngine.GameObject.Destroy(self.headImage:GetChild(i-1).gameObject)
            self.headPrefabTrans:GetChild(i-1):GetChild(0):GetComponent("Image").color = Color.New(1, 1, 1, 110/255)
        end
    end
end

function ChatFriendsItem:_toggleValueChange(isOn)
    if isOn then
        PlayMusEff(1002)
        self.toggle.interactable = false
        self.noticeImage:SetActive(false)
        ChatCtrl.static.chatMgr:SetToggle(self.toggle)
        if self.data.index == 1 then
            if ChatPanel.friendsChatNoContentRoot.activeSelf then
                ChatPanel.friendsChatNoContentRoot:SetActive(false)
            end
            ChatCtrl.static.chatMgr:DestroyContentChildren(2)
            ChatPanel.chatRecordsBtn:SetActive(true)
            ChatPanel.chatRecordsRoot:SetActive(false)
            ChatCtrl.static.chatMgr:ShowPlayerInfo(2, self.data)
            --DataManager.SetMyReadChatInfo(2, self.data.id)
            ChatCtrl.static.chatMgr:ShowAllChatInfo(2, self.data.id)
            ChatCtrl.static.chatMgr:StartScrollBottom()
        elseif self.data.index == 2 then
            if ChatPanel.strangersChatNoContentRoot.activeSelf then
                ChatPanel.strangersChatNoContentRoot:SetActive(false)
            end
            ChatCtrl.static.chatMgr:DestroyContentChildren(4)
            ChatCtrl.static.chatMgr:ShowPlayerInfo(3, self.data)
            --DataManager.SetMyReadChatInfo(3, self.data.id)
            ChatCtrl.static.chatMgr:ShowAllChatInfo(3, self.data.id)
            ChatCtrl.static.chatMgr:StartScrollBottom()
        elseif self.data.index == 3 then
            ChatCtrl.static.chatMgr:ShowPlayerInfo(3, self.data)
        end
    end
end