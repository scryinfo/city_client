---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/9/21 10:35
---
-----

FlightMainCtrl = class('FlightMainCtrl',UIPanel)
UIPanel:ResgisterOpen(FlightMainCtrl)

function FlightMainCtrl:initialize()
    UIPanel.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function FlightMainCtrl:bundleName()
    return "Assets/CityGame/Resources/View/FlightMainPanel.prefab"
end

function FlightMainCtrl:OnCreate(obj)
    UIPanel.OnCreate(self, obj)
end

function FlightMainCtrl:Awake(go)
    self.gameObject = go
    local behaviour = self.gameObject:GetComponent('LuaBehaviour')
    behaviour:AddClick(FlightMainPanel.backBtn.gameObject, function ()
        self:backFunc()
    end , self)
    behaviour:AddClick(FlightMainPanel.searchBtn.gameObject, function ()
        self:searchFunc()
    end , self)
    behaviour:AddClick(FlightMainPanel.moneyBtn.gameObject, function ()
        self:clickMoneyFunc()
    end , self)
    behaviour:AddClick(FlightMainPanel.leftBtn.gameObject, function ()
        self:leftPageFunc()
    end , self)
    behaviour:AddClick(FlightMainPanel.rightBtn.gameObject, function ()
        self:rightPageFunc()
    end , self)
    behaviour:AddClick(FlightMainPanel.recordBtn.gameObject, function ()
        self:recordFunc()
    end , self)

    self.pageEvent = ScrollPageEventData.New()  --Sliding page turning event
    self.pageEvent.mProvideData = FlightMainCtrl.static.ProvideFunc
    self.pageEvent.mClearData = FlightMainCtrl.static.ClearFunc
    self.pageEvent.mLeftEndFunc = FlightMainCtrl.static.LeftEndFunc
    self.pageEvent.mRightEndFunc = FlightMainCtrl.static.RightEndFunc
    self.pageEvent.mBtnNomalFunc = FlightMainCtrl.static.BtnNormalFunc
end
--
function FlightMainCtrl:Refresh()
    Event.AddListener("c_getAllFlight", self._getAllFlight, self)
    Event.AddListener("c_flightScoreChange", self._flightScoreChange, self)

    self:_initData()
end
--
function FlightMainCtrl:Active()
    UIPanel.Active(self)
    self:_language()
end
--
function FlightMainCtrl:Hide()
    Event.RemoveListener("c_getAllFlight", self._getAllFlight, self)
    Event.RemoveListener("c_flightScoreChange", self._flightScoreChange, self)
    FlightMainPanel.scrollPage:CleanAll()

    UIPanel.Hide(self)
end
--
function FlightMainCtrl:_getAllFlight(value)
    if value ~= nil then
        FlightMainCtrl.static.itemsList = {}
        local sortList = table.sort(value, function (m, n)
            return m.sumBetAmount > n.sumBetAmount
        end)
        self.m_data.valueList = value
        if #self.m_data.valueList > 0 then
            FlightMainPanel.noneTip.localScale = Vector3.zero
            FlightMainCtrl.listValue = self.m_data.valueList
            if #self.m_data.valueList > 4 then
                FlightMainPanel.rightBtn.localScale = Vector3.one
            end
            --FlightMainPanel.scrollPage:InitData(self.pageEvent, #self.m_data.valueList)
            local count = #self.m_data.valueList
            if count > 12 then
                count = 12
            end
            FlightMainPanel.scrollPage:InitData(self.pageEvent, count)  --Changed the plan to display up to 12
        else
            FlightMainPanel.noneTip.localScale = Vector3.one
        end
    end
end
--
function FlightMainCtrl:_flightScoreChange(data)
    FlightMainPanel.moneyText.text = DataManager.GetMyFlightScore()
end
--
FlightMainCtrl.static.ProvideFunc = function(transform, idx)
    idx = idx + 1
    local item = FlightMainPageItem:new(transform, FlightMainCtrl.listValue[idx])
    FlightMainCtrl.static.itemsList[idx] = item
end
--
FlightMainCtrl.static.ClearFunc = function(transform) end

--normal status
FlightMainCtrl.static.BtnNormalFunc = function()
    FlightMainPanel.rightBtn.localScale = Vector3.one
    FlightMainPanel.leftBtn.localScale = Vector3.one
end
--Reach the far left
FlightMainCtrl.static.LeftEndFunc = function()
    FlightMainPanel.leftBtn.localScale = Vector3.zero
end
--Reach the far right
FlightMainCtrl.static.RightEndFunc = function()
    FlightMainPanel.rightBtn.localScale = Vector3.zero
end
--
function FlightMainCtrl:_initData()
    FlightMainPanel.rightBtn.localScale = Vector3.zero
    FlightMainPanel.leftBtn.localScale = Vector3.zero
    if self.m_data == nil then
        self.m_data = {}
    end
    FlightMainPanel.moneyText.text = DataManager.GetMyFlightScore()
    FlightMainModel.m_ReqAllFlight()
end
--
function FlightMainCtrl:cleanItemList()
    if FlightMainCtrl.static.itemsList == nil then
        return
    end
    for i, value in pairs(FlightMainCtrl.static.itemsList) do
        value:Close()
    end
end
--
function FlightMainCtrl:_language()
    FlightMainPanel.titleText01.text = GetLanguage(32010001)
    FlightMainPanel.recordText02.text = GetLanguage(32010002)
    FlightMainPanel.noneTipText03.text = GetLanguage(32030033)
    FlightMainPanel.moneyText04.text = GetLanguage(32020036)
    FlightMainPanel.searchBtnText05.text = GetLanguage(32010003)
end
--
function FlightMainCtrl:backFunc()
    self:cleanItemList()
    PlayMusEff(1002)
    UIPanel.ClosePage()
end
--Click to search
function FlightMainCtrl:searchFunc()
    PlayMusEff(1002)
    ct.OpenCtrl("FlightSearchCtrl")
end
--Click recharge
function FlightMainCtrl:clickMoneyFunc()
    PlayMusEff(1002)
    --ct.OpenCtrl()
end
--Turn left button
function FlightMainCtrl:leftPageFunc()
    PlayMusEff(1002)
    FlightMainPanel.scrollPage:PrevPage()
end
--Page right
function FlightMainCtrl:rightPageFunc()
    PlayMusEff(1002)
    FlightMainPanel.scrollPage:NextPage()
end
--Forecast record interface
function FlightMainCtrl:recordFunc()
    PlayMusEff(1002)
    ct.OpenCtrl("FlightRecordCtrl")
end