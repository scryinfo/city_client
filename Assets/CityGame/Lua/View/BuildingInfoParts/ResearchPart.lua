---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2019/4/10/010 15:32
---研究所基础信息（工资 收益 研究）

ResearchPart = class('ResearchPart', BasePart)
--
function ResearchPart:PrefabName()
    return "ResearchPart"
end
--
function ResearchPart:GetDetailClass()
    return ResearchDetailPart
end
--
function ResearchPart:_InitTransform()
    local transform = self.transform
    --self.turnover = transform:Find("Top/turnover"):GetComponent("Text")

    self.queneBtn = transform:Find("Top/Button")
    self.UnselectBtntext = transform:Find("UnselectBtn/icon/Text"):GetComponent("Text")
    self.UnselectBtntext = transform:Find("UnselectBtn/icon/Text"):GetComponent("Text")
    self.hasImage = findByName(transform,"hasImage")
    self.queneCount = findByName(transform,"countText"):GetComponent("Text")
    self.queneText = findByName(transform,"queneText (1)"):GetComponent("Text")
    self.priceText = findByName(transform,"priceText"):GetComponent("Text")
    self.priceCount = findByName(transform,"turnover"):GetComponent("Text")
    self.notOpen = findByName(transform,"notOpen")
    self.TimeText = findByName(transform,"TimeText"):GetComponent("Text")
    self.TimeTextCount = findByName(transform,"TimeTextCount"):GetComponent("Text")
    self.title = findByName(transform,"Text"):GetComponent("Text")
    self.title1 = findByName(transform,"Text1"):GetComponent("Text")

end

--特殊按钮
function  ResearchPart:_InitChildClick(mainPanelLuaBehaviour)
    mainPanelLuaBehaviour:AddClick(self.queneBtn.gameObject,self.onClick_set, self)
end

--
function  ResearchPart:_ResetTransform()
    -- self.turnover.text = "0.0000"
end
--
function ResearchPart:RefreshData(data)
    if data == nil then
        return
    end
    self.m_data = data
    self:updateUI(data)
    self:updateLanguage()

end

---===================================================================================点击函数==============================================================================================

--初始化独特点击事件
--mainPanelLuaBehaviour:LuaBehaviour的引用
function ResearchPart:_InitClick(mainPanelLuaBehaviour)
    --点击打开界面
    mainPanelLuaBehaviour:AddClick(self.go, function()
        if self.m_data.info.ownerId == DataManager.GetMyOwnerID() then
            self.groupClass.SwitchingOptions(self.groupClass,self.partIndex)
        else
            if self.m_data.exclusive then
                Event.Brocast("SmallPop",GetLanguage(28050001),300)
                return
            end
            self.groupClass.SwitchingOptions(self.groupClass,self.partIndex)
        end
    end)
    --点击关闭界面
    mainPanelLuaBehaviour:AddClick(self.selectTransform.gameObject, function()
        --注：暂定方案为不做处理
        --关闭所有界面
        self.groupClass.TurnOffAllOptions(self.groupClass)
    end)
    self:_InitChildClick(mainPanelLuaBehaviour)
end

function ResearchPart:onClick_set(ins)
    ct.OpenCtrl("QueneCtrl",{name="View/Laboratory/InventGoodQueneItem",data = ins.m_data.totalLine ,insClass=InventGoodQueneItem})
end

--
function ResearchPart:updateUI(data)
    --进行中
    if data.inProcess ~= nil then
        self.queneCount.text = #(data.inProcess)
    else
        self.queneCount.text = 0
    end
    local ownerId = DataManager.GetMyOwnerID()
    --判断line里有没有自己的成果
    self.hasImage.localScale = Vector3.zero
    for i, lineInfo in ipairs(data.totalLine) do
        if lineInfo.proposerId == ownerId and lineInfo.availableRoll > 0 then
            self.hasImage.localScale = Vector3.one
            break
        end
    end
    --if data.info.ownerId == ownerId  then
    --    if data.completed then
    --        for i, v in ipairs(data.completed) do
    --            if v.proposerId == ownerId then
    --                self.hasImage.localScale = Vector3.one
    --                isShow = false
    --                break
    --            else
    --                self.hasImage.localScale = Vector3.zero
    --            end
    --        end
    --    else
    --            self.hasImage.localScale = Vector3.zero
    --    end
    --else
    --    self.hasImage.localScale = Vector3.zero
    --end

    if data.exclusive == false then
        self.priceText.transform.localScale = Vector3.one
        self.TimeText.transform.localScale = Vector3.one
        self.notOpen.localScale = Vector3.zero
        self.priceCount.text = GetClientPriceString(data.pricePreTime)
        self.TimeTextCount.text = string.format("%sh", data.sellTimes)
    elseif data.exclusive == true then
        self.priceText.transform.localScale = Vector3.zero
        self.TimeText.transform.localScale = Vector3.zero
        self.notOpen.localScale = Vector3.one
    end
end

--多语言
function ResearchPart:updateLanguage()
    self.queneText.text = GetLanguage(28040044)
    self.priceText.text = GetLanguage(28010006)
    self.TimeText.text = GetLanguage(28010007)
    self.title.text = GetLanguage(28050002)
    self.title1.text = GetLanguage(28040036)
    self.UnselectBtntext.text = GetLanguage(28040036)
end