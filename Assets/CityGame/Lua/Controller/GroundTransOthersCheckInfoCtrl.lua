---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/12/26 17:29
---GroundTransOthersCheckInfoCtrl
GroundTransOthersCheckInfoCtrl = class('GroundTransOthersCheckInfoCtrl',UIPanel)
UIPanel:ResgisterOpen(GroundTransOthersCheckInfoCtrl)

function GroundTransOthersCheckInfoCtrl:initialize()
    UIPanel.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function GroundTransOthersCheckInfoCtrl:bundleName()
    return "Assets/CityGame/Resources/View/GroundTransOthersCheckInfoPanel.prefab"
end

function GroundTransOthersCheckInfoCtrl:OnCreate(obj)
    UIPanel.OnCreate(self, obj)
end

function GroundTransOthersCheckInfoCtrl:Awake(go)
    local groundAuctionBehaviour = self.gameObject:GetComponent('LuaBehaviour')
    groundAuctionBehaviour:AddClick(GroundTransOthersCheckInfoPanel.bgBtn.gameObject, self._closeBtnFunc, self)
    groundAuctionBehaviour:AddClick(GroundTransOthersCheckInfoPanel.backBtn.gameObject, self._backBtnFunc, self)
    groundAuctionBehaviour:AddClick(GroundTransOthersCheckInfoPanel.AOwnerBtn.gameObject, self._ownerBtnFunc, self)
    groundAuctionBehaviour:AddClick(GroundTransOthersCheckInfoPanel.BRenterBtn.gameObject, self._renterBtnFunc, self)
end

function GroundTransOthersCheckInfoCtrl:Refresh()
    self:_initPanelData()
end

function GroundTransOthersCheckInfoCtrl:Active()
    UIPanel.Active(self)
    GroundTransOthersCheckInfoPanel.titleText01.text = GetLanguage(22060002)
    GroundTransOthersCheckInfoPanel.noneText02.text = GetLanguage(22060003)
    GroundTransOthersCheckInfoPanel.partAText03.text = GetLanguage(22060007)
    GroundTransOthersCheckInfoPanel.partBText04.text = GetLanguage(22060009)
end

function GroundTransOthersCheckInfoCtrl:Hide()
    UIPanel.Hide(self)
    if self.ownerAvatar ~= nil then
        AvatarManger.CollectAvatar(self.ownerAvatar)
    end
    if self.renterAvatar ~= nil then
        AvatarManger.CollectAvatar(self.renterAvatar)
    end
end

function GroundTransOthersCheckInfoCtrl:Close()
    UIPanel.Close(self)
end

---初始化
function GroundTransOthersCheckInfoCtrl:_initPanelData()
    if self.m_data and self.m_data.groundInfo then
        local ids = {[1] = self.m_data.groundInfo.ownerId}
        if self.m_data.groundInfo.rent and self.m_data.groundInfo.rent.renterId then
            ids[2] = self.m_data.groundInfo.rent.renterId
        end
        PlayerInfoManger.GetInfos(ids, self._showPersonalInfo, self)

        self:_setShowState(self.m_data.groundInfo)
    end
end
--Display interface according to status
function GroundTransOthersCheckInfoCtrl:_setShowState(groundInfo)
    GroundTransOthersCheckInfoPanel.closeAllState()
    if groundInfo.ownerId == nil then
        GroundTransOthersCheckInfoPanel.noneOwnerTran.localScale = Vector3.one
        return
    end
    GroundTransOthersCheckInfoPanel.partATran.localScale = Vector3.one
    if groundInfo.rent ~= nil and groundInfo.rent.renterId ~= nil then
        GroundTransOthersCheckInfoPanel.partBTran.localScale = Vector3.one
    end
end

--Show avatar + name information
function GroundTransOthersCheckInfoCtrl:_showPersonalInfo(tempInfo)
    local roleInfo = tempInfo
    if roleInfo ~= nil then
        for i, info in pairs(roleInfo) do
            if info.id == self.m_data.groundInfo.ownerId then
                self.ownerInfo = info
            end
            if self.m_data.groundInfo.rent and self.m_data.groundInfo.rent.renterId then
                if info.id == self.m_data.groundInfo.rent.renterId then
                    self.renterInfo = info
                end
            end
        end

        if self.ownerInfo ~= nil then
            GroundTransOthersCheckInfoPanel.ANameText.text = self.ownerInfo.name
            GroundTransOthersCheckInfoPanel.ACompanyText.text = self.ownerInfo.companyName
            self.ownerAvatar = AvatarManger.GetSmallAvatar(self.ownerInfo.faceId, GroundTransOthersCheckInfoPanel.APortraitImg.transform,0.2)
        end
        --
        if self.renterInfo ~= nil then
            GroundTransOthersCheckInfoPanel.BNameText.text = self.renterInfo.name
            GroundTransOthersCheckInfoPanel.BCompanyText.text = self.renterInfo.companyName
            self.renterAvatar = AvatarManger.GetSmallAvatar(self.renterInfo.faceId, GroundTransOthersCheckInfoPanel.BPortraitImg.transform,0.2)
        end
    end
end

---Button method
-- Click elsewhere to close the entire stack and open the main interface
function GroundTransOthersCheckInfoCtrl:_closeBtnFunc()
    PlayMusEff(1002)
    --Close all interfaces
    GroundTransSetPriceCtrl._closeBackToMain()
end
--Back button
function GroundTransOthersCheckInfoCtrl:_backBtnFunc()
    PlayMusEff(1002)
    UIPanel:ClosePage()
end

--Click on the landowner avatar
function GroundTransOthersCheckInfoCtrl:_ownerBtnFunc(ins)
    PlayMusEff(1002)
    if ins.ownerInfo then
        ct.OpenCtrl("PersonalHomeDialogPageCtrl", ins.ownerInfo)
    end
end
--Click on the land leaser avatar
function GroundTransOthersCheckInfoCtrl:_renterBtnFunc(ins)
    PlayMusEff(1002)
    if ins.renterInfo then
        ct.OpenCtrl("PersonalHomeDialogPageCtrl", ins.renterInfo)
    end
end