---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2019/7/24 15:11
---

ResearchChoiceCtrl = class("ResearchChoiceCtrl", UIPanel)
ResearchChoiceCtrl:ResgisterOpen(ResearchChoiceCtrl)

function ResearchChoiceCtrl:initialize()
    UIPanel.initialize(self, UIType.PopUp, UIMode.DoNothing, UICollider.None)
end

function ResearchChoiceCtrl:bundleName()
    return "Assets/CityGame/Resources/View/ResearchChoicePanel.prefab"
end

function ResearchChoiceCtrl:OnCreate(obj)
    UIPanel.OnCreate(self, obj)
end

function ResearchChoiceCtrl:Awake(go)
    local luaBehaviour = self.gameObject:GetComponent("LuaBehaviour")

    luaBehaviour:AddClick(ResearchChoicePanel.backBtn, self.OnBack, self)
end

function ResearchChoiceCtrl:Active()
    UIPanel.Active(self)
    ResearchChoicePanel.titleText.text = GetLanguage(28050002)
end

function ResearchChoiceCtrl:Refresh()
    -- Send a message to the server to query and obtain information on the production line (Institute (including treasure chest information), promotion company)
    --DataManager.ModelSendNetMes("gscode.OpCode", "getScienceItemSpeed","gs.Id",{ id = self.m_data.info.id})
    --DataManager.DetailModelRpcNoRet(self.m_data.insId, 'm_ReqGetScienceItemSpeed', self.m_data.insId)
    self:_showScienceItemSpeed(self.m_data)
end

function ResearchChoiceCtrl:Hide()
    UIPanel.Hide(self)
    --Event.RemoveListener("c_OnReceiveResearchGetScienceItemSpeed",self.c_OnReceiveResearchGetScienceItemSpeed,self)
    if self.researchTypeItems then
        for _, v in ipairs(self.researchTypeItems) do
            UnityEngine.GameObject.Destroy(v.prefab)
        end
        self.researchTypeItems = nil
    end
end

-------------------------------------Button click -----------------------------------------
function ResearchChoiceCtrl:OnBack(go)
    PlayMusEff(1002)
    UIPanel.ClosePage()
end

-------------------------------------Event callback----------- --------------------------
-- Generate selectable research items based on the server's return ResearchTypeItem

function ResearchChoiceCtrl:_showScienceItemSpeed(scienceItemSpeed)
    if not self.researchTypeItems then
        self.researchTypeItems = {}
        for i, v in ipairs(scienceItemSpeed.itemSpeed) do
            local go = ct.InstantiatePrefab(ResearchChoicePanel.researchTypeItem)
            local rect = go.transform:GetComponent("RectTransform")
            go.transform:SetParent(ResearchChoicePanel.typeScrollContent)
            rect.transform.localScale = Vector3.one
            rect.transform.localPosition = Vector3.zero
            go:SetActive(true)

            v.config = ResearchConfig[v.type]
            v.buildingId = scienceItemSpeed.buildingId
            self.researchTypeItems[i] = ResearchTypeItem:new(go, v)
        end
    end
end