---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2018/10/23/023 11:29
---

require "Common/define"
require "View/BuildingInfo/BuildingInfoToggleGroupMgr";
require('Framework/UI/UIPage')
require'View/BuildingInfo/SmallPopItem'--小弹窗脚本

local class = require 'Framework/class'
MunicipalCtrl = class('MunicipalCtrl',UIPage)
UIPage:ResgisterOpen(MunicipalCtrl) --注册打开的方法


MunicipalCtrl.SmallPop_Path="View/GoodsItem/TipsParticle"--小弹窗路径

--构建函数
function MunicipalCtrl:initialize()
    UIPage.initialize(self,UIType.Normal,UIMode.HideOther,UICollider.None);
end

function MunicipalCtrl:bundleName()
    return "Municipal";
end

function MunicipalCtrl:OnCreate(obj)
    UIPage.OnCreate(self,obj);
end

function MunicipalCtrl:Awake(go)
    self.gameObject = go;
    local materialBehaviour = self.gameObject:GetComponent('LuaBehaviour');
    materialBehaviour:AddClick(MunicipalPanel.backBtn.gameObject,self.OnClick_backBtn,self);
    materialBehaviour:AddClick(MunicipalPanel.infoBtn.gameObject,self.OnClick_infoBtn,self);
    materialBehaviour:AddClick(MunicipalPanel.changeNameBtn.gameObject,self.OnClick_changeName,self);

    self.data = {}
    self.data.middleRootTran=MunicipalPanel.middleRootTran
    self.data.buildingType = BuildingType.Municipal
  BuildingInfoToggleGroupMgr:new(MunicipalPanel.leftRootTran, MunicipalPanel.rightRootTran, materialBehaviour, self.data)
---小弹窗
    self.root=MunicipalPanel.changeNameBtn.root;

    Event.AddListener("SmallPop",self.c_SmallPop,self)
end

--更改名字
function MunicipalCtrl:OnClick_changeName()
    local data = {}
    data.titleInfo = "RENAME";
    data.tipInfo = "Modified every seven days";
    data.inputDialogPageServerType = InputDialogPageServerType.UpdateBuildingName
    UIPage:ShowPage(InputDialogPageCtrl, data)
end

--返回
function MunicipalCtrl:OnClick_backBtn()
    UIPage.ClosePage();
end

--打开信息界面
function MunicipalCtrl:OnClick_infoBtn()

end

function MunicipalCtrl:Refresh()

end

---生成预制
function MunicipalCtrl:c_creatGoods(path,parent)
    local prefab = UnityEngine.Resources.Load(path);
    local go = UnityEngine.GameObject.Instantiate(prefab);
    local rect = go.transform:GetComponent("RectTransform");
    go.transform:SetParent(parent);--.transform
    rect.transform.localScale = Vector3.one;
    rect.transform.localPosition=Vector3.zero
    return go
end

function MunicipalCtrl:c_SmallPop(string)
    local prefab=UnityEngine.GameObject.FindGameObjectWithTag("Finish")

    if not prefab then
        prefab =self:c_creatGoods(self.SmallPop_Path,self.root)
    end

    SmallPopItem:new(string,prefab,self);
end

UnitTest.TestBlockStart()---------------------------------------------------------

UnitTest.Exec("fisher_w11_MunicipalCtrl", "test_MunicipalCtrl_ShowPage",  function ()
    ct.log("fisher_w11_MunicipalCtrl","[test_MunicipalCtrl_ShowPage]  测试开始")
    ct.OpenCtrl('MunicipalCtrl') --注意传入的是类名
end)

UnitTest.TestBlockEnd()-----------------------------------------------------------

