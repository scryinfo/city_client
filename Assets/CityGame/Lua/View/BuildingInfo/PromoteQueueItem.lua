---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/4/22 15:57
---推广队列item
PromoteQueueItem = class('PromoteQueueItem')
function PromoteQueueItem:initialize(prefab,dataInfo)
    self.prefab = prefab;
    self.dataInfo = dataInfo;
    self.bg = self.prefab.transform:Find("bg")
    self.myBg = self.prefab.transform:Find("myBg")
    self.head = self.prefab.transform:Find("player/head")
    self.goodsImage = self.prefab.transform:Find("goods/goodsImage"):GetComponent("Image")
    self.goodsText = self.prefab.transform:Find("goods/goodsImage/goodsText"):GetComponent("Text")
    self.slider = self.prefab.transform:Find("details/Slider"):GetComponent("Slider")
    self.nowTime = self.prefab.transform:Find("details/Slider/time"):GetComponent("Text")
    self.timePrice = self.prefab.transform:Find("details/timePrice")
    self.time = self.prefab.transform:Find("details/timePrice/time"):GetComponent("Text")
    self.price = self.prefab.transform:Find("details/timePrice/price"):GetComponent("Text")
    self.startTime = self.prefab.transform:Find("startTime/time"):GetComponent("Text")
    self.delete = self.prefab.transform:Find("startTime/time/delete"):GetComponent("Button")

    self.delete.transform.localScale = Vector3.zero
    local ts = getFormatUnixTime(dataInfo.promStartTs/1000)
    self.startTime.text = ts.year .. "/" .. ts.month .. "/" .. ts.day .. " " .. ts.hour .. ts.minute

    local currentTime = TimeSynchronized.GetTheCurrentServerTime()    --服务器当前时间(毫秒)
    if currentTime >= dataInfo.promStartTs and currentTime <= dataInfo.promStartTs + dataInfo.promDuration then
        self.timePrice.localScale = Vector3.zero
        self.slider.transform.localScale = Vector3.one
        self.slider.maxValue = dataInfo.promDuration/3600000
        self.slider.value = dataInfo.promProgress/3600000
        self.nowTime.text = dataInfo.promProgress/3600000 .. "/" .. dataInfo.promDuration/3600000 .. "h"
    else
        self.timePrice.localScale = Vector3.one
        self.slider.transform.localScale = Vector3.zero
        self.time.text = ts.hour
        --self.price.text =
    end
    if dataInfo.buildingType == 1300 then
        self.goodsText.text = GetLanguage(18030001)
    elseif dataInfo.buildingType == 1400 then
        self.goodsText.text = GetLanguage(18030007)
    else
        self.goodsText.text = GetLanguage(dataInfo.productionType)
    end

    PlayerInfoManger.GetInfos({dataInfo.buyerId}, self.c_OnHead, self)
    local playerId = DataManager.GetMyOwnerID()      --自己的唯一id
    if playerId == dataInfo.sellerId then
        if playerId == dataInfo.buyerId then
           self.delete.transform.localScale = Vector3.one
        end
    end

    self.delete.onClick:AddListener(function()
        self:OnDelete(self);
    end)
end

function PromoteQueueItem:OnDelete()
    ct.OpenCtrl("PromoteGoodsExtensionCtrl",self.m_data)
end

function PromoteQueueItem:c_OnHead(info)
    AvatarManger.GetSmallAvatar(info[1].faceId,self.head.transform,0.15)
end
