---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/2/27 18:13
---建筑主界面调整工资
BuildingSalaryDetailPartNew = class('BuildingSalaryDetailPartNew', BasePartDetail)
--
function BuildingSalaryDetailPartNew:PrefabName()
    return "BuildingSalaryDetailPart"
end
--
function  BuildingSalaryDetailPartNew:_InitEvent()
    DataManager.ModelRegisterNetMsg(nil, "gscode.OpCode", "queryIndustryWages", "gs.QueryIndustryWages", self._getStandardWage, self)
end
--
function BuildingSalaryDetailPartNew:_ResetTransform()
    self.standardWageText.text = "E0.0000"
    self.staffNumText.text = "0"
    self.totalText.text = "E0.0000"
    self.timeText.text = "00:00"

    self:_language()
end
--
function BuildingSalaryDetailPartNew:_RemoveEvent()
    DataManager.ModelNoneInsIdRemoveNetMsg("gscode.OpCode", "queryIndustryWages", self)
end
--
function BuildingSalaryDetailPartNew:_ChildHide()

end
--
function BuildingSalaryDetailPartNew:RefreshData(data)
    self:_ResetTransform()
    if data == nil then
        return
    end
    self.m_data = data
    self:_initFunc()
end
--
function BuildingSalaryDetailPartNew:_InitTransform()
    self:_getComponent(self.transform)
end
--
function BuildingSalaryDetailPartNew:_getComponent(transform)
    if transform == nil then
        return
    end
    self.standardWageText = transform:Find("root/bg03/wage/standardWageText"):GetComponent("Text")
    self.standardWageText01 = transform:Find("root/bg03/wage/Text"):GetComponent("Text")
    self.staffNumText = transform:Find("root/bg03/staffNum/staffNumText"):GetComponent("Text")
    self.staffNumText02 = transform:Find("root/bg03/staffNum/Text"):GetComponent("Text")
    self.totalText = transform:Find("root/bg03/total/totalText"):GetComponent("Text")
    self.totalText03 = transform:Find("root/bg03/total/Text"):GetComponent("Text")
    self.timeText = transform:Find("root/bg03/time/timeText"):GetComponent("Text")
    self.timeText04 = transform:Find("root/bg03/time/Text"):GetComponent("Text")
end
--
function BuildingSalaryDetailPartNew:_language()
    self.standardWageText01.text = "Standard wages:"
    self.staffNumText02.text = "Number of staff:"
    self.totalText03.text = "Total:"
    self.timeText04.text = "Wage settlement time:"
end

--
function BuildingSalaryDetailPartNew:_initFunc()
    if self.m_data.info.state ~= "OPERATE" then
        return
    end

    local staffNum = PlayerBuildingBaseData[self.m_data.info.mId].maxWorkerNum
    self.staffNumText.text = staffNum
    local standardWage = DataManager.GetBuildingStandardWage(self.m_data.info.mId)
    if standardWage == nil then
        DataManager.m_ReqStandardWage(self.m_data.info.mId)
    else
        self.standardWageText.text = string.format("E%s/d", GetClientPriceString(standardWage))
        local value = self.m_data.info.salary * staffNum * standardWage / 100  --因为工资百分比是整数
        self.totalText.text = "E"..GetClientPriceString(value)
        self.standardWage = standardWage
    end

    self.effectTime = self.m_data.info.setSalaryTs
    if self.effectTime ~= nil then
        self.timeText.text = os.date("%H:%M", self.effectTime)
    end
end
--
function BuildingSalaryDetailPartNew:_getStandardWage(data)
    if data.industryWages ~= nil then
        DataManager.SetBuildingStandardWage(data.type, data.industryWages)
        self.standardWageText.text = string.format("E%s/d", GetClientPriceString(data.industryWages))
        self.standardWage = data.industryWages

        local staffNum = PlayerBuildingBaseData[self.m_data.info.mId].maxWorkerNum
        local value = self.m_data.info.salary * staffNum * self.standardWage / 100  --因为工资百分比是整数
        self.totalText.text = "E"..GetClientPriceString(value)
    end
end
--
function BuildingSalaryDetailPartNew:clickCloseBtn()
    self.groupClass.TurnOffAllOptions(self.groupClass)
end