---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/11/19 15:18
---
LabResearchLineItem = class('LabResearchLineItem')
LabResearchLineItem.static.CHANGE_GREEN = "#0B7B16"  --改变量的绿色数值
LabResearchLineItem.static.CHANGE_RED = "#E42E2E"

--初始化方法
function LabResearchLineItem:initialize(data, viewRect)
    self.viewRect = viewRect
    self.data = data

    local viewTrans = self.viewRect
    self.nameText = viewTrans:Find("topRoot/nameText"):GetComponent("Text")
    self.levelText = viewTrans:Find("topRoot/levelText"):GetComponent("Text")
    self.itemBtn = viewTrans:Find("itemBtn"):GetComponent("Button")
    self.closeBtn = viewTrans:Find("topRoot/itemBtn"):GetComponent("Button")
    self.iconImg = viewTrans:Find("mainRoot/iconImg"):GetComponent("Image")
    self.staffText = viewTrans:Find("mainRoot/staffRoot/staffText"):GetComponent("Text")
    self.staffScrollbar = viewTrans:Find("mainRoot/staffRoot/staffScrollbar"):GetComponent("Scrollbar")

    self.progressImg = viewTrans:Find("mainRoot/progressRoot/progressImg"):GetComponent("Image")
    self.iconImg = viewTrans:Find("mainRoot/progressRoot/iconImg"):GetComponent("Image")
    self.progressCountText = viewTrans:Find("mainRoot/progressRoot/iconImg/progressCountText"):GetComponent("Text")
    self.timeDownText = viewTrans:Find("mainRoot/progressRoot/timeDownText"):GetComponent("Text")



    self:_initData()

    self.itemBtn.onClick:RemoveAllListeners()
    self.itemBtn.onClick:AddListener(function ()
        self:_clickCollectBtn()
    end)
    self.staffScrollbar.onValueChanged:RemoveAllListeners()
    self.staffScrollbar.onValueChanged:AddListener(function()

    end)
end

--初始化界面
function LabResearchLineItem:_initData()
    ---配合pb数据
    local data = self.data
    self:_setCollectState(data.isCollected)
    self.nameText.text = data.name
    self.lastPriceText.text = "E"..getPriceString(data.nowPrice, 30, 24)
    if data.priceChange >= 0 then
        self.changeText.text = string.format("<color=%s>+%6.2f%%</color>", LabResearchLineItem.static.CHANGE_GREEN, data.priceChange)
        --设置箭头位置
        self.lastPriceGreenTran.localScale = Vector3.one
        self.lastPriceRedTran.localScale = Vector3.zero
        local greenPos = self.lastPriceGreenTran.localPosition
        self.lastPriceGreenTran.localPosition = Vector3.New(-63 + self.lastPriceText.preferredWidth, greenPos.y, greenPos.z)
    else
        self.changeText.text = string.format("<color=%s>%6.2f%%</color>", LabResearchLineItem.static.CHANGE_RED, data.priceChange)
        --设置箭头位置
        self.lastPriceGreenTran.localScale = Vector3.zero
        self.lastPriceRedTran.localScale = Vector3.one
        local redPos = self.lastPriceRedTran.localPosition
        self.lastPriceRedTran.localPosition = Vector3.New(-63 + self.lastPriceText.preferredWidth, redPos.y, redPos.z)
    end

    self.highText.text = "E"..data.highPrice
    self.lowText.text = "E"..data.lowPrice
    self.volumeText.text = "E"..data.sumDealedPrice
end
--点击交易按钮
function LabResearchLineItem:_clickExchnageBtn()
    ct.OpenCtrl("ExchangeTransactionCtrl", self.data)
end