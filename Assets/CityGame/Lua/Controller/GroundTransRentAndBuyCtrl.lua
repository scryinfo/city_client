---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2018/12/26 17:29
---GroundTransRentAndBuyCtrl
GroundTransRentAndBuyCtrl = class('GroundTransRentAndBuyCtrl',UIPage)
UIPage:ResgisterOpen(GroundTransRentAndBuyCtrl)

function GroundTransRentAndBuyCtrl:initialize()
    UIPage.initialize(self, UIType.Normal, UIMode.HideOther, UICollider.None)
end

function GroundTransRentAndBuyCtrl:bundleName()
    return "GroundTransRentAndBuyPanel"
end

function GroundTransRentAndBuyCtrl:OnCreate(obj)
    UIPage.OnCreate(self, obj)

    local groundAuctionBehaviour = obj:GetComponent('LuaBehaviour')
    groundAuctionBehaviour:AddClick(GroundTransRentAndBuyPanel.bgBtn.gameObject, self._closeBtnFunc, self)
    groundAuctionBehaviour:AddClick(GroundTransRentAndBuyPanel.backBtn.gameObject, self._backBtnFunc, self)
    groundAuctionBehaviour:AddClick(GroundTransRentAndBuyPanel.ownerBtn.gameObject, self._portraitBtnFunc, self)
    groundAuctionBehaviour:AddClick(GroundTransRentAndBuyPanel.buyBtn.gameObject, self._buyBtnFunc, self)
    groundAuctionBehaviour:AddClick(GroundTransRentAndBuyPanel.rentBtn.gameObject, self._rentBtnFunc, self)

    GroundTransRentAndBuyPanel.tenancySlider.onValueChanged:AddListener(function(value)
        GroundTransRentAndBuyPanel.tenancyText.text = value
        GroundTransRentAndBuyPanel.totalRentalText.text = value * GroundTransRentAndBuyPanel.tenancySlider.value
    end)
end

function GroundTransRentAndBuyCtrl:Awake(go)
end

function GroundTransRentAndBuyCtrl:Refresh()
    self:_initPanelData()
end

function GroundTransRentAndBuyCtrl:Hide()
    UIPage.Hide(self)
end

function GroundTransRentAndBuyCtrl:Close()

end

---初始化
function GroundTransRentAndBuyCtrl:_initPanelData()
    if self.m_data and self.m_data.groundInfo then
        self:_setShowState(self.m_data.groundInfo, self.m_data.groundState)
    end
end
--根据状态显示界面
function GroundTransRentAndBuyCtrl:_setShowState(groundInfo, groundState)
    GroundTransRentAndBuyPanel.sellRoot.localScale = Vector3.zero
    GroundTransRentAndBuyPanel.rentRoot.localScale = Vector3.zero

    --显示名字+头像

    if groundState == GroundTransState.Rent then
        GroundTransRentAndBuyPanel.rentRoot.localScale = Vector3.one
        GroundTransRentAndBuyPanel.tenancySlider.minValue = groundInfo.rent.rentDaysMin
        GroundTransRentAndBuyPanel.tenancySlider.maxValue = groundInfo.rent.rentDaysMax
        GroundTransRentAndBuyPanel.tenancySlider.value = GroundTransRentAndBuyPanel.tenancySlider.maxValue
        GroundTransRentAndBuyPanel.tenancyText.text = GroundTransRentAndBuyPanel.tenancySlider.value
        GroundTransRentAndBuyPanel.dayRentalText.text = groundInfo.rent.rentPreDay
        GroundTransRentAndBuyPanel.totalRentalText.text = groundInfo.rent.rentPreDay * GroundTransRentAndBuyPanel.tenancySlider.value

    elseif groundState == GroundTransState.Sell then
        GroundTransRentAndBuyPanel.sellRoot.localScale = Vector3.one
        GroundTransRentAndBuyPanel.sellPriceText.text = groundInfo.sell.price
    end
end

---按钮方法
--点其他地方则关闭整个堆栈，打开主界面
function GroundTransRentAndBuyCtrl:_closeBtnFunc()
    --关闭所有界面
end
--返回按钮
function GroundTransRentAndBuyCtrl:_backBtnFunc()
    UIPage:ClosePage()
end

--点击购买按钮
function GroundTransRentAndBuyCtrl:_buyBtnFunc(ins)
    if ins.m_data.groundInfo.sell.price then
        DataManager.DetailModelRpcNoRet(ins.m_data.blockId, 'm_ReqBuyGround', ins.m_data.groundInfo.sell.price)
    end
end
--点击租房按钮
function GroundTransRentAndBuyCtrl:_rentBtnFunc(ins)
    if ins.m_data.groundInfo.rent then
        DataManager.DetailModelRpcNoRet(ins.m_data.blockId, 'm_ReqRentGround', ins.m_data.groundInfo.rent, tonumber(GroundTransRentAndBuyPanel.tenancyText.text))
    end
end
--点击头像
function GroundTransRentAndBuyCtrl:_portraitBtnFunc(ins)
    --if ins.m_data.groundInfo.rent then
    --    DataManager.DetailModelRpcNoRet(ins.m_data.blockId, 'm_ReqRentGround', ins.m_data.groundInfo.rent, tonumber(GroundTransRentAndBuyPanel.tenancyText.text))
    --end
end