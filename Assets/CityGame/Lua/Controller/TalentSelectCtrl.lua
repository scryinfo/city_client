---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2018/12/24 16:38
---选择人才ctrl
TalentSelectCtrl = class('TalentSelectCtrl',UIPage)
UIPage:ResgisterOpen(TalentSelectCtrl) --注册打开的方法
local gameObject;
local TalentSelectBehaviour
TalentSelectCtrl.static.TaientType_PATH = "View/TalentCenterItem/TalentTypeItem"

function  TalentSelectCtrl:bundleName()
    return "Assets/CityGame/Resources/View/TalentSelectPanel.prefab"
end

function TalentSelectCtrl:initialize()
    UIPage.initialize(self,UIType.Normal,UIMode.HideOther,UICollider.None)--可以回退，UI打开后，隐藏其它面板
    --UIPage.initialize(self,UIType.Normal,UIMode.NeedBack,UICollider.None)--可以回退，UI打开后，不隐藏其它的UI
end

--启动事件--
function TalentSelectCtrl:OnCreate(obj)
    UIPage.OnCreate(self,obj)
    --初始化
    self:_initData();
    TalentSelectBehaviour:AddClick(TalentSelectPanel.backBtn,self.OnBackBtn,self);
    TalentSelectBehaviour:AddClick(TalentSelectPanel.confirm,self.OnConfirm,self);
end

function TalentSelectCtrl:Awake()
    self.talentTypeLuaItem = {} --左边TalentType实例
end

function TalentSelectCtrl:Refresh()
    --打开通知Model
    --self:initializeData()
end

function TalentSelectCtrl:initializeData()
    if self.m_data then
        DataManager.OpenDetailModel(GameNoticeModel,5)
    end
end

--初始化
function TalentSelectCtrl:_initData()
    TalentSelectBehaviour = self.gameObject:GetComponent('LuaBehaviour');

    for i, v in ipairs(Talent) do
        local prefab = self:_creatTalentType(TalentSelectCtrl.static.TaientType_PATH,TalentSelectPanel.content)
        self.talentTypeLuaItem[i] = TalentTypeLuaItem:new(prefab,TalentSelectBehaviour, i,self,v)
    end
    self.talentTypeLuaItem[1].sclect.localScale = Vector3.one
end

--点击返回按钮
function TalentSelectCtrl:OnBackBtn()
    UIPage.ClosePage()
end

--点击确定
function TalentSelectCtrl:OnConfirm()
    TalentMiningCtrl:_creatTalent(TalentMiningCtrl.static.Building_PATH,TalentMiningPanel.content,6)
    ExcavateItem:m_addTalents(ExcavateItem.static.Line_PATH,6,nil)
    UIPage.ClosePage()
end

--生成预制
function TalentSelectCtrl:_creatTalentType(path,parent)
    local prefab = UnityEngine.Resources.Load(path);
    local go = UnityEngine.GameObject.Instantiate(prefab);
    local rect = go.transform:GetComponent("RectTransform");
    go.transform:SetParent(parent.transform);
    rect.transform.localScale = Vector3.one;
    return go
end
