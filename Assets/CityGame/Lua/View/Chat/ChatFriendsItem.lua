---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Tina.
--- DateTime: 2018/12/14 20:44
---

ChatFriendsItem = class('ChatFriendsItem')

-- 初始化
function ChatFriendsItem:initialize(itemId, index, prefab, isOn, data)
    --prefab:GetComponent("Image").sprite = UnityEngine.Resources.Load("1")
    --ChatCtrl.static.luaBehaviour:AddClick(prefab, self.OnExpressionBtn, self)
    self.prefab = prefab
    self.data = data
    self.data.itemId = itemId
    self.data.index = index
    self.data.company = "Scry"

    local transform = prefab.transform
    -- 复选框提示
    self.toggle = transform:Find("Toggle"):GetComponent("Toggle")
    -- 好友名
    self.nameText = transform:Find("NameText"):GetComponent("Text")
    -- 好友所在公司名字
    self.companyText = transform:Find("CompanyText"):GetComponent("Text")
    -- 好友消息红点提示
    self.noticeImage = transform:Find("NoticeImage").gameObject
    self.noticeText = transform:Find("NoticeImage/NoticeText"):GetComponent("Text")

    self.toggle.isOn = false
    self.nameText.text = self.data.name
    self.companyText.text = self.data.company
    self.noticeImage:SetActive(false)

    self.toggle.onValueChanged:AddListener(function (isOn)
        self:_toggleValueChange(isOn)
    end)
end

function ChatFriendsItem:SetNoticeText(text)
    if text and text > 0 then
        self.noticeImage:SetActive(true)
        self.noticeText.text = text
    else
        self.noticeImage:SetActive(false)
    end
end

function ChatFriendsItem:_toggleValueChange(isOn)
    if isOn then
        self.toggle.interactable = false
        self.noticeImage:SetActive(false)
        ChatCtrl.static.chatMgr:SetToggle(self.toggle)
        if self.data.index == 1 then
            ChatCtrl.static.chatMgr:DestroyContentChildren(2)
            ChatCtrl.static.chatMgr:ShowPlayerInfo(2, self.data)
            DataManager.SetMyReadChatInfo(2, self.data.id)
            ChatCtrl.static.chatMgr:ShowAllChatInfo(2, self.data.id)
            ChatCtrl.static.chatMgr:StartScrollBottom()
        else
            ChatCtrl.static.chatMgr:ShowPlayerInfo(3, self.data)
            DataManager.SetMyReadChatInfo(3, self.data.id)
            ChatCtrl.static.chatMgr:ShowAllChatInfo(3, self.data.id)
            ChatCtrl.static.chatMgr:StartScrollBottom()
        end
    end
end