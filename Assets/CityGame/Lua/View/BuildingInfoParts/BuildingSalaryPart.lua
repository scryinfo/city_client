---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xuyafang.
--- DateTime: 2019/2/27 18:13
---建筑主界面调整工资底部
BuildingSalaryPart = class('BuildingSalaryPart', BasePart)
--
function BuildingSalaryPart:PrefabName()
    return "BuildingSalaryPart"
end
--
function BuildingSalaryPart:GetDetailClass()
    return BuildingSalaryDetailPartNew
end
--
function  BuildingSalaryPart:_ResetTransform()
    self.salaryPercentText.text = "E0.0000"
    self:_language()
end
--
function BuildingSalaryPart:_InitTransform()
    self:_getComponent(self.transform)
end
--
function BuildingSalaryPart:_InitChildClick(mainPanelLuaBehaviour)
    DataManager.ModelRegisterNetMsg(nil, "gscode.OpCode", "queryIndustryWages", "gs.QueryIndustryWages", self._getStandardWage, self)
end
--
function BuildingSalaryPart:_RemoveChildClick()
    DataManager.ModelNoneInsIdRemoveNetMsg("gscode.OpCode", "queryIndustryWages", self)
end
--
function BuildingSalaryPart:RefreshData(data)
    if data == nil then
        return
    end
    self.m_data = data
    self:_initFunc()
end
--
function BuildingSalaryPart:_getComponent(transform)
    self.salaryPercentText = transform:Find("Top/salaryPercentText"):GetComponent("Text")
    self.salaryText01 = transform:Find("Top/Text"):GetComponent("Text")
    self.unSelectText02 = transform:Find("UnselectBtn/Text"):GetComponent("Text")
    self.selectText03 = transform:Find("SelectBtn/Text"):GetComponent("Text")
end
--
function BuildingSalaryPart:_initFunc()
    if self.m_data.info ~= nil then
        local standardWage = DataManager.GetBuildingStandardWage(self.m_data.info.mId)
        if standardWage == nil then
            DataManager.m_ReqStandardWage(self.m_data.info.mId)
        else
            local staffNum = PlayerBuildingBaseData[self.m_data.info.mId].maxWorkerNum
            local value = self.m_data.info.salary * staffNum * standardWage / 100  --因为工资百分比是整数
            self.salaryPercentText.text = "E"..GetClientPriceString(value)
        end
    end
end
--
function BuildingSalaryPart:_language()
    self.salaryText01.text = GetLanguage(26010002)
    self.unSelectText02.text = GetLanguage(26010001)
    self.selectText03.text = GetLanguage(26010001)

    local trueTextW01 = self.unSelectText02.preferredWidth
    self.unSelectText02.rectTransform.sizeDelta = Vector2.New(trueTextW01, self.unSelectText02.rectTransform.sizeDelta.y)
    local trueTextW02 = self.selectText03.preferredWidth
    self.selectText03.rectTransform.sizeDelta = Vector2.New(trueTextW02, self.selectText03.rectTransform.sizeDelta.y)
end
--
function BuildingSalaryPart:_getStandardWage(data)
    if data.industryWages ~= nil then
        DataManager.SetBuildingStandardWage(data.type, data.industryWages)

        local staffNum = PlayerBuildingBaseData[self.m_data.info.mId].maxWorkerNum
        local standardWage = data.industryWages
        local value = self.m_data.info.salary * staffNum * standardWage / 100  --因为工资百分比是整数
        self.salaryPercentText.text = "E"..GetClientPriceString(value)
    end
end