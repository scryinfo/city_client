---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by password.
--- DateTime: 2019/5/20 17:49
---设置密码ctrl
SetPasswordCtrl = class('SetPasswordCtrl',UIPanel)
UIPanel:ResgisterOpen(SetPasswordCtrl)

local setPasswordBehaviour;

function  SetPasswordCtrl:bundleName()
    return "Assets/CityGame/Resources/View/SetPasswordPanel.prefab"
end

function SetPasswordCtrl:initialize()
    UIPanel.initialize(self,UIType.Normal,UIMode.HideOther,UICollider.None)--可以回退，UI打开后，隐藏其它面板
    --UIPanel.initialize(self,UIType.Normal,UIMode.NeedBack,UICollider.None)--可以回退，UI打开后，不隐藏其它的UI
end

function SetPasswordCtrl:OnCreate(obj)
    UIPanel.OnCreate(self,obj)

end

function SetPasswordCtrl:Awake()
    setPasswordBehaviour = self.gameObject:GetComponent('LuaBehaviour');
    setPasswordBehaviour:AddClick(SetPasswordPanel.back,self.OnBack,self)
    setPasswordBehaviour:AddClick(SetPasswordPanel.next,self.OnNext,self)

    RegisterPanel.password.onValueChanged:AddListener(function()
        self:_OnPassword()
    end)
    RegisterPanel.confirm.onValueChanged:AddListener(function()
        self:_OnConfirm()
    end)
end

function SetPasswordCtrl:Active()
    UIPanel.Active(self)
    Event.AddListener("c_ChangePassword",self.c_ChangePassword,self)

    SetPasswordPanel.name.text = GetLanguage(10040006)
    SetPasswordPanel.passwordPlaceholder.text = GetLanguage(10030007)
    SetPasswordPanel.passwordText.text = GetLanguage(10030007)
    SetPasswordPanel.confirmPlaceholder.text = GetLanguage(10030008)
    SetPasswordPanel.confirmText.text = GetLanguage(10030008)
    SetPasswordPanel.nextText.text = GetLanguage(10030003)
end

function SetPasswordCtrl:Hide()
    UIPanel.Hide(self)
    Event.RemoveListener("c_ChangePassword",self.c_ChangePassword,self)
    SetPasswordPanel.password.text = ""
    SetPasswordPanel.confirm.text = ""
    SetPasswordPanel.passwordHint.transform.localScale = Vector3.zero
    SetPasswordPanel.confirmHint.transform.localScale = Vector3.zero
end

--返回
function SetPasswordCtrl:OnBack()
    PlayMusEff(1002)
    Event.Brocast("m_CanCleModeFyPwd")  --取消修改密码
    UIPanel.ClosePage()
end

function SetPasswordCtrl:_OnPassword()
    SetPasswordPanel.input:BanChinese(RegisterPanel.password)
end

function SetPasswordCtrl:_OnConfirm()
    SetPasswordPanel.input:BanChinese(RegisterPanel.confirm)
end

--修改密码
function SetPasswordCtrl:OnNext()
    PlayMusEff(1002)
    SetPasswordPanel.passwordHint.transform.localScale = Vector3.zero
    SetPasswordPanel.confirmHint.transform.localScale = Vector3.zero
    if SetPasswordPanel.password.text == "" then
        SetPasswordPanel.passwordHint.transform.localScale = Vector3.one
        SetPasswordPanel.passwordHint.text = GetLanguage(10030021)
    elseif SetPasswordPanel.confirm.text == "" then
        SetPasswordPanel.confirmHint.transform.localScale = Vector3.one
        SetPasswordPanel.confirmHint.text = GetLanguage(10030022)
    elseif string.find(SetPasswordPanel.password.text,"%s") ~= nil then
        SetPasswordPanel.passwordHint.transform.localScale = Vector3.one
        SetPasswordPanel.passwordHint.text = GetLanguage(10030024)
    elseif #SetPasswordPanel.password.text < 8 or #SetPasswordPanel.password.text > 12 then
        SetPasswordPanel.passwordHint.transform.localScale = Vector3.one
        SetPasswordPanel.passwordHint.text = GetLanguage(10030013)
    elseif SetPasswordPanel.password.text ~=SetPasswordPanel.confirm.text  then
        SetPasswordPanel.confirmHint.transform.localScale = Vector3.one
        SetPasswordPanel.confirmHint.text = GetLanguage(10030012)
    else
        Event.Brocast("m_ChangePassword",SetPasswordPanel.password.text)
    end
end

--修改密码回调
function SetPasswordCtrl:c_ChangePassword()
    local data={ReminderType = ReminderType.Succeed,ReminderSelectType = ReminderSelectType.NotChoose,
                content = GetLanguage(10040003),func = function()
            ct.OpenCtrl('LoginCtrl',Vector2.New(0, 0))
            LoginPanel.inputPassword:GetComponent('InputField').text = ""
        end  }
    ct.OpenCtrl('NewReminderCtrl',data)
end
